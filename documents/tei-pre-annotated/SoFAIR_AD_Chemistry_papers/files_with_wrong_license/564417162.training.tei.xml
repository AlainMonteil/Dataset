<?xml version="1.0" encoding="UTF-8"?>
<tei xmlns="http://www.tei-c.org/ns/1.0">
    <teiHeader>
        <fileDesc xml:id="_1"/>
        <encodingDesc>
            <appInfo>
                <application version="0.8.1-SNAPSHOT" ident="GROBID" when="2024-06-13T15:01+0000">
                    <ref target="https://github.com/kermitt2/grobid">A machine learning software for extracting information from scholarly documents</ref>
                </application>
            </appInfo>
        </encodingDesc>
    </teiHeader>
    <text xml:lang="en">
        <p>Measuring the abundances of carbon and oxygen in exoplanet atmospheres is considered a crucial avenue for unlocking the formation and evolution of exoplanetary systems 1,2 . Access to the chemical inventory of an exoplanet requires high-precision observations, often inferred from individual molecular detections with low-resolution space-based [3][4][5] and high-resolution ground-based [6][7][8] facilities.Measuring the abundances of carbon and oxygen in exoplanet atmospheres is considered a crucial avenue for unlocking the formation and evolution of exoplanetary systems 1,2 . Access to the chemical inventory of an exoplanet requires high-precision observations, often inferred from individual molecular detections with low-resolution space-based [3][4][5] and high-resolution ground-based [6][7][8] facilities.</p>
        <p>Here we report the medium-resolution (R ≈ 600) transmission spectrum of an exoplanet atmosphere between 3 and 5 μm covering several absorption features for the Saturn-mass exoplanet WASP-39b (ref. 9 ), obtained with the Near Infrared Spectrograph (NIRSpec) G395H grating of JWST. Our observations achieve 1.46 times photon precision, providing an average transit depth uncertainty of 221 ppm per spectroscopic bin, and present minimal impacts from systematic effects. We detect significant absorption from CO 2 (28.5σ) and H 2 O (21.5σ), and identify SO 2 as the source of absorption at 4.1 μm (4.8σ). Best-fit atmospheric models range between 3 and 10 times solar metallicity, with sub-solar to solar C/O ratios. These results, including the detection of SO 2 , underscore the importance of characterizing the chemistry in exoplanet atmospheres and showcase NIRSpec G395H as an excellent mode for time-series observations over this critical wavelength range 10 .Here we report the medium-resolution (R ≈ 600) transmission spectrum of an exoplanet atmosphere between 3 and 5 μm covering several absorption features for the Saturn-mass exoplanet WASP-39b (ref. 9 ), obtained with the Near Infrared Spectrograph (NIRSpec) G395H grating of JWST. Our observations achieve 1.46 times photon precision, providing an average transit depth uncertainty of 221 ppm per spectroscopic bin, and present minimal impacts from systematic effects. We detect significant absorption from CO 2 (28.5σ) and H 2 O (21.5σ), and identify SO 2 as the source of absorption at 4.1 μm (4.8σ). Best-fit atmospheric models range between 3 and 10 times solar metallicity, with sub-solar to solar C/O ratios. These results, including the detection of SO 2 , underscore the importance of characterizing the chemistry in exoplanet atmospheres and showcase NIRSpec G395H as an excellent mode for time-series observations over this critical wavelength range 10 .</p>
        <p>We obtained a single-transit observation of WASP-39b using the NIR-Spec 11,12 G395H grating on 30-31 July 2022 between 21:45 and 06:21 UTC using the Bright Object Time Series mode. WASP-39b is a hot (T eq = 1,120 K), low-density giant planet with an extended atmosphere. Previous spectroscopic observations have shown prominent atmospheric absorption by Na, K and H 2 O (refs. 3,4,[13][14][15] ), with tentative evidence of CO 2 from infrared photometry 4 . Atmospheric models fitted to the spectrum have inferred metallicities (amount of heavy elements relative to the host star) from 0.003 to 300 times solar 3,[15][16][17][18][19][20] , which makes it difficult to ascertain the formation pathway of the planet 21,22 . The host, WASP-39, is a G8-type star that shows little photometric variability 23 and has nearly solar elemental abundance patterns 24 . The quiet host and extended planetary atmosphere make WASP-39b an ideal exoplanet for transmission spectroscopy 25 . The transmission spectrum of WASP-39b was observed as part of the JWST Transiting Exoplanet Community Director's Discretionary Early Release Science ( JTEC ERS) Program 26,27 (ERS-1366; principal investigators Natalie M. Batalha, Jacob L. Bean and Kevin B. Stevenson), which uses four instrument configurations to test their capabilities and provide lessons learned for the community.We obtained a single-transit observation of WASP-39b using the NIR-Spec 11,12 G395H grating on 30-31 July 2022 between 21:45 and 06:21 UTC using the Bright Object Time Series mode. WASP-39b is a hot (T eq = 1,120 K), low-density giant planet with an extended atmosphere. Previous spectroscopic observations have shown prominent atmospheric absorption by Na, K and H 2 O (refs. 3,4,[13][14][15] ), with tentative evidence of CO 2 from infrared photometry 4 . Atmospheric models fitted to the spectrum have inferred metallicities (amount of heavy elements relative to the host star) from 0.003 to 300 times solar 3,[15][16][17][18][19][20] , which makes it difficult to ascertain the formation pathway of the planet 21,22 . The host, WASP-39, is a G8-type star that shows little photometric variability 23 and has nearly solar elemental abundance patterns 24 . The quiet host and extended planetary atmosphere make WASP-39b an ideal exoplanet for transmission spectroscopy 25 . The transmission spectrum of WASP-39b was observed as part of the JWST Transiting Exoplanet Community Director's Discretionary Early Release Science ( JTEC ERS) Program 26,27 (ERS-1366; principal investigators Natalie M. Batalha, Jacob L. Bean and Kevin B. Stevenson), which uses four instrument configurations to test their capabilities and provide lessons learned for the community.</p>
        <p>The NIRSpec G395H data were recorded with the 1.6″ × 1.6″ fixed slit aperture using the SUB2048 subarray and NRSRAPID readout pattern, with spectra dispersed across both the NRS1 and NRS2 detectors. Over the roughly 8-h duration of the observation, a total of 465 integrations were taken, centred around the 2.8-h transit. We obtained 70 groups per integration, resulting in an effective integration time of 63.14 s. During the observation, the telescope experienced a 'tilt event', a spontaneous and abrupt change in the position of one or more mirror segments, causing changes in the point spread function (PSF) and hence jumps in flux 28 . The tilt event occurred mid-transit, affecting approximately three integrations and resulted in a noticeable step in the flux time series, the size of which is dependent on wavelength (Fig. 1 andMethods). The tilt event also affects the PSF, with the full width at half maximum (FWHM) of the spectral trace showing a step-function-like shape (see Extended Data Figs. 2 and3).The NIRSpec G395H data were recorded with the 1.6″ × 1.6″ fixed slit aperture using the SUB2048 subarray and NRSRAPID readout pattern, with spectra dispersed across both the NRS1 and NRS2 detectors. Over the roughly 8-h duration of the observation, a total of 465 integrations were taken, centred around the 2.8-h transit. We obtained 70 groups per integration, resulting in an effective integration time of 63.14 s. During the observation, the telescope experienced a 'tilt event', a spontaneous and abrupt change in the position of one or more mirror segments, causing changes in the point spread function (PSF) and hence jumps in flux 28 . The tilt event occurred mid-transit, affecting approximately three integrations and resulted in a noticeable step in the flux time series, the size of which is dependent on wavelength (Fig. 1 andMethods). The tilt event also affects the PSF, with the full width at half maximum (FWHM) of the spectral trace showing a step-function-like shape (see Extended Data Figs. 2 and3).</p>
        <p>We produced several reductions of the observations using independent analysis pipelines (see Methods). For each reduction, we created broadband and spectroscopic light curves in the ranges 2.725-3.716 μm for NRS1 and 3.829-5.172 μm for NRS2 using 10-pixel-wide bins (≈0.007 μm, median resolution R ≈ 600), excluding the detector gap between 3.717-3.823 μm. The light curves show a settling ramp during the first ten integrations (≈631.4 s), with a linear slope across the entire observation for NRS1. We otherwise see no substantial systematic trends and achieve improvements in precision from raw uncorrected to fitted broadband light curves of 1.63 to 1.03 times photon noise for NRS1 and 1.95 to 1.31 times for NRS2. The flux jump caused by the mirror-tilt event could be corrected by detrending against the spectral trace x and y positional shifts, normalizing the light curves or fitting the light curves with a step function (see Methods). We produced several fits from each set of light curves, resulting in a total of 11 independently measured transmission spectra. Figure 1 demonstrates that our spectroscopic light curves achieve precisions close to photon noise, with a median precision of 1.46 times photon noise across the full wavelength range (see Extended Data Fig. 4).We produced several reductions of the observations using independent analysis pipelines (see Methods). For each reduction, we created broadband and spectroscopic light curves in the ranges 2.725-3.716 μm for NRS1 and 3.829-5.172 μm for NRS2 using 10-pixel-wide bins (≈0.007 μm, median resolution R ≈ 600), excluding the detector gap between 3.717-3.823 μm. The light curves show a settling ramp during the first ten integrations (≈631.4 s), with a linear slope across the entire observation for NRS1. We otherwise see no substantial systematic trends and achieve improvements in precision from raw uncorrected to fitted broadband light curves of 1.63 to 1.03 times photon noise for NRS1 and 1.95 to 1.31 times for NRS2. The flux jump caused by the mirror-tilt event could be corrected by detrending against the spectral trace x and y positional shifts, normalizing the light curves or fitting the light curves with a step function (see Methods). We produced several fits from each set of light curves, resulting in a total of 11 independently measured transmission spectra. Figure 1 demonstrates that our spectroscopic light curves achieve precisions close to photon noise, with a median precision of 1.46 times photon noise across the full wavelength range (see Extended Data Fig. 4).</p>
        <p>We show transmission spectra from several combinations of independent reductions and light-curve-fitting routines in Fig. 2, along with the weighted average of all 11 transmission spectra with the unweighted mean uncertainty produced by our analyses (see Methods). We find that using different combinations of reduction and fitting methods results in consistent transmission spectra (see Methods and Extended Data Fig. 5). Although we see some artefacts at the edges of the detectors (see Fig. 3, bottom panel) that may be caused by uncharacterized systematics, these only affect a small number of wavelength bins. Our resulting averaged NIRSpec G395H spectrum shows increased absorption towards bluer wavelengths short of 3.7 μm and a prominent absorption feature between 4.2 and 4.5 μm, along with a smaller-amplitude absorption feature at 4.1 μm and a narrow feature around 4.56 μm.We show transmission spectra from several combinations of independent reductions and light-curve-fitting routines in Fig. 2, along with the weighted average of all 11 transmission spectra with the unweighted mean uncertainty produced by our analyses (see Methods). We find that using different combinations of reduction and fitting methods results in consistent transmission spectra (see Methods and Extended Data Fig. 5). Although we see some artefacts at the edges of the detectors (see Fig. 3, bottom panel) that may be caused by uncharacterized systematics, these only affect a small number of wavelength bins. Our resulting averaged NIRSpec G395H spectrum shows increased absorption towards bluer wavelengths short of 3.7 μm and a prominent absorption feature between 4.2 and 4.5 μm, along with a smaller-amplitude absorption feature at 4.1 μm and a narrow feature around 4.56 μm.</p>
        <p>We compared the weighted-average G395H transmission spectrum to three grids of 1D radiative-convective-thermochemical equilibrium (RCTE) atmosphere models of WASP-39b (see Methods and Extended Data Table 2), containing a total of 10,308 model spectra. The best-fit models from each grid provide a reduced chi-square per data point (χ 2 /N) of 1.08-1.20 for our 344-data-point transmission spectrum (Fig. 3). The increased absorption at blue wavelengths across NRS1 is consistent with absorption from H 2 O (at 21.5σ; see Methods), whereas the large bump in absorption between 4.2 and 4.5 μm (ref. 29 ) can be attributed to CO 2 (28.5σ). H 2 O and CO 2 are expected atmospheric constituents for near-solar atmospheric metallicities, with the CO 2 abundance increasing nonlinearly with higher metallicity 30 . The spectral feature at 4.56 μm (3.3σ) is unidentified at present but does not correlate with any obvious detector artefacts and is reproduced by several independent analyses. The absorption feature at 4.1 μm is also not seen in the RCTE model grids. After an exhaustive search for possible opacity sources (S.-M. Tsai et al., manuscript in preparation), described in the corresponding NIRSpec PRISM analysis 31 , we interpret this feature as SO 2 (4.8σ), as it is the best candidate at this wavelength.We compared the weighted-average G395H transmission spectrum to three grids of 1D radiative-convective-thermochemical equilibrium (RCTE) atmosphere models of WASP-39b (see Methods and Extended Data Table 2), containing a total of 10,308 model spectra. The best-fit models from each grid provide a reduced chi-square per data point (χ 2 /N) of 1.08-1.20 for our 344-data-point transmission spectrum (Fig. 3). The increased absorption at blue wavelengths across NRS1 is consistent with absorption from H 2 O (at 21.5σ; see Methods), whereas the large bump in absorption between 4.2 and 4.5 μm (ref. 29 ) can be attributed to CO 2 (28.5σ). H 2 O and CO 2 are expected atmospheric constituents for near-solar atmospheric metallicities, with the CO 2 abundance increasing nonlinearly with higher metallicity 30 . The spectral feature at 4.56 μm (3.3σ) is unidentified at present but does not correlate with any obvious detector artefacts and is reproduced by several independent analyses. The absorption feature at 4.1 μm is also not seen in the RCTE model grids. After an exhaustive search for possible opacity sources (S.-M. Tsai et al., manuscript in preparation), described in the corresponding NIRSpec PRISM analysis 31 , we interpret this feature as SO 2 (4.8σ), as it is the best candidate at this wavelength.</p>
        <p>Although SO 2 would have volume mixing ratios (VMRs) of less than 10 -10 throughout most of the observable atmosphere in thermochemical equilibrium, coupled photochemistry of H 2 S and H 2 O can produce SO 2 on giant exoplanets, with the resulting SO 2 mixing ratio expected to increase with increasing atmospheric metallicity [32][33][34] . We find that a VMR of approximately 10 -6 of SO 2 is required to fit the spectral feature at 4.1 μm in the transmission spectrum of WASP-39b, consistent with lower-resolution NIRSpec PRISM observations of this planet 31 and previous photochemical modelling of super-solar metallicity giant exoplanets 34,35 . Figure 4 shows a breakdown of the contributing opacity sources for the lowest χ 2 /N best-fit model (PICASO 3.0) with VMR = 10 -5.6 injected SO 2 . The inclusion of SO 2 in the models results in an improved χ 2 /N and is detected at 4.8σ (see Methods), confirming its presence in the atmosphere of WASP-39b.Although SO 2 would have volume mixing ratios (VMRs) of less than 10 -10 throughout most of the observable atmosphere in thermochemical equilibrium, coupled photochemistry of H 2 S and H 2 O can produce SO 2 on giant exoplanets, with the resulting SO 2 mixing ratio expected to increase with increasing atmospheric metallicity [32][33][34] . We find that a VMR of approximately 10 -6 of SO 2 is required to fit the spectral feature at 4.1 μm in the transmission spectrum of WASP-39b, consistent with lower-resolution NIRSpec PRISM observations of this planet 31 and previous photochemical modelling of super-solar metallicity giant exoplanets 34,35 . Figure 4 shows a breakdown of the contributing opacity sources for the lowest χ 2 /N best-fit model (PICASO 3.0) with VMR = 10 -5.6 injected SO 2 . The inclusion of SO 2 in the models results in an improved χ 2 /N and is detected at 4.8σ (see Methods), confirming its presence in the atmosphere of WASP-39b.</p>
        <p>We also look for evidence of CH 4 , CO, H 2 S and OCS (carbonyl sulfide) because their near-solar chemical equilibrium abundances could result in a contribution to the spectrum. We see no evidence of CH 4 in our spectrum between 3.0 and 3.6 μm (ref. 23 ), which is indicative of C/O &lt; 1 (ref. 36 ) and/or photochemical destruction 34,37 . With regards to CO, H 2 S and OCS, we were unable to conclusively confirm their presence with these data. In particular, CO, H 2 O, OCS and our modelled cloud deck all have overlapping opacity, which creates a pseudo-continuum from 4.6 to 5.1 μm (see Figs. 3 and4). Therefore, we were unable to unambiguously identify the individual contributions from CO and other molecules over this wavelength region at the resolution presented in this work.We also look for evidence of CH 4 , CO, H 2 S and OCS (carbonyl sulfide) because their near-solar chemical equilibrium abundances could result in a contribution to the spectrum. We see no evidence of CH 4 in our spectrum between 3.0 and 3.6 μm (ref. 23 ), which is indicative of C/O &lt; 1 (ref. 36 ) and/or photochemical destruction 34,37 . With regards to CO, H 2 S and OCS, we were unable to conclusively confirm their presence with these data. In particular, CO, H 2 O, OCS and our modelled cloud deck all have overlapping opacity, which creates a pseudo-continuum from 4.6 to 5.1 μm (see Figs. 3 and4). Therefore, we were unable to unambiguously identify the individual contributions from CO and other molecules over this wavelength region at the resolution presented in this work.</p>
        <p>Our models show an atmosphere enriched in heavy elements, with best-fit parameters ranging from 3 to 10 times solar metallicity, given the spacing of individual model grids (see Methods). The spectra also indicate C/O ratios ranging from sub-solar to solar depending on the grid used, informed by the relative strength of absorption from carbon-bearing molecules to oxygen-bearing molecules. The interpretation of the relatively high resolution and precision of the G395H spectrum seems to be sensitive to the treatment of aerosols in the model, with one grid preferring 3 times solar metallicity when using a wavelength-dependent cloud opacity and physically motivated vertical cloud distribution 38 but 10 times solar metallicity when assuming a grey cloud. In general, forward model grids fit the main features of the data but do not place statistically significant constraints on many of the atmospheric parameters (see Methods). Future interpretation of the JTEC ERS WASP-39b data with Bayesian retrieval analyses will provide robust confidence intervals for these planetary properties and explore the degree to which these data are sensitive to modelling assumptions (for example, chemical equilibrium versus disequilibrium) and parameter degeneracies (for example, clouds versus atmospheric metallicity).Our models show an atmosphere enriched in heavy elements, with best-fit parameters ranging from 3 to 10 times solar metallicity, given the spacing of individual model grids (see Methods). The spectra also indicate C/O ratios ranging from sub-solar to solar depending on the grid used, informed by the relative strength of absorption from carbon-bearing molecules to oxygen-bearing molecules. The interpretation of the relatively high resolution and precision of the G395H spectrum seems to be sensitive to the treatment of aerosols in the model, with one grid preferring 3 times solar metallicity when using a wavelength-dependent cloud opacity and physically motivated vertical cloud distribution 38 but 10 times solar metallicity when assuming a grey cloud. In general, forward model grids fit the main features of the data but do not place statistically significant constraints on many of the atmospheric parameters (see Methods). Future interpretation of the JTEC ERS WASP-39b data with Bayesian retrieval analyses will provide robust confidence intervals for these planetary properties and explore the degree to which these data are sensitive to modelling assumptions (for example, chemical equilibrium versus disequilibrium) and parameter degeneracies (for example, clouds versus atmospheric metallicity).</p>
        <p>We are able to strongly rule out an absolute C/O ≥ 1 scenario (χ 2 /N ≥ 3.97), which has previously been proposed for gas-dominated accretion at wide orbital radii beyond the CO 2 ice line at which the gas may be carbon-rich 39 . Our C/O upper limit, therefore, suggests that WASP-39b may have either formed at smaller orbital radii with gas-dominated accretion or that the accretion of solids enriched the atmosphere of WASP-39b with oxygen-bearing species 2 . The level of metal enrichment (3-10 times solar) is consistent with similar measurements of Jupiter and Saturn 40,41 , potentially suggesting core-accretion formation scenarios 42 , and is consistent with upper limits from interior-structure modelling 43 . These NIRSpec G395H transmission spectroscopy observations demonstrate the promise of robustly characterizing the atmospheric properties of exoplanets with JWST 3) with an injected abundance of 10 -5.6 (VMR) SO 2 . We also show this model with a selection of the anticipated absorbing species and the cloud opacity removed to indicate their contributions to the model. The inclusion of SO 2 in the model decreases the χ 2 /N from 1.08 (shown in Fig. 3) to 1.02, resulting in a 4.8σ detection (see Extended Data Table 3). b-e, The effect of removing the corresponding molecular opacity from the spectrum (shaded region). Our best-fit model is also affected by minor opacities from CO, H 2 S, OCS and CH 4 , although their spectral features cannot be robustly detected in the spectrum. We show a model without CO and CH 4 in a to demonstrate this, with the minor contribution by CO also highlighted in e.We are able to strongly rule out an absolute C/O ≥ 1 scenario (χ 2 /N ≥ 3.97), which has previously been proposed for gas-dominated accretion at wide orbital radii beyond the CO 2 ice line at which the gas may be carbon-rich 39 . Our C/O upper limit, therefore, suggests that WASP-39b may have either formed at smaller orbital radii with gas-dominated accretion or that the accretion of solids enriched the atmosphere of WASP-39b with oxygen-bearing species 2 . The level of metal enrichment (3-10 times solar) is consistent with similar measurements of Jupiter and Saturn 40,41 , potentially suggesting core-accretion formation scenarios 42 , and is consistent with upper limits from interior-structure modelling 43 . These NIRSpec G395H transmission spectroscopy observations demonstrate the promise of robustly characterizing the atmospheric properties of exoplanets with JWST 3) with an injected abundance of 10 -5.6 (VMR) SO 2 . We also show this model with a selection of the anticipated absorbing species and the cloud opacity removed to indicate their contributions to the model. The inclusion of SO 2 in the model decreases the χ 2 /N from 1.08 (shown in Fig. 3) to 1.02, resulting in a 4.8σ detection (see Extended Data Table 3). b-e, The effect of removing the corresponding molecular opacity from the spectrum (shaded region). Our best-fit model is also affected by minor opacities from CO, H 2 S, OCS and CH 4 , although their spectral features cannot be robustly detected in the spectrum. We show a model without CO and CH 4 in a to demonstrate this, with the minor contribution by CO also highlighted in e.</p>
        <p>unburdened by substantial instrumental systematics, unravelling the nature and origins of exoplanetary systems.unburdened by substantial instrumental systematics, unravelling the nature and origins of exoplanetary systems.</p>
        <p>Any methods, additional references, Nature Portfolio reporting summaries, source data, extended data, supplementary information, acknowledgements, peer review information; details of author contributions and competing interests; and statements of data and code availability are available at https://doi.org/10.1038/s41586-022-05591-3.Any methods, additional references, Nature Portfolio reporting summaries, source data, extended data, supplementary information, acknowledgements, peer review information; details of author contributions and competing interests; and statements of data and code availability are available at https://doi.org/10.1038/s41586-022-05591-3.</p>
        <p>We produced several analyses of stellar spectra from the Stage 1 2D spectral images produced using the default STScI JWST Calibration Pipeline 44 ('rateints' files) and by means of customized runs of the STScI JWST Calibration Pipeline with user-defined inputs and processes for steps such as the 'jump detection' and 'bias subtraction' steps. Each pipeline starts with the raw 'uncal' 2D images that contain group-level products. As we noticed that the default superbias images were of poor quality, we produced two customized runs of the JWST Calibration Pipeline, using either the default bias step or a customized version. The customized step built a pseudo-bias image by computing the median pixel value in the first group across all integrations and then subtracted the new bias image from all groups. We note that the poor quality of the default superbias images affects NRS1 more notably than NRS2, and this method could be revised once a better superbias is available.We produced several analyses of stellar spectra from the Stage 1 2D spectral images produced using the default STScI JWST Calibration Pipeline 44 ('rateints' files) and by means of customized runs of the STScI JWST Calibration Pipeline with user-defined inputs and processes for steps such as the 'jump detection' and 'bias subtraction' steps. Each pipeline starts with the raw 'uncal' 2D images that contain group-level products. As we noticed that the default superbias images were of poor quality, we produced two customized runs of the JWST Calibration Pipeline, using either the default bias step or a customized version. The customized step built a pseudo-bias image by computing the median pixel value in the first group across all integrations and then subtracted the new bias image from all groups. We note that the poor quality of the default superbias images affects NRS1 more notably than NRS2, and this method could be revised once a better superbias is available.</p>
        <p>Before ramp fitting, both our standard and custom bias step runs of the edited JWST Calibration Pipeline 'destriped' the group-level images to remove so-called '1/f noise' (correlated noise arising from the electronics of the readout pattern, which appears as column striping in the subarray images 11,12 ). Our group-level destriping step used a mask of the trace 15σ from the dispersion axis for all groups within an integration, ensuring that a consistent set of pixels is masked within a ramp. The median values of non-masked pixels in each column were then computed and subtracted for each group.Before ramp fitting, both our standard and custom bias step runs of the edited JWST Calibration Pipeline 'destriped' the group-level images to remove so-called '1/f noise' (correlated noise arising from the electronics of the readout pattern, which appears as column striping in the subarray images 11,12 ). Our group-level destriping step used a mask of the trace 15σ from the dispersion axis for all groups within an integration, ensuring that a consistent set of pixels is masked within a ramp. The median values of non-masked pixels in each column were then computed and subtracted for each group.</p>
        <p>The results of our customized runs of the JWST Calibration Pipeline are a set of custom group-level destriped products and custom bias-subtracted group-level destriped products. In both cases, the ramp-jump detection threshold of the JWST Calibration Pipeline was set to 15σ (as opposed to the default of 4σ), as it produced the most consistent results at the integration level. In both custom runs of the JWST Calibration Pipeline, all other steps and inputs were left at the default values.The results of our customized runs of the JWST Calibration Pipeline are a set of custom group-level destriped products and custom bias-subtracted group-level destriped products. In both cases, the ramp-jump detection threshold of the JWST Calibration Pipeline was set to 15σ (as opposed to the default of 4σ), as it produced the most consistent results at the integration level. In both custom runs of the JWST Calibration Pipeline, all other steps and inputs were left at the default values.</p>
        <p>For all analyses, wavelength maps from the JWST Calibration Pipeline were used to produce wavelength solutions, verified against stellar absorption lines, for both detectors. The mid-integration times in BJD TDB were extracted from the image headers for use in producing light curves. None of our data-reduction pipelines performed a flat-field correction, as the available flat fields were of poor quality and unexpectedly removed portions of the spectral trace. In general, we found that 1/f noise can be corrected at either the group or integration levels to similar effect; however, correction at the group level with a repeated column-by-column cleaning step at the integration level probably results in cleaner 1D stellar spectra. This was particularly true for NRS2, owing to the limited number of columns in which the unilluminated region on the detector extends both above and below the spectral trace, as shown in Extended Data Fig. 1.For all analyses, wavelength maps from the JWST Calibration Pipeline were used to produce wavelength solutions, verified against stellar absorption lines, for both detectors. The mid-integration times in BJD TDB were extracted from the image headers for use in producing light curves. None of our data-reduction pipelines performed a flat-field correction, as the available flat fields were of poor quality and unexpectedly removed portions of the spectral trace. In general, we found that 1/f noise can be corrected at either the group or integration levels to similar effect; however, correction at the group level with a repeated column-by-column cleaning step at the integration level probably results in cleaner 1D stellar spectra. This was particularly true for NRS2, owing to the limited number of columns in which the unilluminated region on the detector extends both above and below the spectral trace, as shown in Extended Data Fig. 1.</p>
        <p>Below we detail each of the independent data-reduction pipelines used to produce the time series of stellar spectra from our G395H observations. ExoTiC-JEDI pipeline. We used the Exoplanet Timeseries Characterisation -JWST Extraction and Diagnostics Investigator (ExoTiC-JEDI 45 ) pipeline on our custom group-level destriped products, treating each detector separately. Using the data-quality flags produced by the JWST Calibration Pipeline, we replaced any pixels identified as bad, saturated, dead, hot, low quantum efficiency or no gain value with the median value of surrounding pixels. We also searched each integration for pixels that were spatial outliers from the median of the surrounding 20 pixels in the same row by 6σ (to remove permanently affected 'bad' pixels) or outliers from the median of that pixel in the surrounding ten integrations in time by 20σ (to identify high-energy short-term effects such as cosmic rays) and replaced the outliers with the median values. To obtain the trace position and FWHM, we fitted a Gaussian to each column of an integration, finding a median standard deviation of 0.7 pixels. A fourth-order polynomial was fitted through the trace centres and the widths, which were smoothed with a median filter, to obtain a simple aperture region. This region extended 5 times the FWHM of the spectral trace, above and below the centre, corresponding to a median aperture width of 7 pixels. To remove any remaining 1/f and background noise from each integration, we subtracted the median of the unilluminated region in each column by masking all pixels that were 5 pixels away from the aperture. For each integration, the counts in each row and column of the aperture region were summed using an intrapixel extraction, taking the relevant fractional flux of the pixels at the edge of the aperture and cross-correlated to produce x-pixel and y-pixel shifts for detrending (see Extended Data Fig. 2). On average, the x-pixel shift represents movement of 1 × 10 -4 and 8 × 10 -6 of a pixel for NRS1 and NRS2, respectively. The aperture column sums resulted in 1D stellar spectra with errors calculated from photon noise after converting from data numbers using the gain factor. This reduction is denoted hereafter as ExoTiC-JEDI [V1].Below we detail each of the independent data-reduction pipelines used to produce the time series of stellar spectra from our G395H observations. ExoTiC-JEDI pipeline. We used the Exoplanet Timeseries Characterisation -JWST Extraction and Diagnostics Investigator (ExoTiC-JEDI 45 ) pipeline on our custom group-level destriped products, treating each detector separately. Using the data-quality flags produced by the JWST Calibration Pipeline, we replaced any pixels identified as bad, saturated, dead, hot, low quantum efficiency or no gain value with the median value of surrounding pixels. We also searched each integration for pixels that were spatial outliers from the median of the surrounding 20 pixels in the same row by 6σ (to remove permanently affected 'bad' pixels) or outliers from the median of that pixel in the surrounding ten integrations in time by 20σ (to identify high-energy short-term effects such as cosmic rays) and replaced the outliers with the median values. To obtain the trace position and FWHM, we fitted a Gaussian to each column of an integration, finding a median standard deviation of 0.7 pixels. A fourth-order polynomial was fitted through the trace centres and the widths, which were smoothed with a median filter, to obtain a simple aperture region. This region extended 5 times the FWHM of the spectral trace, above and below the centre, corresponding to a median aperture width of 7 pixels. To remove any remaining 1/f and background noise from each integration, we subtracted the median of the unilluminated region in each column by masking all pixels that were 5 pixels away from the aperture. For each integration, the counts in each row and column of the aperture region were summed using an intrapixel extraction, taking the relevant fractional flux of the pixels at the edge of the aperture and cross-correlated to produce x-pixel and y-pixel shifts for detrending (see Extended Data Fig. 2). On average, the x-pixel shift represents movement of 1 × 10 -4 and 8 × 10 -6 of a pixel for NRS1 and NRS2, respectively. The aperture column sums resulted in 1D stellar spectra with errors calculated from photon noise after converting from data numbers using the gain factor. This reduction is denoted hereafter as ExoTiC-JEDI [V1].</p>
        <p>We produced further 1D stellar spectra from both the custom group-level destriped product and custom bias-subtracted group-level destriped products using the ExoTiC-JEDI pipeline as described above, but with further cleaning by repeating the spatial outliers step. The reduction with further cleaning using the custom group-level destriped products is hence denoted as ExoTiC-JEDI [V2] and the reduction with further cleaning using the custom bias-subtracted group-level destriped products is hence denoted as ExoTiC-JEDI [V3].We produced further 1D stellar spectra from both the custom group-level destriped product and custom bias-subtracted group-level destriped products using the ExoTiC-JEDI pipeline as described above, but with further cleaning by repeating the spatial outliers step. The reduction with further cleaning using the custom group-level destriped products is hence denoted as ExoTiC-JEDI [V2] and the reduction with further cleaning using the custom bias-subtracted group-level destriped products is hence denoted as ExoTiC-JEDI [V3].</p>
        <p>
            <rs type="software">Tiberius pipeline</rs>. We used the 
            <rs type="software">Tiberius pipeline</rs>, which builds on the LRG-BEASTS spectral reduction and analysis pipelines 15,46,47 , on our custom group-level destriped products. For each detector, we created bad-pixel masks by manually identifying hot pixels in the data. We then combined them with pixels flagged as greater than 3σ above the defined background. Before identifying the spectral trace, we interpolated each column of the detectors onto a grid 10 times finer than the initial spatial resolution. This step reduces the noise in the extracted data by improving the extraction of flux at the sub-pixel level, particularly where the edges of the photometric aperture bisect a pixel. We also interpolated over the bad pixels using their nearest-neighbouring pixels in x and y.
        </p>
        <p>We traced the spectra by fitting Gaussians at each column and used a running median, calculated with a moving box with a width of five data points, to smooth the measured centres of the trace. We fitted these smoothed centres with a fourth-order polynomial, removed points that deviated from the median by 3σ and refitted with a fourth-order polynomial. To remove any residual background flux not captured by the group-level destriping, we fitted a linear polynomial along each column, masking the stellar spectrum. This was defined by an aperture with a width of 4 pixels centred on the trace. We also masked an extra 7 pixels on either side of the aperture so that the background was not fitting the wings of the stellar PSF and we clipped any pixels in the background that deviated by more than 3σ from the mean for that particular column and frame. After removing the background in each column, the stellar spectra were then extracted by summing within a 4-pixel-wide aperture and correcting for pixel oversampling caused by the interpolation onto a finer grid, as described above. The uncertainties in the stellar spectra were calculated from the photon noise before background subtraction. transitspectroscopy pipeline. We used the transitspectroscopy pipeline 48 on the 'rateints' products of the JWST Calibration Pipeline, treating each detector separately. The trace position was found from the median integration by cross-correlating each column with a Gaussian function, removing outliers using a median filter with a 10-pixel-wide window and smoothing the trace with a spline. We removed 1/f noise from the 'rateints' products by masking all pixels within 10 pixels from the centre of the trace and calculating and removing the median value from all columns. We then used optimal extraction 49 to obtain the 1D stellar spectra, with a 5-pixel-wide aperture above and below the trace. This allowed us to treat bad pixels and cosmic rays that had not been accounted for or masked in the 'rateints' products in an automated fashion. To monitor systematic trends in the observations, we also calculated the trace centre as described above and the FWHM for all integrations. The FWHM was calculated at each column and at each integration by first subtracting each column to half the maximum value in it, with a spline used to interpolate the profile. The roots of this profile were then found to estimate the FWHM.We traced the spectra by fitting Gaussians at each column and used a running median, calculated with a moving box with a width of five data points, to smooth the measured centres of the trace. We fitted these smoothed centres with a fourth-order polynomial, removed points that deviated from the median by 3σ and refitted with a fourth-order polynomial. To remove any residual background flux not captured by the group-level destriping, we fitted a linear polynomial along each column, masking the stellar spectrum. This was defined by an aperture with a width of 4 pixels centred on the trace. We also masked an extra 7 pixels on either side of the aperture so that the background was not fitting the wings of the stellar PSF and we clipped any pixels in the background that deviated by more than 3σ from the mean for that particular column and frame. After removing the background in each column, the stellar spectra were then extracted by summing within a 4-pixel-wide aperture and correcting for pixel oversampling caused by the interpolation onto a finer grid, as described above. The uncertainties in the stellar spectra were calculated from the photon noise before background subtraction. transitspectroscopy pipeline. We used the transitspectroscopy pipeline 48 on the 'rateints' products of the JWST Calibration Pipeline, treating each detector separately. The trace position was found from the median integration by cross-correlating each column with a Gaussian function, removing outliers using a median filter with a 10-pixel-wide window and smoothing the trace with a spline. We removed 1/f noise from the 'rateints' products by masking all pixels within 10 pixels from the centre of the trace and calculating and removing the median value from all columns. We then used optimal extraction 49 to obtain the 1D stellar spectra, with a 5-pixel-wide aperture above and below the trace. This allowed us to treat bad pixels and cosmic rays that had not been accounted for or masked in the 'rateints' products in an automated fashion. To monitor systematic trends in the observations, we also calculated the trace centre as described above and the FWHM for all integrations. The FWHM was calculated at each column and at each integration by first subtracting each column to half the maximum value in it, with a spline used to interpolate the profile. The roots of this profile were then found to estimate the FWHM.</p>
        <p>Eureka! pipeline. We used two customized versions of the Eureka! pipeline 50 , which combines standard steps from the JWST Calibration Pipeline with an optimal extraction scheme to obtain the time series of stellar spectra.Eureka! pipeline. We used two customized versions of the Eureka! pipeline 50 , which combines standard steps from the JWST Calibration Pipeline with an optimal extraction scheme to obtain the time series of stellar spectra.</p>
        <p>The first Eureka! reduction used our custom group-level destriped products and applied Stages 2 and 3 of Eureka! Stage 2, a wrapper of the JWST Calibration Pipeline, followed the default settings up to the flat fielding and photometric calibration steps, which were both skipped. Stage 3 of Eureka! was then used to perform the background subtraction and extraction of the 1D stellar spectra. We started by correcting for the curvature of NIRSpec G395H spectra by shifting the detector columns by whole pixels, to bring the peak of the distribution of the counts in each column to the centre of our subarray. To ensure that this curvature correction was smooth, we computed the shifts in each column for each integration from the median integration frame in each segment and applied a running median to the shifts obtained for each column. The pixel shifts were applied with periodic boundary conditions, such that pixels shifted upwards from the top of the subarray appeared at the bottom after the correction, ensuring no pixels were lost. We applied a column-by-column background subtraction by fitting and subtracting a flat line to each column of the curvature-corrected data frames, obtained by fitting all pixels further than six pixels from the central row. We also performed a double iteration of outlier rejection in time with a threshold of 10σ, along with a 3σ spatial outlier-rejection routine, to ensure that bad pixels were not biasing our background correction. These outlier-rejection thresholds were selected to remove clear outliers in the data and provide a balance with the background subtraction step. We performed optimal extraction using an extraction profile defined from the median frame, the central nine rows of our subarray (four rows on either side of the central row). We also measured the vertical shift in pixels of the spectrum from one integration to the other using cross-correlation and the average PSF width at each integration, obtained by adding all columns together and fitting a Gaussian to the profile to estimate its width. This reduction is henceforth denoted as Eureka! [V1].The first Eureka! reduction used our custom group-level destriped products and applied Stages 2 and 3 of Eureka! Stage 2, a wrapper of the JWST Calibration Pipeline, followed the default settings up to the flat fielding and photometric calibration steps, which were both skipped. Stage 3 of Eureka! was then used to perform the background subtraction and extraction of the 1D stellar spectra. We started by correcting for the curvature of NIRSpec G395H spectra by shifting the detector columns by whole pixels, to bring the peak of the distribution of the counts in each column to the centre of our subarray. To ensure that this curvature correction was smooth, we computed the shifts in each column for each integration from the median integration frame in each segment and applied a running median to the shifts obtained for each column. The pixel shifts were applied with periodic boundary conditions, such that pixels shifted upwards from the top of the subarray appeared at the bottom after the correction, ensuring no pixels were lost. We applied a column-by-column background subtraction by fitting and subtracting a flat line to each column of the curvature-corrected data frames, obtained by fitting all pixels further than six pixels from the central row. We also performed a double iteration of outlier rejection in time with a threshold of 10σ, along with a 3σ spatial outlier-rejection routine, to ensure that bad pixels were not biasing our background correction. These outlier-rejection thresholds were selected to remove clear outliers in the data and provide a balance with the background subtraction step. We performed optimal extraction using an extraction profile defined from the median frame, the central nine rows of our subarray (four rows on either side of the central row). We also measured the vertical shift in pixels of the spectrum from one integration to the other using cross-correlation and the average PSF width at each integration, obtained by adding all columns together and fitting a Gaussian to the profile to estimate its width. This reduction is henceforth denoted as Eureka! [V1].</p>
        <p>The second Eureka! reduction (Eureka! [V2]) used the 'rateints' outputs of the JWST Calibration Pipeline and applied Stage 2 of Eureka! as described above, with a modified version of Stage 3. In this reduction, we corrected the curvature of the trace using a spline and found the centre of the trace using the median of each column. We removed 1/f noise by subtracting the mean from each column, excluding the region 6 pixels away from the trace, sigma-clipping outliers at 3σ. We extracted the 1D stellar spectra using a 4-pixel-wide aperture on either side of the trace centre.The second Eureka! reduction (Eureka! [V2]) used the 'rateints' outputs of the JWST Calibration Pipeline and applied Stage 2 of Eureka! as described above, with a modified version of Stage 3. In this reduction, we corrected the curvature of the trace using a spline and found the centre of the trace using the median of each column. We removed 1/f noise by subtracting the mean from each column, excluding the region 6 pixels away from the trace, sigma-clipping outliers at 3σ. We extracted the 1D stellar spectra using a 4-pixel-wide aperture on either side of the trace centre.</p>
        <p>Limb-darkening is a function of the physical structure of the star that results in variations in the specific intensity of the light from the centre of the star to the limb, such that the limb looks darker than the centre. This is because of the change in depth of the stellar atmosphere being observed. At the limb of the star, the region of the atmosphere being observed at slant geometry is at higher altitudes and lower density, and thus lower temperatures, compared with the deeper atmosphere observed at the centre of the star, at which hotter, denser layers are observed. The effect of limb-darkening is most prominent at shorter wavelengths, resulting in a more U-shaped light curve compared with the flat-bottomed light curves observed at longer wavelengths. To account for the effects of limb-darkening on the time-series light curves, we used analytical approximations for computing the ratio of the mean intensity to the central intensity of the star. The most commonly used limb-darkening laws for exoplanet transit light curves are the quadratic, square-root and nonlinear four-parameter laws 51 : Quadratic:Limb-darkening is a function of the physical structure of the star that results in variations in the specific intensity of the light from the centre of the star to the limb, such that the limb looks darker than the centre. This is because of the change in depth of the stellar atmosphere being observed. At the limb of the star, the region of the atmosphere being observed at slant geometry is at higher altitudes and lower density, and thus lower temperatures, compared with the deeper atmosphere observed at the centre of the star, at which hotter, denser layers are observed. The effect of limb-darkening is most prominent at shorter wavelengths, resulting in a more U-shaped light curve compared with the flat-bottomed light curves observed at longer wavelengths. To account for the effects of limb-darkening on the time-series light curves, we used analytical approximations for computing the ratio of the mean intensity to the central intensity of the star. The most commonly used limb-darkening laws for exoplanet transit light curves are the quadratic, square-root and nonlinear four-parameter laws 51 : Quadratic:</p>
        <p>Square-root:Square-root:</p>
        <p>Nonlinear four-parameter: The limb-darkening coefficients depend on the particular stellar atmosphere and therefore vary from star to star. For consistency across all of the light-curve fitting, we used 3D stellar models 52 for T eff = 5,512 K, log(g) = 4.47 cgs and Fe/H = 0.0, along with the instrument throughput to determine I and μ. As instrument commissioning showed that the throughput was higher than the pre-mission expectations 53 , a custom throughput was produced from the median of the measured ExoTiC-JEDI [V2] stellar spectra, divided by the stellar model and Gaussian smoothed.Nonlinear four-parameter: The limb-darkening coefficients depend on the particular stellar atmosphere and therefore vary from star to star. For consistency across all of the light-curve fitting, we used 3D stellar models 52 for T eff = 5,512 K, log(g) = 4.47 cgs and Fe/H = 0.0, along with the instrument throughput to determine I and μ. As instrument commissioning showed that the throughput was higher than the pre-mission expectations 53 , a custom throughput was produced from the median of the measured ExoTiC-JEDI [V2] stellar spectra, divided by the stellar model and Gaussian smoothed.</p>
        <p>For the limb-darkening coefficients that were held fixed, we used the values computed using the 
            <rs type="software">ExoTiC-LD</rs> 54,55 package, which can compute the linear, quadratic and three-parameter and four-parameter nonlinear limb-darkening coefficients 51,56 . To compute and fit for the coefficients from the square-root law, we used previously outlined formalisms 57,58 . We highlight that we do not see any dependence in our transmission spectra on the limb-darkening procedure used across our independent reductions and analyses.
        </p>
        <p>From the time series of extracted 1D stellar spectra, we created our broadband transit light curves by summing the flux over 2.725-3.716 μm for NRS1 and 3.829-5.172 μm for NRS2. For the spectroscopic light curves, we used a common 10-pixel binning scheme within these wavelength ranges to generate a total of 349 spectroscopic bins (146 for NRS1 and 203 for NRS2). We also tested wider and narrower binning schemes but found that 10-pixel-wide bins achieved the best compromise between the noise in the spectrum and showcasing the abilities of G395H across analyses. In our analyses, we treated the NRS1 and NRS2 light curves independently to account for differing systematics across the two detectors. To construct the full NIRSpec G395H transmission spectrum of WASP-39b, we fitted the NRS1 and NRS2 broadband and spectroscopic light curves using 11 independent light-curve-fitting codes, which are detailed below. When starting values were required, all analyses used the same system parameters 37 . In many of our analyses, we detrended the raw broadband and spectroscopic light curves using the time-dependent decorrelation parameters for the change in the FWHM of the spectral trace or the shift in x-pixel and y-pixel positions (Extended Data Fig. 2). We also used various approaches to account for the mirror-tilt event, which we found to have a smaller effect at longer wavelengths (Extended Data Fig. 3).From the time series of extracted 1D stellar spectra, we created our broadband transit light curves by summing the flux over 2.725-3.716 μm for NRS1 and 3.829-5.172 μm for NRS2. For the spectroscopic light curves, we used a common 10-pixel binning scheme within these wavelength ranges to generate a total of 349 spectroscopic bins (146 for NRS1 and 203 for NRS2). We also tested wider and narrower binning schemes but found that 10-pixel-wide bins achieved the best compromise between the noise in the spectrum and showcasing the abilities of G395H across analyses. In our analyses, we treated the NRS1 and NRS2 light curves independently to account for differing systematics across the two detectors. To construct the full NIRSpec G395H transmission spectrum of WASP-39b, we fitted the NRS1 and NRS2 broadband and spectroscopic light curves using 11 independent light-curve-fitting codes, which are detailed below. When starting values were required, all analyses used the same system parameters 37 . In many of our analyses, we detrended the raw broadband and spectroscopic light curves using the time-dependent decorrelation parameters for the change in the FWHM of the spectral trace or the shift in x-pixel and y-pixel positions (Extended Data Fig. 2). We also used various approaches to account for the mirror-tilt event, which we found to have a smaller effect at longer wavelengths (Extended Data Fig. 3).</p>
        <p>Using fitting pipeline 1, we measured a centre of transit time (T 0 ) of T 0 = 2,459,791.612039 ± 0.000017 BJD TDB and T 0 = 2,459,791.6120689 ± 0.000021 BJD TDB computed from the NRS1 and NRS2 broadband light curves, respectively; most of the fitting pipelines obtained T 0 within 1σ of the quoted uncertainty.Using fitting pipeline 1, we measured a centre of transit time (T 0 ) of T 0 = 2,459,791.612039 ± 0.000017 BJD TDB and T 0 = 2,459,791.6120689 ± 0.000021 BJD TDB computed from the NRS1 and NRS2 broadband light curves, respectively; most of the fitting pipelines obtained T 0 within 1σ of the quoted uncertainty.</p>
        <p>For each of our analyses, we computed the expected photon noise from the raw counts taking into account the instrument read noise (16.18 e -on NRS1 and 17.75 e -on NRS2), gain (1.42 for NRS1 and 1.62 for NRS2) and the background counts (which are found to be negligible after cleaning) and compared it to the final signal-to-noise ratio in our light curves (see Fig. 1). We also determine the level of white and red noise in our spectroscopic light curves by computing the Allan deviation 59 , which is used to measure the deviation from the expected photon noise by binning the data into successively smaller bins (that is, fewer data points per bin) and calculating the signal-to-noise ratio achieved 60 . Extended Data Fig. 4 shows the Allan deviation for three of the 11 reductions performed on the data (see the ExoTiC-ISM noise_calculator function 54 ).For each of our analyses, we computed the expected photon noise from the raw counts taking into account the instrument read noise (16.18 e -on NRS1 and 17.75 e -on NRS2), gain (1.42 for NRS1 and 1.62 for NRS2) and the background counts (which are found to be negligible after cleaning) and compared it to the final signal-to-noise ratio in our light curves (see Fig. 1). We also determine the level of white and red noise in our spectroscopic light curves by computing the Allan deviation 59 , which is used to measure the deviation from the expected photon noise by binning the data into successively smaller bins (that is, fewer data points per bin) and calculating the signal-to-noise ratio achieved 60 . Extended Data Fig. 4 shows the Allan deviation for three of the 11 reductions performed on the data (see the ExoTiC-ISM noise_calculator function 54 ).</p>
        <p>Although there is a general consensus across each of the data analyses, by comparing the results of each fitting pipeline, we were better able to evaluate the impact of different approaches to the data reduction, such as the removal of bad pixels. For future studies, we recommend the application of several pipelines that use differing analysis methods, such as the treatment of limb-darkening, systematic effects and noise removal. No single pipeline presented on its own can fully evaluate the measured impact of each effect, given the differing strategies, targets and potential for chance events such as a mirror tilt with each observation. In particular, attention should be paid to 1/f noise removal at the group versus integration levels for observations with fewer groups per integration than this study.Although there is a general consensus across each of the data analyses, by comparing the results of each fitting pipeline, we were better able to evaluate the impact of different approaches to the data reduction, such as the removal of bad pixels. For future studies, we recommend the application of several pipelines that use differing analysis methods, such as the treatment of limb-darkening, systematic effects and noise removal. No single pipeline presented on its own can fully evaluate the measured impact of each effect, given the differing strategies, targets and potential for chance events such as a mirror tilt with each observation. In particular, attention should be paid to 1/f noise removal at the group versus integration levels for observations with fewer groups per integration than this study.</p>
        <p>Below, we detail each of our 11 fitting pipelines and summarise them in Extended Data Table 1.Below, we detail each of our 11 fitting pipelines and summarise them in Extended Data Table 1.</p>
        <p>Fitting pipeline 1: ExoTiC-JEDI. We fitted the broadband and spectroscopic light curves produced from the ExoTIC-JEDI [V3] stellar spectra using the least-squares optimizer, 
            <rs type="software">scipy.optimize lm</rs> (ref. 61 ). We simultaneously fitted a batman transit model 62 with a constant baseline and systematics models for data pre-tilt and post-tilt event, fixing the centre of transit time T 0 , the ratio of the semi-major axis to stellar radius a/R ⋆ and the inclination i to the broadband light-curve best-fit values. The systematics models included a linear regression on x and y, for which x and y are the measured trace positions in the dispersion and cross-dispersion directions, respectively. We accounted for the tilt event by normalizing the light curve pre-tilt by the median pre-transit flux and normalizing the light curve post-tilt by the median post-transit flux. We discarded the first 15 integrations and the three integrations during the tilt event. Fourteen-pixel columns were discarded owing to outlier pixels directly on the trace. We fixed the limb-darkening coefficients to the four-parameter nonlinear law.
        </p>
        <p>Fitting pipeline 2: Tiberius. We used the broadband light curves generated from the Tiberius stellar spectra and fitted for the ratio of the planet to stellar radii R p /R ⋆ , as well as i, T 0 , a/R ⋆ , the quadratic law limb-darkening coefficient u 1 and the systematics model parameters, the x-pixel and y-pixel shifts, FWHM and sky background, with the period P, the eccentricity e and u 2 fixed. We used uniform priors for all the fitted parameters. Our analytic transit light-curve model was generated with batman. We fitted our broadband light curve with a transit + systematics model using a Gaussian process (GP) 63,64 , implemented through 
            <rs type="software">george</rs> 65 , and a Markov chain Monte Carlo method, implemented through 
            <rs type="software">emcee</rs> 66 . For our Tiberius spectroscopic light curves, we held a/R ⋆ , i and T 0 fixed to the values determined from the broadband light-curve fits and applied a systematics correction from the broadband light-curve fit to aid in fitting the mirror-tilt event. We fitted the spectroscopic light curves using a GP with an exponential squared kernel for the same systematics detrending parameters detailed above. We used a Gaussian prior for a/R ⋆ and uniform priors for all other fitted parameters.
        </p>
        <p>Fitting pipeline 3: Aesop. We used transit light curves from the ExoTiC-JEDI [V1] stellar spectra and fit the broadband and spectroscopic light curves using the least-squares minimizer LMFIT 67 . We fitted each light curve with a two-component function consisting of a transit model (generated using batman) multiplied by a systematics model. Our systematics model included the x-pixel and y-pixel positions on the detector (x, y, xy, x 2 and y 2 ). To capture the amplitude of the tilt event in our systematics model, we carried out piecewise linear regression on the out-of-transit baseline pre-tilt and post-tilt. We first fit the broadband light curve by fixing P and e and fitting for T 0 , a/R ⋆ , i, R p /R ⋆ , stellar baseline flux and systematic trends using wide uniform priors. For the spectroscopic light curves, we fixed T 0 , a/R ⋆ and i to the best-fit values from the broadband light curve and fit for R p /R ⋆ . We held the nonlinear limb-darkening coefficients fixed.Fitting pipeline 3: Aesop. We used transit light curves from the ExoTiC-JEDI [V1] stellar spectra and fit the broadband and spectroscopic light curves using the least-squares minimizer LMFIT 67 . We fitted each light curve with a two-component function consisting of a transit model (generated using batman) multiplied by a systematics model. Our systematics model included the x-pixel and y-pixel positions on the detector (x, y, xy, x 2 and y 2 ). To capture the amplitude of the tilt event in our systematics model, we carried out piecewise linear regression on the out-of-transit baseline pre-tilt and post-tilt. We first fit the broadband light curve by fixing P and e and fitting for T 0 , a/R ⋆ , i, R p /R ⋆ , stellar baseline flux and systematic trends using wide uniform priors. For the spectroscopic light curves, we fixed T 0 , a/R ⋆ and i to the best-fit values from the broadband light curve and fit for R p /R ⋆ . We held the nonlinear limb-darkening coefficients fixed.</p>
        <p>Fitting pipeline 4: transitspectroscopy. We fit the broadband and spectroscopic light curves produced from the transitspectroscopy stellar spectra, running juliet 68 in parallel with the light-curve-fitting module of the transitspectroscopy pipeline 48 with dynamic nested sampling through dynesty 69 and analytical transit models computed using batman. We fit the broadband light curves for NRS1 and NRS2 individually, fixing P, e and ω and fitting for the impact parameter b, as well as T 0 , a/R ⋆ , R p /R ⋆ , extra jitter and the mean out-of-transit flux. We also fitted two linear regressors, a simple slope and a 'jump' (a regressor with zeros before the tilt event and ones after the tilt event), scaled to fit the data. We fitted the square-root-law limb-darkening coefficients using the Kipping sampling scheme. We fitted the spectroscopic light curves at the native resolution of the instrument, fixing T 0 , a/R ⋆ and b. We used the broadband light-curve systematics model for the spectroscopic light curve, with wide uniform priors for each wavelength bin, and set truncated normal priors for the square-root-law limb-darkening coefficients. We also fitted a jitter term added in quadrature to the error bars at each wavelength with a log-uniform prior between 10 and 1,000 ppm. We computed the mean of the limb-darkening coefficients by first computing the nonlinear coefficients from ATLAS models 70 and passing them through the SPAM algorithm 71 . We binned the data into 10-pixel-wavelength bins after fitting the native-resolution light curves.Fitting pipeline 4: transitspectroscopy. We fit the broadband and spectroscopic light curves produced from the transitspectroscopy stellar spectra, running juliet 68 in parallel with the light-curve-fitting module of the transitspectroscopy pipeline 48 with dynamic nested sampling through dynesty 69 and analytical transit models computed using batman. We fit the broadband light curves for NRS1 and NRS2 individually, fixing P, e and ω and fitting for the impact parameter b, as well as T 0 , a/R ⋆ , R p /R ⋆ , extra jitter and the mean out-of-transit flux. We also fitted two linear regressors, a simple slope and a 'jump' (a regressor with zeros before the tilt event and ones after the tilt event), scaled to fit the data. We fitted the square-root-law limb-darkening coefficients using the Kipping sampling scheme. We fitted the spectroscopic light curves at the native resolution of the instrument, fixing T 0 , a/R ⋆ and b. We used the broadband light-curve systematics model for the spectroscopic light curve, with wide uniform priors for each wavelength bin, and set truncated normal priors for the square-root-law limb-darkening coefficients. We also fitted a jitter term added in quadrature to the error bars at each wavelength with a log-uniform prior between 10 and 1,000 ppm. We computed the mean of the limb-darkening coefficients by first computing the nonlinear coefficients from ATLAS models 70 and passing them through the SPAM algorithm 71 . We binned the data into 10-pixel-wavelength bins after fitting the native-resolution light curves.</p>
        <p>Fitting pipeline 5: ExoTEP. We fitted the transit light curves from the Eureka! [V1] stellar spectra using the 
            <rs type="software">ExoTEP</rs> analysis framework [72][73][74][75] . 
            <rs type="software">ExoTEP</rs> uses batman to generate analytical light-curve models, adds an analytical instrument systematics model along with a photometric scatter parameter and fits for the best-fit parameters and their uncertainties using emcee. Before fitting, we cleaned the light curves by running ten iterations of 5σ clipping using a running median of window length 20 on the flux, x-pixel and y-pixel shifts and the 'ydriftwidth' data product from Eureka! Stage 3 (the average spatial PSF width at each integration). Our systematics model consisted of a linear trend in time with a 'jump' (constant offset) after the tilt event. The 'ydriftwidth' was used before the fit to locate the tilt event. We used a running median of 'ydriftwidth' to search for the largest offset and flagged every data point after the tilt event so that they would receive a constant 'jump' offset in our systematics model. We also removed the first point of the tilt event in our fits, as it was not captured by the 'jump' model. We fitted the broadband light curves, fitting for R p /R ⋆ , photometric scatter, T 0 , b, a/R ⋆ , the quadratic limb-darkening coefficients and the systematics model parameters (normalization constant, slope in time and constant 'jump' offset). We used uninformative flat priors on all the parameters. The orbital parameters were fixed to the best-fit broadband light curve values for the subsequent spectroscopic light-curve fits.
        </p>
        <p>Fitting pipeline 6. We fitted transit light curves from the ExoTiC-JEDI [V1] stellar spectra using a custom lmfit light-curve-fitting code. The final systematic detrending model included a batman analytical transit model multiplied by a systematics model consisting of a linear stellar baseline term, a linear term for the x-pixel and y-pixel shifts and an exponential ramp function. The tilt event was accounted for by decorrelating the light curves with the y-pixel shifts, using a (1 + constant × y-shift) term with the constant fitted for in each light curve. For the broadband light-curve fits, we fixed P and fitted for T 0 , i, R p /R ⋆ , a/R ⋆ , x-pixel and y-pixel shifts and the exponential ramp amplitude and timescale. We fixed the nonlinear limb-darkening coefficients. For the spectroscopic light-curve fits, we fixed the values of T 0 , i and a/R ⋆ and the exponential ramp timescale to the broadband light-curve-fit values, and fitted for R p /R ⋆ , the x-pixel and y-pixel shifts and the ramp amplitude. Wide, uniform priors were used on all the fitting parameters in both the broadband and spectroscopic light-curve fits.Fitting pipeline 6. We fitted transit light curves from the ExoTiC-JEDI [V1] stellar spectra using a custom lmfit light-curve-fitting code. The final systematic detrending model included a batman analytical transit model multiplied by a systematics model consisting of a linear stellar baseline term, a linear term for the x-pixel and y-pixel shifts and an exponential ramp function. The tilt event was accounted for by decorrelating the light curves with the y-pixel shifts, using a (1 + constant × y-shift) term with the constant fitted for in each light curve. For the broadband light-curve fits, we fixed P and fitted for T 0 , i, R p /R ⋆ , a/R ⋆ , x-pixel and y-pixel shifts and the exponential ramp amplitude and timescale. We fixed the nonlinear limb-darkening coefficients. For the spectroscopic light-curve fits, we fixed the values of T 0 , i and a/R ⋆ and the exponential ramp timescale to the broadband light-curve-fit values, and fitted for R p /R ⋆ , the x-pixel and y-pixel shifts and the ramp amplitude. Wide, uniform priors were used on all the fitting parameters in both the broadband and spectroscopic light-curve fits.</p>
        <p>Fitting pipeline 7. We fitted transit light curves from the Eureka! [V2] stellar spectra, using 
            <rs type="software">PyLightcurve</rs> (ref. 75 ) to generate the transit model with emcee as the sampler. We calculated the nonlinear four-parameter limb-darkening coefficients using ExoTHETyS (ref. 76 ), which relies on PHOENIX 2012-2013 stellar models 77,78 , and fixed these in our fits to the precomputed theoretical values. Our full transit + systematics model included a transit model multiplied by a second-order polynomial in the time domain. We accounted for the tilt event by subtracting the mean of the last 30 integrations of the pre-transit data from the mean of the first 30 integrations of the post-transit data, to account for the jump in flux, shifting the post-transit light curve upwards by the jump value. We fitted for the systematics (the parameters of the second-order polynomial), R p /R ⋆ and T 0 . We used uniform priors for all the fitted parameters. We adopted the root mean square of the out-of-transit data as the error bars for the light-curve data points to account for the scatter in the data.
        </p>
        <p>Fitting pipeline 8. We used the transit light curves generated from the ExoTiC-JEDI [V1] stellar spectra. We fit the broadband light curves with a batman transit model multiplied by a second-order systematics model as a function of x-pixel and y-pixel shifts. We fixed both of the quadratic limb-darkening coefficients for each wavelength bin. We fitted for R p /R ⋆ , i, T 0 and a/R ⋆ , using wide uninformed priors, and ran our fits using emcee. For the spectroscopic light-curve fits, we fixed i and a/R ⋆ to the broadband light-curve best-fit values and fitted for an extra error term added in quadrature.Fitting pipeline 8. We used the transit light curves generated from the ExoTiC-JEDI [V1] stellar spectra. We fit the broadband light curves with a batman transit model multiplied by a second-order systematics model as a function of x-pixel and y-pixel shifts. We fixed both of the quadratic limb-darkening coefficients for each wavelength bin. We fitted for R p /R ⋆ , i, T 0 and a/R ⋆ , using wide uninformed priors, and ran our fits using emcee. For the spectroscopic light-curve fits, we fixed i and a/R ⋆ to the broadband light-curve best-fit values and fitted for an extra error term added in quadrature.</p>
        <p>Fitting pipeline 9. We used the transit light curves from the ExoTiC-JEDI [V1] stellar spectra. We fixed both of the quadratic limb-darkening coefficients and fitted the light curves with a batman transit model multiplied by a systematics model of a second-order function of x-pixel and y-pixel shifts. We fixed the best-fit broadband light-curve values for T 0 , a/R ⋆ and i for the spectroscopic light-curve fits and fitted for R p /R ⋆ using emcee for each 10-pixel bin, with the walkers initialized in a tight cluster around the best-fit solution from a Levenberg-Marquardt minimization. For both the broadband and spectroscopic light curves, we also fit for an extra per-point error term.Fitting pipeline 9. We used the transit light curves from the ExoTiC-JEDI [V1] stellar spectra. We fixed both of the quadratic limb-darkening coefficients and fitted the light curves with a batman transit model multiplied by a systematics model of a second-order function of x-pixel and y-pixel shifts. We fixed the best-fit broadband light-curve values for T 0 , a/R ⋆ and i for the spectroscopic light-curve fits and fitted for R p /R ⋆ using emcee for each 10-pixel bin, with the walkers initialized in a tight cluster around the best-fit solution from a Levenberg-Marquardt minimization. For both the broadband and spectroscopic light curves, we also fit for an extra per-point error term.</p>
        <p>Fitting pipeline 10. We fitted the transit light curves from the ExoTiC-JEDI [V2] stellar spectra and performed our model fitting using automatic differentiation implemented with JAX (ref. 79 ). We used a GP systematics model with a time-dependent Matérn (ν = 3/2) kernel and a variable white-noise jitter term. The mean function consists of a linear trend in time plus a sigmoid function to account for the drop in measured flux that occurred mid-transit owing to the mirror-tilt event. For the transit model, we used the exoplanet package 80 , making use of previously developed light-curve models 81,82 .Fitting pipeline 10. We fitted the transit light curves from the ExoTiC-JEDI [V2] stellar spectra and performed our model fitting using automatic differentiation implemented with JAX (ref. 79 ). We used a GP systematics model with a time-dependent Matérn (ν = 3/2) kernel and a variable white-noise jitter term. The mean function consists of a linear trend in time plus a sigmoid function to account for the drop in measured flux that occurred mid-transit owing to the mirror-tilt event. For the transit model, we used the exoplanet package 80 , making use of previously developed light-curve models 81,82 .</p>
        <p>For the GP systematics component, a generalization of the algorithm used by the celerite package 83 was adapted for JAX. We fixed both of the quadratic limb-darkening coefficients. For the initial broadband light-curve fit, both NRS1 and NRS2 were fitted simultaneously. All transit parameters were shared across both light curves, except for R p /R ⋆ , which was allowed to vary for NRS1 and NRS2 independently. We fitted for T 0 , the transit duration b and both R p /R ⋆ values. For the spectroscopic light-curve fits, all transit parameters were then fixed to the maximum-likelihood values determined from the broadband fit, except for R p /R ⋆ , which was allowed to vary for each wavelength bin. Uncertainties for the transit model parameters, including R p /R ⋆ , were assumed to be Gaussian and estimated using the Fisher information matrix at the location of the maximum-likelihood solution, which was computed exactly using the 
            <rs type="software">JAX</rs> automatic differentiation framework.
        </p>
        <p>Fitting pipeline 11: Eureka!. We used transit light curves from the Eureka! [V2] time-series stellar spectra with the open-source Eureka! code to estimate the best-fit transit parameters and their uncertainties using a Markov chain Monte Carlo method fit to the data (implemented by emcee). A linear trend in time was used as a systematics model and a step function was used to account for the tilt event. We fixed a/R ⋆ , i, T 0 and the time of the tilt event to the best-fit values from the NRS1 broadband light curve, with the three integrations during the tilt event clipped from the light curve. We fitted for R p /R ⋆ , both quadratic limb-darkening coefficients, the linear time trend and the magnitude of the step from the tilt event, with uniform priors for both the magnitude of the step and the limb-darkening coefficients.Fitting pipeline 11: Eureka!. We used transit light curves from the Eureka! [V2] time-series stellar spectra with the open-source Eureka! code to estimate the best-fit transit parameters and their uncertainties using a Markov chain Monte Carlo method fit to the data (implemented by emcee). A linear trend in time was used as a systematics model and a step function was used to account for the tilt event. We fixed a/R ⋆ , i, T 0 and the time of the tilt event to the best-fit values from the NRS1 broadband light curve, with the three integrations during the tilt event clipped from the light curve. We fitted for R p /R ⋆ , both quadratic limb-darkening coefficients, the linear time trend and the magnitude of the step from the tilt event, with uniform priors for both the magnitude of the step and the limb-darkening coefficients.</p>
        <p>On the basis of the independent light-curve fits described above, we produced 11 transmission spectra from our NIRSpec G395H observations using several analyses and fitting methods. Extended Data Table 1 shows a breakdown of the different steps used in each fitting pipeline. In this work, three different 2D spectral image products were used, producing seven different 1D stellar spectra. Eleven different fitting pipelines using five different limb-darkening methods were then applied. Each of these fitting pipelines resulted in an independent analysis of the observations and 11 comparative transmission spectra. Extended Data Fig. 5 details comparative information for all 11 analyses to quantify their similarities and differences.On the basis of the independent light-curve fits described above, we produced 11 transmission spectra from our NIRSpec G395H observations using several analyses and fitting methods. Extended Data Table 1 shows a breakdown of the different steps used in each fitting pipeline. In this work, three different 2D spectral image products were used, producing seven different 1D stellar spectra. Eleven different fitting pipelines using five different limb-darkening methods were then applied. Each of these fitting pipelines resulted in an independent analysis of the observations and 11 comparative transmission spectra. Extended Data Fig. 5 details comparative information for all 11 analyses to quantify their similarities and differences.</p>
        <p>We computed the standard deviation of the 11 spectra in each wavelength bin and compared this to the mean uncertainty obtained in that bin. The average standard deviation in each bin across all fitting pipelines was 199 ppm, compared with an average uncertainty of 221 ppm (which ranged from 131 to 625 ppm across the bins). The computed standard deviation in each bin across all pipelines ranged from 85 to 1,040 ppm, with greater than 98% of the bins having a standard deviation lower than 500 ppm. We see an increase in scatter at longer wavelengths, with the structure of the scatter following closely with the measured stellar flux, for which throughput beyond 3.8 μm combines with decreasing stellar flux. The unweighted mean uncertainty of all 11 transmission spectra follows a similar structure to the standard deviation, with the uncertainty increasing at longer wavelengths. The uncertainties from each fitting pipeline are consistent to within 3σ of each other, with the uncertainty per bin typically overestimated compared with the mean uncertainty across all reductions.We computed the standard deviation of the 11 spectra in each wavelength bin and compared this to the mean uncertainty obtained in that bin. The average standard deviation in each bin across all fitting pipelines was 199 ppm, compared with an average uncertainty of 221 ppm (which ranged from 131 to 625 ppm across the bins). The computed standard deviation in each bin across all pipelines ranged from 85 to 1,040 ppm, with greater than 98% of the bins having a standard deviation lower than 500 ppm. We see an increase in scatter at longer wavelengths, with the structure of the scatter following closely with the measured stellar flux, for which throughput beyond 3.8 μm combines with decreasing stellar flux. The unweighted mean uncertainty of all 11 transmission spectra follows a similar structure to the standard deviation, with the uncertainty increasing at longer wavelengths. The uncertainties from each fitting pipeline are consistent to within 3σ of each other, with the uncertainty per bin typically overestimated compared with the mean uncertainty across all reductions.</p>
        <p>From all 11 transmission spectra, we computed a weighted-average transmission spectrum using the transit depth values from all reductions in each bin weighted by 1/variance (1/σ 2 , in which σ is the uncertainty on the data point from each reduction). For this weighted-average transmission spectrum, the unweighted mean of the uncertainties in each bin was used to represent the error bar on each point. By using the weighted average of all 11 independently obtained transmission spectra, we therefore do not apply infinite weight to any one reduction in our interpretation of the atmosphere. Although the weighted average could be sensitive to any one spectrum with underestimated uncertainties, we find that our uncertainties are typically overestimated compared with the average. Similarly, we chose to use the mean rather than the median of the transmission spectral uncertainties, as this results in a more conservative estimate of the uncertainties in each bin. We find that all of the 11 transmission spectra are within 2.95σ of the weighted-average transmission spectrum without applying offsets.From all 11 transmission spectra, we computed a weighted-average transmission spectrum using the transit depth values from all reductions in each bin weighted by 1/variance (1/σ 2 , in which σ is the uncertainty on the data point from each reduction). For this weighted-average transmission spectrum, the unweighted mean of the uncertainties in each bin was used to represent the error bar on each point. By using the weighted average of all 11 independently obtained transmission spectra, we therefore do not apply infinite weight to any one reduction in our interpretation of the atmosphere. Although the weighted average could be sensitive to any one spectrum with underestimated uncertainties, we find that our uncertainties are typically overestimated compared with the average. Similarly, we chose to use the mean rather than the median of the transmission spectral uncertainties, as this results in a more conservative estimate of the uncertainties in each bin. We find that all of the 11 transmission spectra are within 2.95σ of the weighted-average transmission spectrum without applying offsets.</p>
        <p>We calculated normalized transmission spectrum residuals for each fitting pipeline by subtracting the weighted-average spectrum and dividing by the uncertainty in each bin. We generated histograms of the normalized transmission spectrum residuals and used the mean and standard deviation of the residuals to compute a normalized probability density function (PDF). We performed a Kolmogorov-Smirnov test on each of the normalized residuals and found that they are all approximately symmetric around their means, with normal distributions. This confirms that they are Gaussian in shape, with the null hypothesis that they are not Gaussian strongly rejected in the majority of cases (see Extended Data Fig. 5).We calculated normalized transmission spectrum residuals for each fitting pipeline by subtracting the weighted-average spectrum and dividing by the uncertainty in each bin. We generated histograms of the normalized transmission spectrum residuals and used the mean and standard deviation of the residuals to compute a normalized probability density function (PDF). We performed a Kolmogorov-Smirnov test on each of the normalized residuals and found that they are all approximately symmetric around their means, with normal distributions. This confirms that they are Gaussian in shape, with the null hypothesis that they are not Gaussian strongly rejected in the majority of cases (see Extended Data Fig. 5).</p>
        <p>The PDFs of the residuals indicate three distinct clusters of computed spectra based on their deviations from the mean and their spreads. The first cluster is negatively offset by less than 200 ppm and corresponds to fitting pipelines that used extracted stellar spectra and that underwent further cleaning steps (for example, ExoTiC-JEDI [V3]). The second cluster is positively offset from the mean by about 120 ppm and contains most of the transmission spectra produced. We see no obvious trends in this group to any specific reduction or fitting process. The final cluster is centred around the mean but has a broad distribution, suggesting a larger scatter both above and below the average transmission spectrum. This is probably the result of uncleaned outliers or marginal offsets between NRS1 and NRS2. These transmission spectra demonstrate that the 11 independent fitting pipelines are able to accurately reproduce the same transmission spectral feature structures, further highlighting the minimized impact of systematics on the time-series light curves. We suspect that the minor differences resulting from different reduction products and fitting pipelines are linked to the superbias and treatment of 1/f noise. We anticipate that the impacts of these will be improved with new superbias images, expected to be released soon by STScI, and with more detailed investigation into the impact of 1/f noise at the group level beyond the scope of this work.The PDFs of the residuals indicate three distinct clusters of computed spectra based on their deviations from the mean and their spreads. The first cluster is negatively offset by less than 200 ppm and corresponds to fitting pipelines that used extracted stellar spectra and that underwent further cleaning steps (for example, ExoTiC-JEDI [V3]). The second cluster is positively offset from the mean by about 120 ppm and contains most of the transmission spectra produced. We see no obvious trends in this group to any specific reduction or fitting process. The final cluster is centred around the mean but has a broad distribution, suggesting a larger scatter both above and below the average transmission spectrum. This is probably the result of uncleaned outliers or marginal offsets between NRS1 and NRS2. These transmission spectra demonstrate that the 11 independent fitting pipelines are able to accurately reproduce the same transmission spectral feature structures, further highlighting the minimized impact of systematics on the time-series light curves. We suspect that the minor differences resulting from different reduction products and fitting pipelines are linked to the superbias and treatment of 1/f noise. We anticipate that the impacts of these will be improved with new superbias images, expected to be released soon by STScI, and with more detailed investigation into the impact of 1/f noise at the group level beyond the scope of this work.</p>
        <p>To identify spectral absorption features, we compared the resulting weighted-average transmission spectrum of WASP-39b to several 1D RCTE atmosphere models from three independent model grids. Each forward model is computed on a set of common physical parameters (for example, metallicity, C/O ratio, internal temperature and heat redistribution), shown in Extended Data Table 2. Additionally, each model grid contains different prescriptions for treating certain physical effects (for example, scattering aerosols). Although each grid contains different opacity sources from varying line lists (see Extended Data Table 2), they each consider all of the main molecular and atomic species 84 . Each model transmission spectrum from the grids was binned to the same resolution as that of the observations to compute the χ 2 per data point, with a wavelength-independent transit depth offset as the free parameter. In general, the forward model grids fit the main features of the data but are unable to place statistically significant constraints on many of the atmospheric parameters, owing to both the finite nature of the forward model grid spacing 13 and the insensitivity of some of these parameters to the 3-5-μm transmission spectrum of WASP-39b (for example, &gt;100 K differences in interior temperature provided nearly identical χ 2 /N).To identify spectral absorption features, we compared the resulting weighted-average transmission spectrum of WASP-39b to several 1D RCTE atmosphere models from three independent model grids. Each forward model is computed on a set of common physical parameters (for example, metallicity, C/O ratio, internal temperature and heat redistribution), shown in Extended Data Table 2. Additionally, each model grid contains different prescriptions for treating certain physical effects (for example, scattering aerosols). Although each grid contains different opacity sources from varying line lists (see Extended Data Table 2), they each consider all of the main molecular and atomic species 84 . Each model transmission spectrum from the grids was binned to the same resolution as that of the observations to compute the χ 2 per data point, with a wavelength-independent transit depth offset as the free parameter. In general, the forward model grids fit the main features of the data but are unable to place statistically significant constraints on many of the atmospheric parameters, owing to both the finite nature of the forward model grid spacing 13 and the insensitivity of some of these parameters to the 3-5-μm transmission spectrum of WASP-39b (for example, &gt;100 K differences in interior temperature provided nearly identical χ 2 /N).</p>
        <p>ATMO. We used the ATMO RCTE grid [85][86][87][88] , which consists of model transmission spectra for different day-night energy redistribution factors, atmospheric metallicities, C/O ratios, haze factors and grey cloud factors with a range of line lists and pressure-broadening sources 88 . In total, there were 5,160 models. Within this grid, we find the best-fit model to have 3 times solar metallicity, with a C/O ratio of 0.35 and a grey cloud opacity 5 times the strength of H 2 Rayleigh scattering at 350 nm and a χ 2 /N = 1.098 for N = 344 data points and only fitting for an absolute altitude change in y.ATMO. We used the ATMO RCTE grid [85][86][87][88] , which consists of model transmission spectra for different day-night energy redistribution factors, atmospheric metallicities, C/O ratios, haze factors and grey cloud factors with a range of line lists and pressure-broadening sources 88 . In total, there were 5,160 models. Within this grid, we find the best-fit model to have 3 times solar metallicity, with a C/O ratio of 0.35 and a grey cloud opacity 5 times the strength of H 2 Rayleigh scattering at 350 nm and a χ 2 /N = 1.098 for N = 344 data points and only fitting for an absolute altitude change in y.</p>
        <p>PHOENIX. We calculated a grid of transmission spectra using the PHOENIX atmosphere model [89][90][91] , varying the heat redistribution of the planet, atmospheric metallicity, C/O ratio, internal temperature, the presence of aerosols and the atmospheric chemistry (equilibrium or rainout). Opacities used include the BT2 H 2 O line list 92 , as well as HITRAN for 129 other main molecular absorbers 93 and Kurucz and Bell data for atomic species 94 . The HITRAN line lists available in this version of PHOENIX are often complete only at room temperature, which may be the cause of the apparent shift in the CO 2 spectral feature compared with the other grids that primarily use HITEMP and ExoMol lists. This shift is the cause of the difference in χ 2 between PHOENIX and the other model grids. In total, there were 1,116 models. Within this grid, the best-fit model has 10 times solar metallicity, a C/O ratio of 0.3, an internal temperature of 400 K, rainout chemistry and a cloud deck top at 0.3 mbar. The best-fit model has a χ 2 /N = 1.203 for N = 344 data points. PICASO 3.0 and Virga. We used the open-source radiative-convective equilibrium model PICASO 3.0 (refs. 95,96 ), which has its heritage in the Fortran-based EGP mode 97,98 , to compute a grid of 1D pressure-temperature models for WASP-39b. The opacity sources included in PICASO 3.0 are listed in Extended Data Table 2. Of the 29 molecular opacity sources included, the line lists of notable molecules used were: H 2 O (ref. 99 ), CO 2 (ref. 100 ), CH 4 (ref. 101 ) and CO (ref. 102 ). The parameters varied in this grid of models include the interior temperature of the planet (T int ), atmospheric metallicity, C/O ratio and the dayside-to-nightside heat redistribution factor (see Extended Data Table 2), with correlated-k opacities 98,103 . In total, there were 192 cloud-free models. We include the effect of clouds in two ways. First, we post-processed the pressure-temperature profile using the cloud model Virga 95,104 , which follows from previously developed methodologies 38 , in which we included three condensable species (MnS, Na 2 S and MgSiO 3 ). Virga requires a vertical mixing parameter, K zz (cm 2 s -1 ), and a vertically constant sedimentation efficiency parameter, f sed . In general, f sed controls the vertical extent of the cloud opacity, with low values (f sed &lt; 1) creating large, vertically extended cloud decks with small particle sizes. In total, there were 3,840 cloudy models. The best fit from our grid with Virga-computed clouds has 3 times solar metallicity, solar C/O (0.458) and f sed = 0.6, which results in a χ 2 /N = 1.084.PHOENIX. We calculated a grid of transmission spectra using the PHOENIX atmosphere model [89][90][91] , varying the heat redistribution of the planet, atmospheric metallicity, C/O ratio, internal temperature, the presence of aerosols and the atmospheric chemistry (equilibrium or rainout). Opacities used include the BT2 H 2 O line list 92 , as well as HITRAN for 129 other main molecular absorbers 93 and Kurucz and Bell data for atomic species 94 . The HITRAN line lists available in this version of PHOENIX are often complete only at room temperature, which may be the cause of the apparent shift in the CO 2 spectral feature compared with the other grids that primarily use HITEMP and ExoMol lists. This shift is the cause of the difference in χ 2 between PHOENIX and the other model grids. In total, there were 1,116 models. Within this grid, the best-fit model has 10 times solar metallicity, a C/O ratio of 0.3, an internal temperature of 400 K, rainout chemistry and a cloud deck top at 0.3 mbar. The best-fit model has a χ 2 /N = 1.203 for N = 344 data points. PICASO 3.0 and Virga. We used the open-source radiative-convective equilibrium model PICASO 3.0 (refs. 95,96 ), which has its heritage in the Fortran-based EGP mode 97,98 , to compute a grid of 1D pressure-temperature models for WASP-39b. The opacity sources included in PICASO 3.0 are listed in Extended Data Table 2. Of the 29 molecular opacity sources included, the line lists of notable molecules used were: H 2 O (ref. 99 ), CO 2 (ref. 100 ), CH 4 (ref. 101 ) and CO (ref. 102 ). The parameters varied in this grid of models include the interior temperature of the planet (T int ), atmospheric metallicity, C/O ratio and the dayside-to-nightside heat redistribution factor (see Extended Data Table 2), with correlated-k opacities 98,103 . In total, there were 192 cloud-free models. We include the effect of clouds in two ways. First, we post-processed the pressure-temperature profile using the cloud model Virga 95,104 , which follows from previously developed methodologies 38 , in which we included three condensable species (MnS, Na 2 S and MgSiO 3 ). Virga requires a vertical mixing parameter, K zz (cm 2 s -1 ), and a vertically constant sedimentation efficiency parameter, f sed . In general, f sed controls the vertical extent of the cloud opacity, with low values (f sed &lt; 1) creating large, vertically extended cloud decks with small particle sizes. In total, there were 3,840 cloudy models. The best fit from our grid with Virga-computed clouds has 3 times solar metallicity, solar C/O (0.458) and f sed = 0.6, which results in a χ 2 /N = 1.084.</p>
        <p>As well as the grid fit, we also use the PICASO framework to quantify the feature-detection significance. In this method, we are able to incorporate clouds on the fly using the fitting routine 
            <rs type="software">PyMultiNest</rs> 105 . We fit for each of the grid parameters using a nearest-neighbour technique and a radius scaling to account for the unknown reference pressure, giving five parameters in total. When fitting for clouds, we either fit for K zz and f sed in the Virga framework (seven parameters in total) or we fit for the cloud-top pressure corresponding to a grey cloud deck with infinite opacity (six parameters in total). These results are described in the following section.
        </p>
        <p>From the chemical equilibrium results of the single best-fit models, the molecules that could potentially contribute to the spectrum based on their abundances and 3-5-μm opacity sources are H 2 and He (via continuum) and CO, H 2 O, H 2 S, CO 2 and CH 4 . More minor sources of opacity with VMR abundances &lt;1 ppm are molecules such as OCS and NH 3 . For example, removing H 2 S, NH 3 and OCS from the single best-fit PICASO 3.0 model increases the chi-square value by less than 0.002. Therefore, we focus on computing the statistical significance of only H 2 O, SO 2 , CO 2 , CH 4 and CO.From the chemical equilibrium results of the single best-fit models, the molecules that could potentially contribute to the spectrum based on their abundances and 3-5-μm opacity sources are H 2 and He (via continuum) and CO, H 2 O, H 2 S, CO 2 and CH 4 . More minor sources of opacity with VMR abundances &lt;1 ppm are molecules such as OCS and NH 3 . For example, removing H 2 S, NH 3 and OCS from the single best-fit PICASO 3.0 model increases the chi-square value by less than 0.002. Therefore, we focus on computing the statistical significance of only H 2 O, SO 2 , CO 2 , CH 4 and CO.</p>
        <p>To quantify the statistical significance, we performed two different tests. First, we used a Gaussian residual fitting analysis, as used in other JTEC ERS analyses 23,29,31 . In this method, we subtracted the best-fit model without a specific opacity source from the weighted-average spectrum of WASP-39b, isolating the supposed spectral feature. We then fit a three-parameter or four-parameter Gaussian curve to the residual data using a nested sampling algorithm to calculate the Bayesian evidence 106 . For H 2 O and CO, the extra transit depth offset parameter for the Gaussian fit was necessary to account for local mismatch of the fit to the continuum, whereas only a mean, standard deviation and scale parameter were required for a residual fit to the other molecules. We then compared this to the Bayesian evidence of a flat line to find the Bayes factor between a model that fits the spectral feature versus a model that excludes the spectral feature. These fits are shown in Extended Data Fig. 6.To quantify the statistical significance, we performed two different tests. First, we used a Gaussian residual fitting analysis, as used in other JTEC ERS analyses 23,29,31 . In this method, we subtracted the best-fit model without a specific opacity source from the weighted-average spectrum of WASP-39b, isolating the supposed spectral feature. We then fit a three-parameter or four-parameter Gaussian curve to the residual data using a nested sampling algorithm to calculate the Bayesian evidence 106 . For H 2 O and CO, the extra transit depth offset parameter for the Gaussian fit was necessary to account for local mismatch of the fit to the continuum, whereas only a mean, standard deviation and scale parameter were required for a residual fit to the other molecules. We then compared this to the Bayesian evidence of a flat line to find the Bayes factor between a model that fits the spectral feature versus a model that excludes the spectral feature. These fits are shown in Extended Data Fig. 6.</p>
        <p>Although the Gaussian residual fitting method is useful for quantifying the presence of potentially unknown spectral features, it cannot robustly determine the source of any given opacity. We therefore used the Bayesian fitting routine from 
            <rs type="software">PyMultiNest</rs> in the PICASO 3.0 framework to refit the grid parameters, while excluding the opacity contribution from the species in question. Then, we compared the significance of the molecule through a Bayes factor analysis 107 . Those values are shown in Extended Data Table 3.
        </p>
        <p>We find significant evidence (&gt;3σ) for H 2 O, CO 2 and SO 2 . In general, the two methods only agree well for molecules whose contribution has a Gaussian shape (that is, SO 2 and CO 2 ). For example, for CO 2 , we find decisive 28.5σ and 26.9σ detections for the Bayes factor and Gaussian analysis, respectively. Similarly, for H 2 O, we find 21.5σ and 16.5σ detections, respectively. The evidence for SO 2 is less substantial, but both methods give significant detections of 4.8σ and 3.5σ, respectively. Although the Gaussian fitting method found a broad 1-μm-wide residual in the region of CO (that is, &gt;4.5 μm), its shape was unlike that seen with the PRISM data 31 . CO remained undetected with the Bayesian fitting analysis and therefore we are unable to robustly confirm evidence of CO. Similarly, no evidence for CH 4 was found 23 . Gaussian residual fitting in the region of CH 4 absorption only found a very broad inverse Gaussian and so is not included in Extended Data Table 3.We find significant evidence (&gt;3σ) for H 2 O, CO 2 and SO 2 . In general, the two methods only agree well for molecules whose contribution has a Gaussian shape (that is, SO 2 and CO 2 ). For example, for CO 2 , we find decisive 28.5σ and 26.9σ detections for the Bayes factor and Gaussian analysis, respectively. Similarly, for H 2 O, we find 21.5σ and 16.5σ detections, respectively. The evidence for SO 2 is less substantial, but both methods give significant detections of 4.8σ and 3.5σ, respectively. Although the Gaussian fitting method found a broad 1-μm-wide residual in the region of CO (that is, &gt;4.5 μm), its shape was unlike that seen with the PRISM data 31 . CO remained undetected with the Bayesian fitting analysis and therefore we are unable to robustly confirm evidence of CO. Similarly, no evidence for CH 4 was found 23 . Gaussian residual fitting in the region of CH 4 absorption only found a very broad inverse Gaussian and so is not included in Extended Data Table 3.</p>
        <p>We performed an injection test with the PICASO best-fit model in the PyMultiNest fitting framework to determine the abundance of SO 2 required to match the observations. We add SO 2 opacity using the Exo-Mol line list 108 , without rerunning the RCTE model to self-consistently compute a new climate profile. Fitting for the cloud deck dynamically, without SO 2 , produces a single best estimate of 10 times solar metallicity, sub-solar C/O (0.229), resulting in a marginally worse χ 2 /N = 1.11. With SO 2 , the single best fit tends back to 3 times solar metallicity, solar C/O. This suggests that cloud treatment and the exclusion of spectrally active molecules have an effect on the resultant physical interpretation of bulk atmospheric parameters. Ultimately, if we fit for SO 2 in our PyMulti-Nest framework with the Virga cloud treatment, we obtain 3 times solar metallicity, solar C/O, log SO 2 = -5.6 ± 0.1 (SO 2 = 2.5 ± 0.65 ppm) and χ 2 /N = 1.02, which is our single best-fit model (shown in Fig. 4). For context, an atmospheric metallicity of 3-10 times solar would provide a thermochemical equilibrium abundance of 72-240 ppm H 2 S, the presumed source for photochemically produced SO 2 (ref. 36 ).We performed an injection test with the PICASO best-fit model in the PyMultiNest fitting framework to determine the abundance of SO 2 required to match the observations. We add SO 2 opacity using the Exo-Mol line list 108 , without rerunning the RCTE model to self-consistently compute a new climate profile. Fitting for the cloud deck dynamically, without SO 2 , produces a single best estimate of 10 times solar metallicity, sub-solar C/O (0.229), resulting in a marginally worse χ 2 /N = 1.11. With SO 2 , the single best fit tends back to 3 times solar metallicity, solar C/O. This suggests that cloud treatment and the exclusion of spectrally active molecules have an effect on the resultant physical interpretation of bulk atmospheric parameters. Ultimately, if we fit for SO 2 in our PyMulti-Nest framework with the Virga cloud treatment, we obtain 3 times solar metallicity, solar C/O, log SO 2 = -5.6 ± 0.1 (SO 2 = 2.5 ± 0.65 ppm) and χ 2 /N = 1.02, which is our single best-fit model (shown in Fig. 4). For context, an atmospheric metallicity of 3-10 times solar would provide a thermochemical equilibrium abundance of 72-240 ppm H 2 S, the presumed source for photochemically produced SO 2 (ref. 36 ).</p>
        <p>To confirm the plausibility of SO 2 absorption to explain the 4.1-μm spectral feature, we also computed models with prescribed, vertically uniform SO 2 VMRs of 0, 1, 5 and 10 ppm using the structure from the best-fit PHOENIX model (10 times solar metallicity, C/O = 0.3). We calculated ad hoc spectra using the 
            <rs type="software">gCMCRT</rs> radiative transfer code 109 with the ExoMol SO 2 line list 108 (see Extended Data Fig. 7). Linearly interpolating the models with respect to the SO 2 abundance and performing a Levenberg-Marquardt regression gave a best-fit value of 4.6 ± 0.67 ppm. Inserting this abundance of SO 2 into the best-fit PHOENIX model improves the χ 2 /N from 1.2 to 1.08.
        </p>
        <p>Future atmospheric retrievals can provide a more statistically robust measurement for the SO 2 abundance and add extra information from the similar absorption seen in the PRISM transmission spectrum 29,31 .Future atmospheric retrievals can provide a more statistically robust measurement for the SO 2 abundance and add extra information from the similar absorption seen in the PRISM transmission spectrum 29,31 .</p>
        <p>A 0.08-μm-wide bump in transit depth centred at 4.56 μm is not fit by any of the model grids. This feature, picked up by the resolution of G395H, is not clearly seen in other ERS observations of WASP-39b. Following the same Gaussian residual fitting procedure as described above, we found a feature significance of 3.3σ (see Extended Data Fig. 6). To identify possible opacity sources in the atmosphere of WASP-39b that might be the cause of this absorption, we compared the feature with CH 4 (ref. 110 ), C 2 H 2 (ref. 111 ), C 2 H 4 (ref. 112 ), C 2 H 6 (ref. 113 ), CO (ref. 114 ), CO 2 (ref. 100 ), CS 2 (ref. 113 ), CN (ref. 115 ), HCN (ref. 116 ), HCl (ref. 113 ), H 2 S (ref. 117 ), HF (ref. 118 ), H 3 + (ref. 119 ), LiCl (ref. 115 ), NH 3 (ref. 120 ), NO (ref. 114 ), NO 2 (ref. 113 ), N 2 O (ref. 114 ), N 2 (ref. 121 ), NaCl (ref. 122 ), OCS (ref. 113 ), PH 3 (ref. 123 ), PN (ref. 124 ), PO (ref. 125 ), SH (ref. 126 ), SiS (ref. 127 ), SiH 4 (ref. 128 ), SiO (ref. 129 ), the X-X state of SO (ref. 130 ), SO 2 (ref. 108 ), SO 3 (ref. 108 ) and isotopologues of H 2 O, CH 4 , CO 2 and CO, but did not find a convincing candidate that showed opacity at the correct wavelength or the correct width. The narrowness of the feature suggests that it could be a very distinct Q-branch, in which the rotational quantum number in the ground state is the same as the rotational quantum number in the excited state. However, of the molecules we explored, there were no candidates with a distinct Q-branch at this wavelength whose P-branch and R-branch did not obstruct the neighbouring CO 2 and continuum-like CO + H 2 O opacity.A 0.08-μm-wide bump in transit depth centred at 4.56 μm is not fit by any of the model grids. This feature, picked up by the resolution of G395H, is not clearly seen in other ERS observations of WASP-39b. Following the same Gaussian residual fitting procedure as described above, we found a feature significance of 3.3σ (see Extended Data Fig. 6). To identify possible opacity sources in the atmosphere of WASP-39b that might be the cause of this absorption, we compared the feature with CH 4 (ref. 110 ), C 2 H 2 (ref. 111 ), C 2 H 4 (ref. 112 ), C 2 H 6 (ref. 113 ), CO (ref. 114 ), CO 2 (ref. 100 ), CS 2 (ref. 113 ), CN (ref. 115 ), HCN (ref. 116 ), HCl (ref. 113 ), H 2 S (ref. 117 ), HF (ref. 118 ), H 3 + (ref. 119 ), LiCl (ref. 115 ), NH 3 (ref. 120 ), NO (ref. 114 ), NO 2 (ref. 113 ), N 2 O (ref. 114 ), N 2 (ref. 121 ), NaCl (ref. 122 ), OCS (ref. 113 ), PH 3 (ref. 123 ), PN (ref. 124 ), PO (ref. 125 ), SH (ref. 126 ), SiS (ref. 127 ), SiH 4 (ref. 128 ), SiO (ref. 129 ), the X-X state of SO (ref. 130 ), SO 2 (ref. 108 ), SO 3 (ref. 108 ) and isotopologues of H 2 O, CH 4 , CO 2 and CO, but did not find a convincing candidate that showed opacity at the correct wavelength or the correct width. The narrowness of the feature suggests that it could be a very distinct Q-branch, in which the rotational quantum number in the ground state is the same as the rotational quantum number in the excited state. However, of the molecules we explored, there were no candidates with a distinct Q-branch at this wavelength whose P-branch and R-branch did not obstruct the neighbouring CO 2 and continuum-like CO + H 2 O opacity.</p>
        <p>We also note that many of these species lack high-temperature line-list data, making it difficult to definitively rule out such species. For example, OCS, SO and CS 2 are available in HITRAN2020 (ref. 113 ) but not in ExoMol 131 . Furthermore, if photochemistry is important for WASP-39b, as indicated by the presence of SO 2 , then there may be many species out of equilibrium that may contribute to the transit spectrum, some of which do not have high-temperature opacity data at present (such as OCS, NH 2 or HSO). Future observations over this wavelength region of this and other planets may confirm or refute the presence of this unknown absorber.We also note that many of these species lack high-temperature line-list data, making it difficult to definitively rule out such species. For example, OCS, SO and CS 2 are available in HITRAN2020 (ref. 113 ) but not in ExoMol 131 . Furthermore, if photochemistry is important for WASP-39b, as indicated by the presence of SO 2 , then there may be many species out of equilibrium that may contribute to the transit spectrum, some of which do not have high-temperature opacity data at present (such as OCS, NH 2 or HSO). Future observations over this wavelength region of this and other planets may confirm or refute the presence of this unknown absorber.</p>
        <p>Extended Data Fig. 1 | The throughput and spectral trace for WASP-39 across NRS1 and NRS2. a, Normalized throughput of NRS1 and NRS2 detectors (as custom produced; see Methods, 'Limb-darkening'), which shows the cutoff at short wavelengths. b, 2D spectral images of the trace produced from the ExoTiC-JEDI [V1] reduction before cleaning steps. The aspect ratio has been stretched in the y direction to show the structure of the trace over the 32-pixel-wide subarray more clearly. The NRS2 spectral position is slightly offset from that of NRS1, as the NRS2 subarray was moved following commissioning to ensure that the centre of the spectral trace fell fully on the detector and did not fall off the top-right corner 139 .Extended Data Fig. 1 | The throughput and spectral trace for WASP-39 across NRS1 and NRS2. a, Normalized throughput of NRS1 and NRS2 detectors (as custom produced; see Methods, 'Limb-darkening'), which shows the cutoff at short wavelengths. b, 2D spectral images of the trace produced from the ExoTiC-JEDI [V1] reduction before cleaning steps. The aspect ratio has been stretched in the y direction to show the structure of the trace over the 32-pixel-wide subarray more clearly. The NRS2 spectral position is slightly offset from that of NRS1, as the NRS2 subarray was moved following commissioning to ensure that the centre of the spectral trace fell fully on the detector and did not fall off the top-right corner 139 .</p>
        <p>Extended Data Fig. 2 | Time-dependent decorrelation parameters. a, The change in the FWHM of the spectral trace at selected wavelengths. This change does not correspond to any high-gain antenna movements and is attributed to a large mirror-tilt event. These measurements demonstrate that the mirror-tilt event has a wavelength dependence. Changes to the PSF have a larger impact at short wavelengths, as the PSF of the spectrum increases with Overplotted are the data binned to a resolution of 10 pixels to match our presented transmission spectra (Fig. 2). We also show a linear fit to each detector to better quantify the decreasing tilt flux amplitude with increasing wavelength (NRS1 = -0.00073374x + 0.00707344, NRS2 = -0.00067165x + 0.00588128). Spikes in the uncertainties correspond to spectral bins with higher standard deviations, probably because of differences in pixel-flagging or sigma-clipping at the light-curve level. b, Gaussian PDFs of the normalized transmission spectrum residuals, showing the mean offset and the spread relative to the weighted-average transmission spectrum. c, Histograms of the normalized transmission spectrum residuals aligned to zero by subtracting the mean of the distribution that was used to generate the PDF above. In panels b and c, the coloured lines and numbers correspond to the fitting pipeline used to obtain each transmission spectrum, as summarized in Extended Data Table 1. The dashed lines correspond to the fitting pipeline results presented in Fig. 2, demonstrating that they are drawn from across the distribution.Extended Data Fig. 2 | Time-dependent decorrelation parameters. a, The change in the FWHM of the spectral trace at selected wavelengths. This change does not correspond to any high-gain antenna movements and is attributed to a large mirror-tilt event. These measurements demonstrate that the mirror-tilt event has a wavelength dependence. Changes to the PSF have a larger impact at short wavelengths, as the PSF of the spectrum increases with Overplotted are the data binned to a resolution of 10 pixels to match our presented transmission spectra (Fig. 2). We also show a linear fit to each detector to better quantify the decreasing tilt flux amplitude with increasing wavelength (NRS1 = -0.00073374x + 0.00707344, NRS2 = -0.00067165x + 0.00588128). Spikes in the uncertainties correspond to spectral bins with higher standard deviations, probably because of differences in pixel-flagging or sigma-clipping at the light-curve level. b, Gaussian PDFs of the normalized transmission spectrum residuals, showing the mean offset and the spread relative to the weighted-average transmission spectrum. c, Histograms of the normalized transmission spectrum residuals aligned to zero by subtracting the mean of the distribution that was used to generate the PDF above. In panels b and c, the coloured lines and numbers correspond to the fitting pipeline used to obtain each transmission spectrum, as summarized in Extended Data Table 1. The dashed lines correspond to the fitting pipeline results presented in Fig. 2, demonstrating that they are drawn from across the distribution.</p>
        <p>Acknowledgements This work is based on observations made with the NASA/ESA/CSA JWST. The data were obtained from the Mikulski Archive for Space Telescopes at the Space Telescope Science Institute, which is operated by the Association of Universities for Research in Astronomy, Inc., under NASA contract NAS 5-03127 for the JWST. These observations are associated with programme JWST-ERS-01366. Support for programme JWST-ERS-01366 was provided by NASA through a grant from the Space Telescope Science Institute, which is operated by the Association of Universities for Research in Astronomy, Inc., under NASA contract NAS 5-03127. L.A. acknowledges funding from STFC grant ST/W507337/1 and from the University of Bristol School of Physics PhD Scholarship Fund.Acknowledgements This work is based on observations made with the NASA/ESA/CSA JWST. The data were obtained from the Mikulski Archive for Space Telescopes at the Space Telescope Science Institute, which is operated by the Association of Universities for Research in Astronomy, Inc., under NASA contract NAS 5-03127 for the JWST. These observations are associated with programme JWST-ERS-01366. Support for programme JWST-ERS-01366 was provided by NASA through a grant from the Space Telescope Science Institute, which is operated by the Association of Universities for Research in Astronomy, Inc., under NASA contract NAS 5-03127. L.A. acknowledges funding from STFC grant ST/W507337/1 and from the University of Bristol School of Physics PhD Scholarship Fund.</p>
        <p>The data used in this paper are associated with JWST programme ERS 1366 (observation #4) and are available from the Mikulski Archive for Space Telescopes (MAST; https://mast.stsci.edu). Science data processing version (SDP_VER) 2022_2a generated the uncalibrated data that we downloaded from MAST. We used 
            <rs type="software">JWST Calibration Pipeline</rs> software version (CAL_VER) 
            <rs type="version">1.5.3</rs> with modifications described in the text. We used calibration reference data from context (CRDS_CTX) 0916, except as noted in the text. All the data and models presented in this publication can be found at https://doi.org/10.5281/zenodo.7185300.
        </p>
        <p>The codes used in this publication to extract, reduce and analyse the data are as follows; STScI JWST Calibration Pipeline 44 (https://github.The codes used in this publication to extract, reduce and analyse the data are as follows; STScI JWST Calibration Pipeline 44 (https://github.</p>
        <p>The parameter space explored by each RCTE model grid. The best-fit model for each grid is shown in bold. Ref. 140-142 .The parameter space explored by each RCTE model grid. The best-fit model for each grid is shown in bold. Ref. 140-142 .</p>
        <p>Publisher's note Springer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.Publisher's note Springer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.</p>
        <p>The authors declare no competing interests.The authors declare no competing interests.</p>
        <p>The online version contains supplementary material available at https://doi.org/10.1038/s41586-022-05591-3. Correspondence and requests for materials should be addressed to Lili Alderson or Hannah R. Wakeford. Peer review information Nature thanks Norio Narita and the other, anonymous, reviewer(s) for their contribution to the peer review of this work. Peer reviewer reports are available. Reprints and permissions information is available at http://www.nature.com/reprints.The online version contains supplementary material available at https://doi.org/10.1038/s41586-022-05591-3. Correspondence and requests for materials should be addressed to Lili Alderson or Hannah R. Wakeford. Peer review information Nature thanks Norio Narita and the other, anonymous, reviewer(s) for their contribution to the peer review of this work. Peer reviewer reports are available. Reprints and permissions information is available at http://www.nature.com/reprints.</p>
        <p>Feature-detection significance for dominant sources of opacity with two different methods. B is the Bayes factor.Feature-detection significance for dominant sources of opacity with two different methods. B is the Bayes factor.</p>
    </text>
</tei>
