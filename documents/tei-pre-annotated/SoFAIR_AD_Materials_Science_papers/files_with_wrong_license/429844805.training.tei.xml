<?xml version="1.0" encoding="UTF-8"?>
<tei xmlns="http://www.tei-c.org/ns/1.0">
    <teiHeader>
        <fileDesc xml:id="_1"/>
        <encodingDesc>
            <appInfo>
                <application version="0.8.1-SNAPSHOT" ident="GROBID" when="2024-06-14T11:26+0000">
                    <ref target="https://github.com/kermitt2/grobid">A machine learning software for extracting information from scholarly documents</ref>
                </application>
            </appInfo>
        </encodingDesc>
    </teiHeader>
    <text xml:lang="en">
        <p>Free energy calculations have seen increased usage in structure-based drug design. Despite the rising interest, automation of the complex calculations and subsequent analysis of their results are still hampered by the restricted choice of available tools. In this work, an application for automated setup and processing of free energy calculations is presented. Several sanity checks for assessing the reliability of the calculations were implemented , constituting a distinct advantage over existing open-source tools. The underlying workflow is built on top of the software 
            <rs type="software">Sire</rs>, 
            <rs type="software">SOMD</rs>, 
            <rs type="software">BioSimSpace</rs> and 
            <rs type="software">OpenMM</rs> and uses the 
            <rs type="software">AMBER</rs>
            <rs type="version">14SB</rs> and 
            <rs type="software">GAFF</rs>
            <rs type="version">2.1</rs> force fields. It was validated on two datasets originally composed by 
            <rs type="software">Schrödinger</rs>, consisting of 14 protein structures and 220 ligands. Predicted binding affinities were in good agreement with experimental values. For the larger dataset the average correlation coefficient R p was 0.70 ± 0.05 and average Kendall's τ was 0.53 ± 0.05 which is broadly comparable to or better than previously reported results using other methods.
        </p>
        <p>Reliable prediction of ligand binding affinities is highly desirable in the early stages of drug discovery projects. During the last few years alchemical free energy calculations have emerged as a prominent tool for this task. [1][2][3] Such calculations have been applied to predict ligand binding affinities of large datasets, yielding on average predictions accurate to within 0.8 kcal/mol, thus adding significant value to drug discovery projects . [4][5][6][7] However, lack of automation is still a major obstacle to a more routine application of these methods, despite several tools to address this being in development. [8][9][10][11] Furthermore, carrying out alchemical free energy calculations requires expert knowledge, since assessing the quality and validity of these simulations can be non-trivial. 12,13 Different approaches in free energy prediction methods have been assessed through community challenges such as D3R 14 or SAMPL 15 using various datasets .Reliable prediction of ligand binding affinities is highly desirable in the early stages of drug discovery projects. During the last few years alchemical free energy calculations have emerged as a prominent tool for this task. [1][2][3] Such calculations have been applied to predict ligand binding affinities of large datasets, yielding on average predictions accurate to within 0.8 kcal/mol, thus adding significant value to drug discovery projects . [4][5][6][7] However, lack of automation is still a major obstacle to a more routine application of these methods, despite several tools to address this being in development. [8][9][10][11] Furthermore, carrying out alchemical free energy calculations requires expert knowledge, since assessing the quality and validity of these simulations can be non-trivial. 12,13 Different approaches in free energy prediction methods have been assessed through community challenges such as D3R 14 or SAMPL 15 using various datasets .</p>
        <p>Alchemical free energy calculations for computing the binding energy of a compound A relative to a reference compound B generally involve a thermodynamic cycle in which A is transformed into B in the protein environment and in simple solvent (Figure 1). The corresponding states of A and B need to have significant overlap in their potential energy distributions, as otherwise the configurations sampled for A may be of low probability for B, which leads to slow convergence of the free energy change and computation of the result may not be possible. 16 This limitation is typically overcome by introducing a coupling parameter λ which takes on values between 0 and 1 to interpolate the potential energy functions of the endstates. The transformation from A to B is then achieved through a varying number of artificial ("alchemical") states characterized by intermediate λ values (the so-called λ-windows) providing an improved overlap of potential energy distributions between neighboring states.Alchemical free energy calculations for computing the binding energy of a compound A relative to a reference compound B generally involve a thermodynamic cycle in which A is transformed into B in the protein environment and in simple solvent (Figure 1). The corresponding states of A and B need to have significant overlap in their potential energy distributions, as otherwise the configurations sampled for A may be of low probability for B, which leads to slow convergence of the free energy change and computation of the result may not be possible. 16 This limitation is typically overcome by introducing a coupling parameter λ which takes on values between 0 and 1 to interpolate the potential energy functions of the endstates. The transformation from A to B is then achieved through a varying number of artificial ("alchemical") states characterized by intermediate λ values (the so-called λ-windows) providing an improved overlap of potential energy distributions between neighboring states.</p>
        <p>There are multiple different approaches available for computing binding free energies from the potential function distributions. These include Free Energy Perturbation (FEP) 17 , Thermodynamic Integration (TI) 18,19 and the Multistate Bennett Acceptance Ratio (MBAR) estimator. 20,21 For a full review of the advantages and disadvantages of each method see 12,13,22 .There are multiple different approaches available for computing binding free energies from the potential function distributions. These include Free Energy Perturbation (FEP) 17 , Thermodynamic Integration (TI) 18,19 and the Multistate Bennett Acceptance Ratio (MBAR) estimator. 20,21 For a full review of the advantages and disadvantages of each method see 12,13,22 .</p>
        <p>Figure 1. Schematic representation of free energy calculations. The binding free energy of a compound is calculated according to the thermodynamic cycle which consists of four different states: the protein-ligand complexes of molecules A and B, as well as A and B in a water box. A is transformed into B through a number of alchemical intermediates. As the molecular dynamics simulations are carried out in a isothermal-isobaric ensemble, Gibb's free energy ΔG is used instead of Helmholtz' free energy ΔF.Figure 1. Schematic representation of free energy calculations. The binding free energy of a compound is calculated according to the thermodynamic cycle which consists of four different states: the protein-ligand complexes of molecules A and B, as well as A and B in a water box. A is transformed into B through a number of alchemical intermediates. As the molecular dynamics simulations are carried out in a isothermal-isobaric ensemble, Gibb's free energy ΔG is used instead of Helmholtz' free energy ΔF.</p>
        <p>There are several commercial and open-source options available for carrying out free energy perturbation (FEP) calculations, the most well-known being the package provided by 
            <rs type="software">Schrödinger</rs> (referred to as FEP+). FEP+ was originally validated on a large dataset of eight proteins and 199 ligands using the OPLS2.1 forcefield and replica exchange with solute tempering (REST). 1 More recently, two other approaches utilizing 
            <rs type="software">AMBER</rs> 23 and 
            <rs type="software">GROMACS</rs> 24 have also been used to study this dataset. Comparative analysis of the performance of different FEP implementations is important to identify areas where further methodological efforts can be concentrated to improve FEP methodologies. Recent efforts from the field hav e highlighted that the results of an FEP calculation depend on several parameters other than the potential energy function, for instance input preparation, simulation conditions and choice of the free energy analysis method. 25,26 Most recently, relative binding free energy (RBFE) calculations were implemented in Cresset' s structure-based drug design suite, 
            <rs type="software">Flare</rs>. 27,28 This approach is based on the Sire 29 framework, and leverages several open source tools, namely 
            <rs type="software">Biosimspace</rs>, 11 
            <rs type="software">SOMD</rs>, 30 
            <rs type="software">OpenMM</rs>, 31 
            <rs type="software">AmberTools</rs> 32 and a customized version of 
            <rs type="software">LOMAP</rs>. 8 Automated setup, deployment on remote computing instances, and analysis of free energy calculations can be accomplished through a graphical user interface (GUI) and a Python application programming interface (API). Automation and accessibility, though highly desirable, critically depend on a robust sanity check and error analysis of simulation results. Common sanity indicators for alchemical calculations are monitored to detect potential issues; among these indicators are hysteresis of forward and backward transformations, cycle closure errors, and poor overlap between neighboring λ windows. 12,33,34 The 
            <rs type="software">SOMD</rs> package available within the Sire framework has been successfully applied to relative and absolute binding free energy studies of a range of fragments, drug-like small molecules, carbohydrates, host-guest systems. [5][6][7]30,[35][36][37][38] However, a systematic comparison on standard datasets has not been published to date. Here we report a large-scale validation of Flare's FEP implementation on the Wang et al. 1 dataset, as well as on a smaller dataset of more challenging scaffold hopping modifications . 39 lower left), a 3D window containing screenshots from the molecular dynamics simulations (upper right) and a color-coded table listing the cycle closure errors (lower right).
        </p>
        <p>Free energy calculations may be carried out using a single or a dual topology approach. 13,40 The software packages used in this work use single topology, i.e. the parameters of the perturbed atoms from the starting molecule are changed to represent those in the target molecule. Additional atoms are treated as dummies, i.e. their charge and Lennard Jones potential are set to zero in the corresponding states. Perturbations in which the size of a ring is altered are best performed via an intermediate ringless state (e.g. -cyclopentyl to -cyclobutyl may be attempted via a common -H intermediate). If the ring systems differ substantially in their nature and substitution pattern, adding further intermediates can be beneficial. Hence, it was not considered optimal to use the perturbation networks provided in the Wang et al. 1 study and new networks were created using a customized version of LOMAP 8 , in which candidate perturbations which are hard to perform in a single-topology approach such as ring size changes are assigned a zero score, and hence are not allowed in the final perturbation network.Free energy calculations may be carried out using a single or a dual topology approach. 13,40 The software packages used in this work use single topology, i.e. the parameters of the perturbed atoms from the starting molecule are changed to represent those in the target molecule. Additional atoms are treated as dummies, i.e. their charge and Lennard Jones potential are set to zero in the corresponding states. Perturbations in which the size of a ring is altered are best performed via an intermediate ringless state (e.g. -cyclopentyl to -cyclobutyl may be attempted via a common -H intermediate). If the ring systems differ substantially in their nature and substitution pattern, adding further intermediates can be beneficial. Hence, it was not considered optimal to use the perturbation networks provided in the Wang et al. 1 study and new networks were created using a customized version of LOMAP 8 , in which candidate perturbations which are hard to perform in a single-topology approach such as ring size changes are assigned a zero score, and hence are not allowed in the final perturbation network.</p>
        <p>Protein and ligand structures were obtained from the supporting information (SI) of the publications by Wang et al. While protonation states of the ligands were maintained as in the original publication, proteins were re-prepared in Flare 27,28 and protonation states assigned using the TSAR algorithm. 41 For thrombin, only the A chain was used and the missing loop was built from entry 5LPD in the Protein Data Bank 42 using 
            <rs type="software">Modeller</rs>
            <rs type="version">9.20</rs>. 43 Furthermore, the tartaric acid molecule present in the BACE structure was discarded. The 
            <rs type="software">AMBER</rs> 14FFSB force field 44 was used to describe the proteins and 
            <rs type="software">GAFF</rs>
            <rs type="version">2.1</rs> 45 for the ligand, with AM1-BCC charges. 46 Missing force field parameters for the ligands were generated using the parmchk module. 47 The systems were solvated using the TIP3P water model 48 and a cuboid solvation box with a solvation buffer size of 10 Å. Systems were neutralized by adding Na + or Cl -ions as required. Bonds involving hydrogen atoms were constrained using the SHAKE 49 algorithm and a time step of 2 fs was used throughout all simulations. Long -range electrostatic interactions were treated using the reaction-field method. 50 Non-bonded interactions were treated using a 10 Å cut-off. Systems were equilibrated using 
            <rs type="software">OpenMM</rs>
            <rs type="version">7.3.0</rs> 31 at λ=0 following a fourstep protocol. Details of the equilibration protocol can be found in the SI (Table S2).
        </p>
        <p>In contrast to other work reported on these datasets, 1,23,24,39 each perturbation was carried out in two independent simulations, one in each direction. Though this increases the overall computational costs, it provides an opportunity to assess the reliability of the calculations as the hysteresis should ideally be zero. The perturbation networks were drafted using an extended version of LOMAP 8 as implemented in 
            <rs type="software">Flare</rs> and were then optimized through the user interface by manually adding or removing links from the perturbation map. For several datasets, a few additional compounds were necessary in order to connect all the prepared ligands into one perturbation map. The relative binding free energy change for each perturbation was calculated using a varying number of linearly spaced λ windows (5, 9, 14, 19 or 24), each window being subjected to a 4-ns MD simulation. Larger numbers of λ windows were used for more challenging perturbations, such as those involving ring additions, or non -polar-to-polar group mutations. Electrostatic and van der Waals interactions were described using soft-core potentials (cf. the SI of Loeffler et al. 26 for details). The input files describing the perturbation were generated using 
            <rs type="software">BioSimSpace</rs>. 11 Prior to starting the simulations, an energy minimization was carried out running 1,000 steps of the steepest descent algorithm. Simulations were performed using 
            <rs type="software">SOMD</rs>. 29,30 The first 400 ps of the trajectories of each λ window were discarded prior to free energy estimation to allow for equilibration. Free energies were calculated using 
            <rs type="software">MBAR</rs>. 20 The final change in the free energy of binding for each ligand pair was calculated by averaging results obtained for the perturbation carried out in both directions ; ΔG values were computed from the network according to the method of Xu et al. 51 2.4 Analysis of the results. This work focuses on the overall correlation for each of the subsets and the mean unsigned error of each compound (
            <rs type="software">MUE</rs> c ). Previous publications 1,23,24 primarily aimed at the comparison of the mean unsigned error of each perturbation (
            <rs type="software">MUE</rs> p ), i.e. the me an prediction error for each ligand pair. However, strictly speaking comparing 
            <rs type="software">MUE</rs> p between different approaches requires the underlying perturbation networks to be identical, which is not the case for the approach presented here (cf. above). To address this situation, the unsigned error UE p,A-B for transformations where compounds A and B are connected via an additional intermediate molecule I with unknown experimental affinity was estimated as:
        </p>
        <p>Here, ΔΔG calc,A-I and ΔΔG calc,I-B are the calculated free energies between A and I and I and B, respectively, while ΔΔG exp,A-B is the difference in experimentally measured binding affinity between A and B.Here, ΔΔG calc,A-I and ΔΔG calc,I-B are the calculated free energies between A and I and I and B, respectively, while ΔΔG exp,A-B is the difference in experimentally measured binding affinity between A and B.</p>
        <p>As the work of Gapsys et al. did not contain computed ΔG values, these values were obtained from the reported ΔΔG values using Flare's internal protocol (data can be found in the SI).As the work of Gapsys et al. did not contain computed ΔG values, these values were obtained from the reported ΔΔG values using Flare's internal protocol (data can be found in the SI).</p>
        <p>A critical factor for the success of free energy calculations is to ensure sufficient overlap of the phase space probability distributions integrals between all neighboring states. 33,34 Typically, this is guaranteed only when the two states are very similar to each other, which is usually not the case for molecules characterized by significant structural differences .A critical factor for the success of free energy calculations is to ensure sufficient overlap of the phase space probability distributions integrals between all neighboring states. 33,34 Typically, this is guaranteed only when the two states are very similar to each other, which is usually not the case for molecules characterized by significant structural differences .</p>
        <p>Hence, a sufficiently high number of alchemical intermediate states must be chosen to connect the end states and ensure that the calculated free energy converges in a reasonable amount of time. Whether a perturbation obeys to these criteria can be checked through a so-called phase space overlap matrix. 12 The overlap matrix 𝒪 ∈ ℝ 𝑛×𝑛 (where n is the number of λ windows) contains the probability that a s ample from any state can be found in any other state; hence, the matrix is symmetric (with respect to its main diagonal) and all rows and columns sum to 1. The first offset diagonals of the matrix contain the information about neighboring states. It has be en reported that a value as low as 0.03 in these diagonals may be sufficient to obtain reliable results. 12 In this study, the overlap matrices were used to guide the selection of the number of λ windows (cf. Figure 3). neighboring windows in the matrix on the left whereas there is poor overlap (red cells) between the first and the second window of the second perturbation in the matrix on the right. Overlap in the empty cells is smaller than 0.001.Hence, a sufficiently high number of alchemical intermediate states must be chosen to connect the end states and ensure that the calculated free energy converges in a reasonable amount of time. Whether a perturbation obeys to these criteria can be checked through a so-called phase space overlap matrix. 12 The overlap matrix 𝒪 ∈ ℝ 𝑛×𝑛 (where n is the number of λ windows) contains the probability that a s ample from any state can be found in any other state; hence, the matrix is symmetric (with respect to its main diagonal) and all rows and columns sum to 1. The first offset diagonals of the matrix contain the information about neighboring states. It has be en reported that a value as low as 0.03 in these diagonals may be sufficient to obtain reliable results. 12 In this study, the overlap matrices were used to guide the selection of the number of λ windows (cf. Figure 3). neighboring windows in the matrix on the left whereas there is poor overlap (red cells) between the first and the second window of the second perturbation in the matrix on the right. Overlap in the empty cells is smaller than 0.001.</p>
        <p>In the previously published benchmark papers discussed above 1,23 approach is perfect, and as the matrix can only be calculated once the calculations of all windows have finished, a significant amount of time can be spent on simulations which are then deemed unreliable due to poor phase space overlap. We have attempted to derive heuristics to determine how many λ windows should be used for certain types of perturbations to ensure sufficient overlap using the approach presented here. However, as the windows are spaced linearly, adding mo re windows also affects already well-sampled areas of the matrix, which increases computation time while only marginally improving the overall quality of the free energy estimate. We are currently investigating other approaches , such as the Conveyor Belt Thermodynamic Integration scheme, 52 adaptive sampling 53 or non-linear λ functions derived from heuristics.In the previously published benchmark papers discussed above 1,23 approach is perfect, and as the matrix can only be calculated once the calculations of all windows have finished, a significant amount of time can be spent on simulations which are then deemed unreliable due to poor phase space overlap. We have attempted to derive heuristics to determine how many λ windows should be used for certain types of perturbations to ensure sufficient overlap using the approach presented here. However, as the windows are spaced linearly, adding mo re windows also affects already well-sampled areas of the matrix, which increases computation time while only marginally improving the overall quality of the free energy estimate. We are currently investigating other approaches , such as the Conveyor Belt Thermodynamic Integration scheme, 52 adaptive sampling 53 or non-linear λ functions derived from heuristics.</p>
        <p>In a recently published paper 24 the authors argue that the ionization state of Cys215 in the binding pocket of PTP1B, which was set to deprotonated in the previous work by Wang et al., 1 may be incorrect; in fact, there is only a short distance between the sulfur atom of Cys215 and the closest ligand carboxyl oxygen atom (3.5-3.9 Å). Furthermore, two different predictors suggest that the pK a of cysteine in the complexes ranges from 9.8 to 10.5. The authors report a better agreement with experiment for the free energy calculations using their consensus approach when Cys215 is modelled as protonated. 24 In this study, Cys215 was treated as being protonated.In a recently published paper 24 the authors argue that the ionization state of Cys215 in the binding pocket of PTP1B, which was set to deprotonated in the previous work by Wang et al., 1 may be incorrect; in fact, there is only a short distance between the sulfur atom of Cys215 and the closest ligand carboxyl oxygen atom (3.5-3.9 Å). Furthermore, two different predictors suggest that the pK a of cysteine in the complexes ranges from 9.8 to 10.5. The authors report a better agreement with experiment for the free energy calculations using their consensus approach when Cys215 is modelled as protonated. 24 In this study, Cys215 was treated as being protonated.</p>
        <p>3.1 Overall comparison of the FEP+ dataset. The summary of the results of the eight datasets from Wang et al. 1 is reported in Table 1. Details can be found in the SI (Table S4;3.1 Overall comparison of the FEP+ dataset. The summary of the results of the eight datasets from Wang et al. 1 is reported in Table 1. Details can be found in the SI (Table S4;</p>
        <p>results may be recalculated using the supplied 
            <rs type="software">Jupyter</rs> Notebook and input files). The data for In terms of R, results obtained with Flare showed higher correlation (ΔR &gt; 0.10) than those reported by Song et al. 23 for five of the eight datasets, and comparable for the three remaining datasets (MCL1, 54 PTP1B 55 and BACE 56 ). Interestingly, Flare's MUE c is lower, particularly for the BACE dataset (0.76 ± 0.10 vs. 1.03 ± 0.14 kcal/mol; see Table S4)). As both approaches use the same force field (
            <rs type="software">AMBER</rs>
            <rs type="version">14</rs>FFSB), this highlights that accuracy of an FEP implementation depends on several other aspects beyond the choice of a potential energy function .
        </p>
        <p>Our results are overall more predictive than those reported by Wang et al. 1 for thrombin 57 and CDK2 58 (ΔR &gt; 0.10), comparable for MCL1 and p38, 59 and less predictive for TYK2, 60,61 PTP1B and JNK1 62 (ΔR &lt; -0.10). The most striking difference was observed for the BACE dataset, for which the overall correlation R² was poor (0. Similar performance can be observed when comparing results with the study of Gapsys et al., 24 who used a consensus approach of 
            <rs type="software">GAFF</rs> 45 and 
            <rs type="software">CGenFF</rs> 63 as implemented in 
            <rs type="software">pmx</rs>. 64 Results obtained with Flare showed higher correlation (ΔR &gt; 0.10) for thrombin and PTP1B, similar for CDK2, TYK2 and MCL1, and poorer correlation for the remaining three other datasets (ΔR &lt; -0.10). Unsigned error per perturbation (MUE p ) for each of the eight datasets in kcal/mol. The error bars in a) indicate the 95% confidence interval calculated using the Fisher transformation. 65,66 For b)d), they denote the standard deviation obtained by bootstrapping using 10,000 iterations.
        </p>
        <p>To allow for easier comparison across all datasets, the average correlation coefficient R avg , Kendall's τ avg and the mean unsigned errors per compound (MUE c,avg ) and per perturbation (MUE p,avg ) are reported in Table 1. Overall, the results obtained are slightly worse than those reported by Wang et al., 1 but better than those reported by Song et al. 23 Compared to Gapsys et al., 24 results are better than those obtained using 
            <rs type="software">CGenFF</rs>, and similar to those obtained using 
            <rs type="software">GAFF</rs> or 
            <rs type="software">GAFF+CGenFF</rs>. There are several differences among the different free energy approaches which may help to explain these findings. An important factor is the underlying force fields applied to the proteins and ligands. While the same protein force field was used in this work as in the work published by Song et al., the ligands were parameterized using different versions of 
            <rs type="software">GAFF</rs> (v
            <rs type="version">2.1</rs> vs. v1.8), and different water models were used (TIP3P vs SPC/E). The present protocol used a reaction field treatment of long-range electrostatic interactions, in contrast to a Particle Mesh Ewald treatment in the other studies . However, the results appear overall more accurate than those reported by Song et al., thus there is no evidence that the use of this computationally more efficient protocol degraded accuracy of the calculations on this dataset. As there are other important differences in the perturbation network, sampling time and in the way results are analyzed (MBAR vs. TI), it is difficult to compare the results directly.
        </p>
        <p>Even though Gapsys et al. report results closer to those presented here using 
            <rs type="software">GAFF</rs> v
            <rs type="version">2.1</rs>, their non-equilibrium approach cannot be directly compared to the method used in our work. The perturbation network used in this work differs from the one used in the other studies reported, 1,23,24 since the networks used by Wang et al. 1 are not optimal for use with 
            <rs type="software">SOMD</rs> (cf. section 2.1). For the BACE dataset several intermediate structures had to be introduced to connect all subsets reliably. One subset contains a cyclopropyl group, which is replaced by a phenyl ring in another subset. In order to connect these structural motifs, two intermediate structures (each containing a hydrogen atom at the corresponding position) were introduced. This makes achieving precise results challenging as the relative binding affinity difference between the compounds in both subsets is mainly governed by only a few relatively challenging perturbations.
        </p>
        <p>The sampling time per perturbation is also of interest as computational resources in drug design projects are limited. The approach by Gapsys et al. used 60 (using 
            <rs type="software">GAFF</rs>) or 120 ns (when using 
            <rs type="software">GAFF+</rs>CGenFF) for a single perturbation with a 2 fs time step, whereas Song et al. used 74 ns 23,24 and a 1 fs timestep. The method of Wang et al. used 60 ns with a 4 fs timestep, but multiple replicas were run at different temperatures. The perturbation networks used in these studies were identical and contained a total of 330 perturbations. The approach described in this work on average used 90 ns and a 2 fs timestep, with 315 perturbations in total. However, each ligand pair was calculated twice (once in each direction) to allow for an ad ditional reliability estimate. Using only one of the two possible directions for each perturbation was found to only marginally affect the correlation coefficient and MUE, meaning that the average calculation time can be halved to 45 ns without having a major impact on the quality of the results (cf. Table S3 in the SI).
        </p>
        <p>There are several other factors such as ion concentration, distance cut-offs, water models, etc.There are several other factors such as ion concentration, distance cut-offs, water models, etc.</p>
        <p>which have an impact on the predicted binding affinities. However, the impact of these parameters on the free energies cannot be assessed easily. A table summarizing the methodological details of different methodologies can be found in the SI (Table S1).which have an impact on the predicted binding affinities. However, the impact of these parameters on the free energies cannot be assessed easily. A table summarizing the methodological details of different methodologies can be found in the SI (Table S1).</p>
        <p>Free energy calculations are an advanced and computationally expensive method. Hence, it is worthwhile to consider the benefit of the calculations compared to simpler models. For example, Song et al. report a null model which considers all ligands to be equally potent. 23 Though this is a "true" null model, it seems oversimplified as even simple molecular descriptors may be able to yield a weak estimate of the binding affinity. An example for such a descriptor is the molecular weight (MW). Broadly speaking, the binding affinity can be expected to increase as the MW increases, since a heavier (and thus probably larger) compound can form more interactions with the binding pocket.Free energy calculations are an advanced and computationally expensive method. Hence, it is worthwhile to consider the benefit of the calculations compared to simpler models. For example, Song et al. report a null model which considers all ligands to be equally potent. 23 Though this is a "true" null model, it seems oversimplified as even simple molecular descriptors may be able to yield a weak estimate of the binding affinity. An example for such a descriptor is the molecular weight (MW). Broadly speaking, the binding affinity can be expected to increase as the MW increases, since a heavier (and thus probably larger) compound can form more interactions with the binding pocket.</p>
        <p>Interestingly, there is indeed a weak correlation between the MW and the experimental binding affinities for most datasets (cf. Table S4 in the SI), except for BACE and TYK2. R 2 for MW in PTP1B is surprisingly high (0.55), reflecting that the dataset contains various ligands of different sizes which are incrementally grown in the additional and mainly hydrophobic parts of the binding pocket. In summary, our results are clearly superior to those obtained by this null model (average R = 0.70 ± 0.05 for the free energy calculations and 0.38 ± 0.11 for the molecular weight), apart from the PTP1B dataset.Interestingly, there is indeed a weak correlation between the MW and the experimental binding affinities for most datasets (cf. Table S4 in the SI), except for BACE and TYK2. R 2 for MW in PTP1B is surprisingly high (0.55), reflecting that the dataset contains various ligands of different sizes which are incrementally grown in the additional and mainly hydrophobic parts of the binding pocket. In summary, our results are clearly superior to those obtained by this null model (average R = 0.70 ± 0.05 for the free energy calculations and 0.38 ± 0.11 for the molecular weight), apart from the PTP1B dataset.</p>
        <p>Another aspect to consider when running free energy calculations is how much results of a given perturbation may vary across different runs starting from identical input molecules. In fact, the pre-FEP MD equilibration protocols uses randomly sampled velocities from the Maxwell-Boltzmann distribution, and consequently yield different starting 3D coordinates each time they are run. Likewise, different production runs started from the same equilibrated structure will yield different trajectories because velocities are reinitialized at each λ-window. Four selected transformations (named P1-4) covering conservative as well as more challenging structural modifications were performed in quintuplicate to assess the variability of the results. For P1 and P2, only a few atoms are altered during the transformation. In P3 and P4 an aliphatic ring system is introduced (cyclopropyl and cycloheptyl, respectively) posing a more difficult challenge. The results are summarized in Figure 5 and detailed information can be found in the SI (Table S5). The hysteresis between corresponding "growing" and "shrinking" perturbations was found to be small (&lt; 0.20 kcal/mol) after five repeats for the perturbations P1-3, emphasizing the reliability of the presented approach. By contrast, the calculations for the insertion of cycloheptyl in PTP1B (P4) shows a hysteresis of 1.4 kcal/mol. Nevertheless, the calculated free energy over all five replicas in both directions closely matches the experimental value. The standard deviation of the binding free energy estimate for the larger perturbations P3 and P4 is larger (ca. 0.5 kcal/mol) than for the smaller perturbations P1 and P2. Thus, it is advisable to carry out multiple repeat runs for perturbations involving growth of entire rings.Another aspect to consider when running free energy calculations is how much results of a given perturbation may vary across different runs starting from identical input molecules. In fact, the pre-FEP MD equilibration protocols uses randomly sampled velocities from the Maxwell-Boltzmann distribution, and consequently yield different starting 3D coordinates each time they are run. Likewise, different production runs started from the same equilibrated structure will yield different trajectories because velocities are reinitialized at each λ-window. Four selected transformations (named P1-4) covering conservative as well as more challenging structural modifications were performed in quintuplicate to assess the variability of the results. For P1 and P2, only a few atoms are altered during the transformation. In P3 and P4 an aliphatic ring system is introduced (cyclopropyl and cycloheptyl, respectively) posing a more difficult challenge. The results are summarized in Figure 5 and detailed information can be found in the SI (Table S5). The hysteresis between corresponding "growing" and "shrinking" perturbations was found to be small (&lt; 0.20 kcal/mol) after five repeats for the perturbations P1-3, emphasizing the reliability of the presented approach. By contrast, the calculations for the insertion of cycloheptyl in PTP1B (P4) shows a hysteresis of 1.4 kcal/mol. Nevertheless, the calculated free energy over all five replicas in both directions closely matches the experimental value. The standard deviation of the binding free energy estimate for the larger perturbations P3 and P4 is larger (ca. 0.5 kcal/mol) than for the smaller perturbations P1 and P2. Thus, it is advisable to carry out multiple repeat runs for perturbations involving growth of entire rings.</p>
        <p>Apart from "conventional" perturbations as contained in the datasets above, more advanced structural changes may also be of interest during the lead optimization stage of the drug design cycle. Those include macrocyclization and core replacement. In terms of free energy calculations , modification of the overall ligand formal charge is also challenging.Apart from "conventional" perturbations as contained in the datasets above, more advanced structural changes may also be of interest during the lead optimization stage of the drug design cycle. Those include macrocyclization and core replacement. In terms of free energy calculations , modification of the overall ligand formal charge is also challenging.</p>
        <p>Scaffold hopping experiments in principle are amenable to FEP simulations. As the underlying method uses the single topology approach, such perturbations can be computationally more demanding compared to dual topology approaches if the structural motif to be replaced is located in the middle of the molecule. To assess the feasibility of this type of perturbations, six series of protein-ligand complexes for which input structures have been made available 39 were investigated. For some of the datasets one or several intermediate structures had to be introduced 20 in order to ensure a reasonable perturbation network. These are labelled as "mcs" (maximum common substructure of all ligands) and "sub" (substructure) in the perturbation networks , respectively. The networks can be found in the SI (Figure S2). The results are shown in Figure 6 and details are specified in the SI (Table S5). The MUE c was 0.59 ± 0.50 kcal/mol for the results obtained in this study compared to 0.28 ± 0.31 kcal/mol reported by Wang et al. 67 In the following the checkpoint kinase 1 (CHK1) 68 dataset is described in more detail (cf. Figure 7). Both scaffold hopping and conventional R-group modifications can be found in this dataset consisting of 5 ligands. The computed free energies of compounds 1, 17 and 20 are in excellent agreement with experiment. Though increasing the ring size is correctly predicted to be unfavorable (21), the predicted free energy is off by 0.9 ± 0.7 kcal/mol. The least active compound in the dataset (19) was not ranked last by predicted potency: The predicted change in relative affinity compared to 17 is only +0.2 ± 0.4 kcal/mol, whereas the experimental affinity changes by +1.2 kcal/mol. Interestingly, also Wang et al. 39 report a predicted change in affinity of just +0.3 ± 0.1 kcal/mol for this perturbation, which indicates that neither approach reproduces well experimental data for this pair of compounds. In summary, the scaffold hopping experiments correctly captured the effects of the ring extension transformations (TPSB2 and BACE1), though the predicted change in affinity is higher than the experimental value. The ring opening/closing transformations in EZH2 and FXa are more challenging. This is mainly due to the large number of necessary additional intermediates which are linearly connected in the perturbation network and thus increase the overall uncertainty (cf. Figure S2). On the other hand, for a similar transformation in which the ring size was modified (ERa), results were in excellent agreement with experimental values.Scaffold hopping experiments in principle are amenable to FEP simulations. As the underlying method uses the single topology approach, such perturbations can be computationally more demanding compared to dual topology approaches if the structural motif to be replaced is located in the middle of the molecule. To assess the feasibility of this type of perturbations, six series of protein-ligand complexes for which input structures have been made available 39 were investigated. For some of the datasets one or several intermediate structures had to be introduced 20 in order to ensure a reasonable perturbation network. These are labelled as "mcs" (maximum common substructure of all ligands) and "sub" (substructure) in the perturbation networks , respectively. The networks can be found in the SI (Figure S2). The results are shown in Figure 6 and details are specified in the SI (Table S5). The MUE c was 0.59 ± 0.50 kcal/mol for the results obtained in this study compared to 0.28 ± 0.31 kcal/mol reported by Wang et al. 67 In the following the checkpoint kinase 1 (CHK1) 68 dataset is described in more detail (cf. Figure 7). Both scaffold hopping and conventional R-group modifications can be found in this dataset consisting of 5 ligands. The computed free energies of compounds 1, 17 and 20 are in excellent agreement with experiment. Though increasing the ring size is correctly predicted to be unfavorable (21), the predicted free energy is off by 0.9 ± 0.7 kcal/mol. The least active compound in the dataset (19) was not ranked last by predicted potency: The predicted change in relative affinity compared to 17 is only +0.2 ± 0.4 kcal/mol, whereas the experimental affinity changes by +1.2 kcal/mol. Interestingly, also Wang et al. 39 report a predicted change in affinity of just +0.3 ± 0.1 kcal/mol for this perturbation, which indicates that neither approach reproduces well experimental data for this pair of compounds. In summary, the scaffold hopping experiments correctly captured the effects of the ring extension transformations (TPSB2 and BACE1), though the predicted change in affinity is higher than the experimental value. The ring opening/closing transformations in EZH2 and FXa are more challenging. This is mainly due to the large number of necessary additional intermediates which are linearly connected in the perturbation network and thus increase the overall uncertainty (cf. Figure S2). On the other hand, for a similar transformation in which the ring size was modified (ERa), results were in excellent agreement with experimental values.</p>
        <p>Lastly, results for the CHK1 dataset containing different modifications were in good agreement with measured affinities except for compound 19. Overall, even though the calculations tend to exaggerate the impact of the modification on the free energy, they capture the trends in changes of binding affinity.Lastly, results for the CHK1 dataset containing different modifications were in good agreement with measured affinities except for compound 19. Overall, even though the calculations tend to exaggerate the impact of the modification on the free energy, they capture the trends in changes of binding affinity.</p>
        <p>An important aspect of running FEP calculations is the overall calculation time of the whole dataset, especially when it is constituted by hundreds of compounds. To estimate the computational cost, we have performed benchmarks on two of the proteins contained in this study, TYK2 and CHK1, containing 288 and 252 amino acids respectively. For each system, three independent 4-ns windows were run for the protein ligand complex and the solvated ligand on a NVIDIA GTX2070. For TYK2, the runs took 84 and 17 minutes on average, corresponding to ~21 min/ns and ~4 min/ns. Similarly, times were 76 and 19 minutes for CHK1, i.e. ~19 min/ns and ~5 min/ns, respectively. These results were obtained using 
            <rs type="software">OpenMM</rs>'s 31 mixed precision mode. For comparison, it has been reported that FEP+ takes 86 minutes to sample a 1-ns perturbation for 12 windows on 4 NVIDIA Tesla K80 for BACE1 69 complexes (containing 401 amino acids) and 34 minutes for the corresponding simulations of the solvated ligands. 70 This corresponds to ~29 min/ns for the complex and ~11 min/ns for the ligand-only simulations, respectively. The Gromacs -FEP implementation was reported to be 3 to 6 times slower than FEP+. 70 In a benchmark for AMBER-TI, a perturbation in factor Xa (total system size: 41,563 atoms) can be calculated at about 120 ns/day on a NVIDIA GTX1080, corresponding to 12 min/ns . 71 Obviously, the data for the different FEP approaches cannot be directly compared, as the GPUs as well as the proteins used deviate. However, these figures show that the perturbations can be carried out reasonably quickly. In 
            <rs type="software">Flare</rs>, calculating the binding free energy for a ligand pair in TYK2 using 9 λ windows and a 4-ns calculation time can be carried out in ~15 hours on a single modern GPU. Accounting for equilibration time and with sufficient GPUs available this can be parallelized over 18 windows (free and bound legs) to yield a minimum time to answer of about 1.7 hours.
        </p>
        <p>Production runs in the work presented here were 4-ns long for each λ window. However, there is evidence that shorter calculations times (usually 1 ns) may be sufficient to obtain a reasonable free energy estimate for certain classes of perturbations. 24,70 Thus, there may be scope to further decrease time to answer in a scenario where it is important to maximize throughput.Production runs in the work presented here were 4-ns long for each λ window. However, there is evidence that shorter calculations times (usually 1 ns) may be sufficient to obtain a reasonable free energy estimate for certain classes of perturbations. 24,70 Thus, there may be scope to further decrease time to answer in a scenario where it is important to maximize throughput.</p>
        <p>It has been demonstrated that the FEP method for calculating binding free energies implemented in Flare yields results which are on-par with various other published workflows .It has been demonstrated that the FEP method for calculating binding free energies implemented in Flare yields results which are on-par with various other published workflows .</p>
        <p>The method can also readily be applied to more challenging scaffold hopping experiments. The software allows automatic set up of perturbation networks and implements several sanity checks of the reliability of the calculations, such as analysis of cycle closure errors and assessment of overlap matrices. Future work will be focused on enhancing the overlap between the sampled states of a perturbation by non-linearly spaced windows and by adaptive sampling. Furthermore, validation of the method will be extended considering another recently published large dataset for free energy calculations . 72 ASSOCIATED CONTENT Supporting Information. The following files are available free of charge.The method can also readily be applied to more challenging scaffold hopping experiments. The software allows automatic set up of perturbation networks and implements several sanity checks of the reliability of the calculations, such as analysis of cycle closure errors and assessment of overlap matrices. Future work will be focused on enhancing the overlap between the sampled states of a perturbation by non-linearly spaced windows and by adaptive sampling. Furthermore, validation of the method will be extended considering another recently published large dataset for free energy calculations . 72 ASSOCIATED CONTENT Supporting Information. The following files are available free of charge.</p>
        <p>ΔG values of all approaches discussed (XLSX) Jupyter Notebook containing the calculation of R, Kendall's τ, MUE and root mean square error (RMSE) for all datasets (IPYNB) File archive containing the experimental affinities and the ΔΔG values of all approaches discussed for rerunning the calculations in the Jupyter Notebook (ZIP)ΔG values of all approaches discussed (XLSX) Jupyter Notebook containing the calculation of R, Kendall's τ, MUE and root mean square error (RMSE) for all datasets (IPYNB) File archive containing the experimental affinities and the ΔΔG values of all approaches discussed for rerunning the calculations in the Jupyter Notebook (ZIP)</p>
        <p>The manuscript was written through contributions of all authors. All authors have given approval to the final version of the manuscript.The manuscript was written through contributions of all authors. All authors have given approval to the final version of the manuscript.</p>
        <p>R avg is the average correlation coefficient and τ avg the average Kendall τ across all eight datasets.R avg is the average correlation coefficient and τ avg the average Kendall τ across all eight datasets.</p>
        <p>M. K. and J. M. gratefully acknowledge funding by Innovate UK in terms of KTP partnership 011120. A.S.J.S. M. and J. M. acknowledge funding from EPSRC (EP/P022138/1).M. K. and J. M. gratefully acknowledge funding by Innovate UK in terms of KTP partnership 011120. A.S.J.S. M. and J. M. acknowledge funding from EPSRC (EP/P022138/1).</p>
        <p>The authors declare the following competing financial interest(s): M. K., S. F.-C., P. T. and M. M. are Cresset employees. M. M. owns shares in Cresset. Cresset commercially distributes the 
            <rs type="software">Flare</rs> software used in this work.
        </p>
        <p>*mark@cresset-group.com*mark@cresset-group.com</p>
        <p>The authors thank Vytautas Gapsys (Max Planck Institute for Biophysical Chemistry) for sharing the raw data of published free energy calculations 24 and Lingle Wang (Schrödinger) for supplying detailed information about the workflow used in his work. 1The authors thank Vytautas Gapsys (Max Planck Institute for Biophysical Chemistry) for sharing the raw data of published free energy calculations 24 and Lingle Wang (Schrödinger) for supplying detailed information about the workflow used in his work. 1</p>
    </text>
</tei>
