<?xml version="1.0" encoding="UTF-8"?>
<tei xmlns="http://www.tei-c.org/ns/1.0">
    <teiHeader>
        <fileDesc xml:id="_1"/>
        <encodingDesc>
            <appInfo>
                <application version="0.8.1-SNAPSHOT" ident="GROBID" when="2024-06-14T11:33+0000">
                    <ref target="https://github.com/kermitt2/grobid">A machine learning software for extracting information from scholarly documents</ref>
                </application>
            </appInfo>
        </encodingDesc>
    </teiHeader>
    <text xml:lang="en">
        <p>band structure, second-harmonic generation, and GW computations of band gaps), and the library 
            <rs type="software">LIBPAW.</rs>
            <rs type="software">ABINIT</rs> has strong links with many other software projects, that are briefly mentioned.
        </p>
        <p>
            <rs type="software">ABINIT</rs> is probably the first electronic-structure package to have been released under an open-source license, about twenty years ago. It implements density functional theory (DFT), density-functional perturbation theory (DFPT), many-body perturbation theory (GW approximation and Bethe-Salpether equation), and more specific or advanced formalisms, like dynamical mean-field theory (DMFT) and the "temperature-dependent effective potential" (TDEP) approach for anharmonic effects. Relying on planewaves for the representation of wavefunctions, density and other space-dependent quantities, with pseudopotentials or projector-augmented waves (PAW), it is well suited for the study of periodic materials, although nanostructures and molecules can be treated with the supercell technique.
        </p>
        <p>The present article starts with a brief description of the project, a summary of the theories upon which ABINIT relies, and a list of the associated capabilities. It then focuses on selected capabilities that might not be present in the majority of electronic structure packages, either among planewave codes, or in general: treatment of strongly correlated materials using DMFT; materials under finite electric fields; properties at nuclei (electric field gradient, Mössbauer shifts, orbital magnetization); positron annihilation; Raman intensities and electro-optic effect; DFPT calculations of response to strain perturbation (elastic constants, piezoelectricity), spatial dispersion (flexoelectricity), electronic mobility, temperature dependence of the gap, spin-magnetic-field perturbation. The ABINIT DFPT implementation is very general, including systems with van der Waals interaction, or with noncollinear magnetism. Community projects are also described: generation of pseudopotential and PAW data sets, high-throughput calculations (databases of phononThe present article starts with a brief description of the project, a summary of the theories upon which ABINIT relies, and a list of the associated capabilities. It then focuses on selected capabilities that might not be present in the majority of electronic structure packages, either among planewave codes, or in general: treatment of strongly correlated materials using DMFT; materials under finite electric fields; properties at nuclei (electric field gradient, Mössbauer shifts, orbital magnetization); positron annihilation; Raman intensities and electro-optic effect; DFPT calculations of response to strain perturbation (elastic constants, piezoelectricity), spatial dispersion (flexoelectricity), electronic mobility, temperature dependence of the gap, spin-magnetic-field perturbation. The ABINIT DFPT implementation is very general, including systems with van der Waals interaction, or with noncollinear magnetism. Community projects are also described: generation of pseudopotential and PAW data sets, high-throughput calculations (databases of phonon</p>
        <p>Since the introduction of density functional theory (DFT) in 1964 1 , the field of electronic structure calculations has changed profoundly. This theory became the most popular electronic structure method used to characterize materials at the atomic scale and has given rise to different research efforts that have been pushed further by the use and applications of DFT. One of the reasons why this theory has become the workhorse of material characterization is the wide distribution of computational packages, where solutions of the Kohn-Sham equations are implemented. Every package has a different scheme and philosophy, but all of them have in common the generation of a software that is user-friendly and solves the DFT equations. In that respect, 
            <rs type="software">ABINIT</rs> [2][3][4][5] was one of the first free licensed solid-state electronic structure packages on the market.
        </p>
        <p>In this publication, we give first a global overview of ABINIT , at the level of its history, community and impact, as well as its main capabilities. Then, we focus on selected capabilities, that are perceived as rather specific among the set of available first-principle packages.In this publication, we give first a global overview of ABINIT , at the level of its history, community and impact, as well as its main capabilities. Then, we focus on selected capabilities, that are perceived as rather specific among the set of available first-principle packages.</p>
        <p>After describing the historical development of the project and its impact (Sec. II), we present an overview of ABINIT capabilities through a collection of keywords and concepts, with entry points in the documentation (Sec. III). This should allow users to know whether ABINIT is able to deliver some specific property of materials.After describing the historical development of the project and its impact (Sec. II), we present an overview of ABINIT capabilities through a collection of keywords and concepts, with entry points in the documentation (Sec. III). This should allow users to know whether ABINIT is able to deliver some specific property of materials.</p>
        <p>The two next sections, Sec. IV and V, single out some specifics of ABINIT . Sec. IV focuses on ground-state and electronic properties: correlated materials (Dynamical Mean-Field Theory -DMFT) Sec. IV A; treatment of finite electric field, Sec. IV B; properties at the atomic nuclei, Sec. IV C; and positron annihilation, Sec. IV D). Sec. V focuses on response properties: Raman intensities, Sec. IV A; responses to strain, Sec. V B; responses including van der Waals interactions, Sec. V C; spatial dispersion (flexoelectricity and dynamical quadrupoles), Sec. V D; electron-phonon coupling, Sec. V E; temperature-dependent properties of materials in the anharmonic regime, Sec. V F; responses of solids presenting noncollinear magnetism, Sec. V G; response to spin-magnetic perturbation, Sec. V H; and temperature-dependent optical spectra, Sec. V I. Finally, we spend a few words on our recent community efforts related to accurate and efficient Norm-Conserving Pseudopotentials as well as Projector-Augmented Waves (PAW) atomic data, Sec. VI A, to High-Throughput calculations (phonon band structure, second-harmonic generation and accurate GW band gap calculations), Sec. VI B, and to the LIBPAW library, Sec. VI C.The two next sections, Sec. IV and V, single out some specifics of ABINIT . Sec. IV focuses on ground-state and electronic properties: correlated materials (Dynamical Mean-Field Theory -DMFT) Sec. IV A; treatment of finite electric field, Sec. IV B; properties at the atomic nuclei, Sec. IV C; and positron annihilation, Sec. IV D). Sec. V focuses on response properties: Raman intensities, Sec. IV A; responses to strain, Sec. V B; responses including van der Waals interactions, Sec. V C; spatial dispersion (flexoelectricity and dynamical quadrupoles), Sec. V D; electron-phonon coupling, Sec. V E; temperature-dependent properties of materials in the anharmonic regime, Sec. V F; responses of solids presenting noncollinear magnetism, Sec. V G; response to spin-magnetic perturbation, Sec. V H; and temperature-dependent optical spectra, Sec. V I. Finally, we spend a few words on our recent community efforts related to accurate and efficient Norm-Conserving Pseudopotentials as well as Projector-Augmented Waves (PAW) atomic data, Sec. VI A, to High-Throughput calculations (phonon band structure, second-harmonic generation and accurate GW band gap calculations), Sec. VI B, and to the LIBPAW library, Sec. VI C.</p>
        <p>The ABINIT project can be traced back to an initial effort in the late eighties by D.C. Allan, supervised by Michael P. Teter, at Corning Incorporated and Cornell University. The code used norm-conserving pseudopotentials and a planewave representation of the Kohn-Sham orbitals, with the local-density approximation (LDA) as the only exchange-correlation functional available, and was written in FORTRAN 77. In 1990, X. Gonze joined at Cornell, and they implemented density functional perturbation theory (DFPT) on top of what was then dubbed the CORNING code, in a separate application, named RESPFN (Corning Incorporated is a large American company focused on glass and materials applications). After a few years in the hands of Biosym inc., where the name was changed to PLANE_WAVE and the code was sold commercially, the development of CORNING was stopped in 1996. At that point, Gonze and Allan decided to create a free license code that should be available to the community, with the critical recognition that worldwide collaboration was necessary to develop the code. The previous codes (PLANE_WAVE , RESPFN , and CORNING ) became the pillars of this new implementation. Corning Incorporated agreed to release the source of PLANE_WAVE to support this effort and agreed not to enforce a patent they held on the preconditioned conjugate gradient algorithm. 6 The code was rewritten in Fortran 90 with parallel features, originally named DFT2000 but soon changed to ABINIT (September 1998).The ABINIT project can be traced back to an initial effort in the late eighties by D.C. Allan, supervised by Michael P. Teter, at Corning Incorporated and Cornell University. The code used norm-conserving pseudopotentials and a planewave representation of the Kohn-Sham orbitals, with the local-density approximation (LDA) as the only exchange-correlation functional available, and was written in FORTRAN 77. In 1990, X. Gonze joined at Cornell, and they implemented density functional perturbation theory (DFPT) on top of what was then dubbed the CORNING code, in a separate application, named RESPFN (Corning Incorporated is a large American company focused on glass and materials applications). After a few years in the hands of Biosym inc., where the name was changed to PLANE_WAVE and the code was sold commercially, the development of CORNING was stopped in 1996. At that point, Gonze and Allan decided to create a free license code that should be available to the community, with the critical recognition that worldwide collaboration was necessary to develop the code. The previous codes (PLANE_WAVE , RESPFN , and CORNING ) became the pillars of this new implementation. Corning Incorporated agreed to release the source of PLANE_WAVE to support this effort and agreed not to enforce a patent they held on the preconditioned conjugate gradient algorithm. 6 The code was rewritten in Fortran 90 with parallel features, originally named DFT2000 but soon changed to ABINIT (September 1998).</p>
        <p>The first version of 
            <rs type="software">ABINIT</rs> was made public in March 1999, primarily to beta testers. Initially, 
            <rs type="software">ABINIT</rs> was only able to find the total energy, electronic charge density, and the electronic structures of periodic systems, using pseudopotentials and a planewave basis. In July 1999, the full response function capability was also available. This implementation was a significant step, as it was one of the only codes that allow users to calculate phonons, dielectric constants, Born effective charges, etc. The first publicly available release of 
            <rs type="software">ABINIT</rs> was made in December 1999, under the GNU General Public License. In June 2000, an international advisory committee was selected, to help with the strategy, support and management of the code. The first ABINIT developer workshop took place in Louvain-la-Neuve in 2002. Since then, the developer Abinit meeting takes place every two years. The 9th developer workshop took place in Louvain-la-Neuve in 2019, with the participation of around 60 speakers.
        </p>
        <p>The 
            <rs type="software">ABINIT</rs> spirit is not only to offer the community a free license code but also to encourage users and developers to reuse parts of the computational package. The source code is always available, and if a user is interested in introducing specific implementations into the package, an account on GitHub suffices, such that changes can be merged and tested in the official version. The 
            <rs type="software">ABINIT</rs> community has created a series of methods and tests to guarantee the stability of the code, precisely to avoid the introduction of errors by new implementations. 
            <rs type="software">ABINIT</rs> is a very well documented code, with extensive description of installation, details of the input variables and their different dependencies, a very established tutorial, with specific applications and a full set of examples (more than 800). To support general users, 
            <rs type="software">ABINIT</rs> has created a Forum, which is linked to the 
            <rs type="software">ABINIT</rs> web site, and allows users to ask questions related to theory, implementations or use of 
            <rs type="software">ABINIT</rs> . The Forum is a primary resource for users, and both developers and users answer questions and offer advice.
        </p>
        <p>To spread the use of ABINIT and to train young scientists in the field of electronic structure, the ABINIT developers have been supporting schools around the world. While the first ABINIT workshop was in 2002, there are usually between 2-3 schools and workshops per year in many different places. There is a regular presence at the March Meeting of the American Physical Society, where half day tutorials are organized by the ABINIT community, and at CECAM. Some of the CECAM events are theory oriented workshops, with discussions of the formalism and algorithms behind ABINIT , and examples of calculations are discussed. On the other hand, there are also regular CECAM hands-on schools, which allow users to gain experience in the use of ABINIT , and also learn the theoretical background. These schools are very well attended, but depend on specific locations with sufficient access to computational facilities. In all cases, the presentations of the ABINIT developer workshops, schools and conferences are stored in the ABINIT web page and are accessible globally. These presentations offer the users details of code but are also an archive of the different implementations and how they have been tested and used.To spread the use of ABINIT and to train young scientists in the field of electronic structure, the ABINIT developers have been supporting schools around the world. While the first ABINIT workshop was in 2002, there are usually between 2-3 schools and workshops per year in many different places. There is a regular presence at the March Meeting of the American Physical Society, where half day tutorials are organized by the ABINIT community, and at CECAM. Some of the CECAM events are theory oriented workshops, with discussions of the formalism and algorithms behind ABINIT , and examples of calculations are discussed. On the other hand, there are also regular CECAM hands-on schools, which allow users to gain experience in the use of ABINIT , and also learn the theoretical background. These schools are very well attended, but depend on specific locations with sufficient access to computational facilities. In all cases, the presentations of the ABINIT developer workshops, schools and conferences are stored in the ABINIT web page and are accessible globally. These presentations offer the users details of code but are also an archive of the different implementations and how they have been tested and used.</p>
        <p>The ABINIT community champions free software development, but also wants to keep the integrity and modularity of the computational package. All new developments need to be approved by the community, to be sure to keep track of the different efforts, and conduct a minimal screening on the dependability and ethical behavior of people involved in the code development. The driving idea is to preserve a constructive and supporting environment for all scientists willing to collaborate. All major implementation efforts in ABINIT are connected to individual publications but they are also introduced through specific publications, about every three-five years, where the most recent research efforts are described. With this method, ABINIT tries to acknowledge the developers' achievements and use these publications to describe how the new implementations are part of the broader package. The ABINIT attitude towards publications is based on research independence, but also collaborative efforts that continue to grow the computational package.The ABINIT community champions free software development, but also wants to keep the integrity and modularity of the computational package. All new developments need to be approved by the community, to be sure to keep track of the different efforts, and conduct a minimal screening on the dependability and ethical behavior of people involved in the code development. The driving idea is to preserve a constructive and supporting environment for all scientists willing to collaborate. All major implementation efforts in ABINIT are connected to individual publications but they are also introduced through specific publications, about every three-five years, where the most recent research efforts are described. With this method, ABINIT tries to acknowledge the developers' achievements and use these publications to describe how the new implementations are part of the broader package. The ABINIT attitude towards publications is based on research independence, but also collaborative efforts that continue to grow the computational package.</p>
        <p>The research interest of the developers group (around 50 people at the time of writing) are respected by the ABINIT community and overseen by an international advisory committee. This committee consists of around ten senior scientists, which have been involved in the development of ABINIT and have been supportive of the philosophy and efforts of the community.The research interest of the developers group (around 50 people at the time of writing) are respected by the ABINIT community and overseen by an international advisory committee. This committee consists of around ten senior scientists, which have been involved in the development of ABINIT and have been supportive of the philosophy and efforts of the community.</p>
        <p>A metric of ABINIT 's impact can be obtained by using bibliometric analysis accessed from the Web of Science (data taken on December 26 th , 2019). This can be assessed by adding all citations of all the main papers reporting ABINIT developments, meaning Refs. 2-5. We found a total of 5125 citations since 2002, of which 3995 are unique, with an average number above 250 total citations per year since 2011 (see Figure 1). Using this database of unique entries, we can address the impact of ABINIT on different fields of science by counting some of the papers reported in high impact journals. For example, there are 160 papers from Physical Review Letters, 109 Journal of Chemical Physics, 108 Computational Materials Science, 32 Nano Letters, 33 Scientific Reports, 18 Nature Communications, 8 Nature Materials, 7 Nature, etc. As it is clear from this analysis, ABINIT is a healthy package that impacts several scientific fields and supports the work of many agencies and institutions, with authors of 84 different countries and from more than 2000 different institutions.A metric of ABINIT 's impact can be obtained by using bibliometric analysis accessed from the Web of Science (data taken on December 26 th , 2019). This can be assessed by adding all citations of all the main papers reporting ABINIT developments, meaning Refs. 2-5. We found a total of 5125 citations since 2002, of which 3995 are unique, with an average number above 250 total citations per year since 2011 (see Figure 1). Using this database of unique entries, we can address the impact of ABINIT on different fields of science by counting some of the papers reported in high impact journals. For example, there are 160 papers from Physical Review Letters, 109 Journal of Chemical Physics, 108 Computational Materials Science, 32 Nano Letters, 33 Scientific Reports, 18 Nature Communications, 8 Nature Materials, 7 Nature, etc. As it is clear from this analysis, ABINIT is a healthy package that impacts several scientific fields and supports the work of many agencies and institutions, with authors of 84 different countries and from more than 2000 different institutions.</p>
        <p>An overview of the capabilities of a large scientific code can be structured in different ways. The present work targets users who simply wish to know whether ABINIT is able to compute a particular property of a material or nanosystem, and possibly to represent it graphically. In this respect, Tables I andII present an alphabetic list of keywords (or concepts), that best represent a capability of ABINIT , with related documentation: possibly some section of the present publication, and/or reference to some "topics" of the on-line ABINIT Web documentation https://docs.abinit.org/topics/features, and/or reference to some scripts and illustrations in the ABIPY gallery http://abinit.github.io/abipy/gallery/index.html. Highlighted (bold) keywords refer to specific sections of the present publication. The emphasis on these keywords stems from the belief that such characteristics/capabilities of ABINIT are not commonly found among first-principles codes, and can be put forward as examples of what makes ABINIT unique.An overview of the capabilities of a large scientific code can be structured in different ways. The present work targets users who simply wish to know whether ABINIT is able to compute a particular property of a material or nanosystem, and possibly to represent it graphically. In this respect, Tables I andII present an alphabetic list of keywords (or concepts), that best represent a capability of ABINIT , with related documentation: possibly some section of the present publication, and/or reference to some "topics" of the on-line ABINIT Web documentation https://docs.abinit.org/topics/features, and/or reference to some scripts and illustrations in the ABIPY gallery http://abinit.github.io/abipy/gallery/index.html. Highlighted (bold) keywords refer to specific sections of the present publication. The emphasis on these keywords stems from the belief that such characteristics/capabilities of ABINIT are not commonly found among first-principles codes, and can be put forward as examples of what makes ABINIT unique.</p>
        <p>In the "topics" tags of the online ABINIT Web documentation, we try to address the generic challenge of software documentation, by providing for each topic a hub to the underlying theory (including bibliographical references), to the related ABINIT input variables, to the example ABINIT input files and to the ABINIT tutorials, also mentioning possible restrictions in the implementation, or different levels of accuracy of the implementation.In the "topics" tags of the online ABINIT Web documentation, we try to address the generic challenge of software documentation, by providing for each topic a hub to the underlying theory (including bibliographical references), to the related ABINIT input variables, to the example ABINIT input files and to the ABINIT tutorials, also mentioning possible restrictions in the implementation, or different levels of accuracy of the implementation.</p>
        <p>
            <rs type="software">ABINIT</rs> implements different first-principles formalisms, i.e. DFT 7 , DFPT 3,[8][9][10] , time-dependent density functional the-ory (TD-DFT) 11 , many-body perturbation theory (MBPT) 12 and DMFT 13,14 . Each of these formalisms allows one to address different properties at different levels of accuracy. As an example, the electronic band gap can be computed from DFT, but the predicted value is notoriously inaccurate. In- stead, the band gap is better computed using the GW approximation within MBPT, also implemented in 
            <rs type="software">ABINIT</rs> . Moreover, even within MBPT-GW, different levels of accuracy are available: the simple one-shot G 0 W 0 approach, with different plasmon pole models, or more sophisticated self-consistent flavors of GW (SCGW). Similarly, different families of exchange-correlations functionals can be used in DFT: LDA, generalized-gradient approximation (GGA), meta-GGA, hybrid functionals, van der Waals (vdW) cor-rected functionals. It will not be the purpose of the present section to specify for each property the different levels of accuracy. By contrast, such information might be found thanks to the on-line ABINIT topics. Similarly, within some formalism, the 
            <rs type="software">ABINIT</rs> implementation might not be compatible with both the norm-conserving pseudopotential (NCPSP) approach and the PAW approach. Also, the treatment of non-spin-polarized systems, collinear magnetic systems, collinear antiferromagnetic systems, and non-collinear magnetic systems might not all be available. In Ref. [4], we provided such a more detailed description of the formalism+implementation level for many of the 
            <rs type="software">ABINIT</rs> capabilities (see Tables 1 -4 of Ref. [4]). 
            <rs type="software">ABINIT</rs> has evolved since then, and the best available source of information is now the on-line topics.
        </p>
        <p>Also, 
            <rs type="software">ABINIT</rs> has several graphical post-processors, including ABIPY and AGATE . A gallery of ABIPY examples (with associated Jupyter notebooks) is available at http:// abinit.github.io/abipy/gallery/index.html. The links to these examples are also mentioned in Tables I andII.
        </p>
        <p>Finally, note that some of the capabilities of ABINIT are presently not yet available/documented in the latest public release of ABINIT (v8), but will be so in the forthcoming one (v9). Some of these are mentioned in a section of the present paper, but there is no associated topic or ABIPY example. Some of the common variables used within this text are found in Table III.Finally, note that some of the capabilities of ABINIT are presently not yet available/documented in the latest public release of ABINIT (v8), but will be so in the forthcoming one (v9). Some of these are mentioned in a section of the present paper, but there is no associated topic or ABIPY example. Some of the common variables used within this text are found in Table III.</p>
        <p>A. Correlated materials: Dynamical-Mean Field Theory Systems with localized orbitals, such as transition metals, lanthanides or actinides exhibit strong correlation effects and are difficult to describe using DFT with currently available functionals 14 . One way to improve their description is to explicitly include the onsite Coulomb interaction U between the electrons in the correlated orbitals of the system (e.g the d or f shells).A. Correlated materials: Dynamical-Mean Field Theory Systems with localized orbitals, such as transition metals, lanthanides or actinides exhibit strong correlation effects and are difficult to describe using DFT with currently available functionals 14 . One way to improve their description is to explicitly include the onsite Coulomb interaction U between the electrons in the correlated orbitals of the system (e.g the d or f shells).</p>
        <p>The DFT+U method, available in ABINIT [15][16][17] , treats this interaction statically and is most efficient on magnetic Mott insulators. To describe in a more coherent way systems with various interaction strengths, the method of choice is DMFT 13 . This method solves the local many-body problem for a given correlated atom in the effective field created by the other atoms. This field is self-consistently related to the solution of the atomic impurity problem. The combination of DFT with DMFT 14,18 enables the description of realistic systems with both correlated and non-correlated electrons. The DFT+DMFT method has been helpful to improve in particular spectral functions (describing both Hubbard bands and quasiparticle peaks in the spectral function), total energy (for e.g. iron systems, actinides or lanthanides), and magnetic properties (see e.g Ref. 14).The DFT+U method, available in ABINIT [15][16][17] , treats this interaction statically and is most efficient on magnetic Mott insulators. To describe in a more coherent way systems with various interaction strengths, the method of choice is DMFT 13 . This method solves the local many-body problem for a given correlated atom in the effective field created by the other atoms. This field is self-consistently related to the solution of the atomic impurity problem. The combination of DFT with DMFT 14,18 enables the description of realistic systems with both correlated and non-correlated electrons. The DFT+DMFT method has been helpful to improve in particular spectral functions (describing both Hubbard bands and quasiparticle peaks in the spectral function), total energy (for e.g. iron systems, actinides or lanthanides), and magnetic properties (see e.g Ref. 14).</p>
        <p>The method has been implemented in 
            <rs type="software">ABINIT</rs> 5,19,21 and is presented in a tutorial. The key points of the available DFT+DMFT implementation are the following:
        </p>
        <p>• Correlated orbitals are defined as Projected Local Orbitals Wannier functions 21 , their localization can easily be changed by modifying the associated energy windows.• Correlated orbitals are defined as Projected Local Orbitals Wannier functions 21 , their localization can easily be changed by modifying the associated energy windows.</p>
        <p>• The method is fully self-consistent with respect to the electronic density (see Fig. 2) 19 . Positron Lifetime χ (1) First order electric susceptibility χ (2) Second order susceptibility • Impurity solvers directly available in 
            <rs type="software">ABINIT</rs> are the Hubbard I method and the Continuous Time Quantum Monte Carlo 22 (using either a diagonal or a general hybridization function) in the simplified but efficient density-density approximation 19,23 . Spin-orbit coupling calculations are possible, using a real valued imaginary time hybridization function. • Internal energy and electronic entropy can be computed 19,23 .
        </p>
        <p>• Impurity and k-resolved spectral functions can be computed using analytical continuation of the Green's function or the self-energy, with an external code (e.g OmegaMaxent 24 ). Fig. 3 shows the LDA+DMFT spectral function of α-cerium, as computed in ABINIT .• Impurity and k-resolved spectral functions can be computed using analytical continuation of the Green's function or the self-energy, with an external code (e.g OmegaMaxent 24 ). Fig. 3 shows the LDA+DMFT spectral function of α-cerium, as computed in ABINIT .</p>
        <p>• Several parallelization schemes can be used 17 , allowing application of the method to large systems.• Several parallelization schemes can be used 17 , allowing application of the method to large systems.</p>
        <p>• ABINIT is coupled to the CTHYB impurity solver of the TRIQS library 25,26 through a C++ interface. This allows one to solve the impurity problem in the fully rotationally invariant formulation of the interacting Hamiltonian.• ABINIT is coupled to the CTHYB impurity solver of the TRIQS library 25,26 through a C++ interface. This allows one to solve the impurity problem in the fully rotationally invariant formulation of the interacting Hamiltonian.</p>
        <p>• 
            <rs type="software">ABINIT</rs> is built with a python invocation scheme that allows any personalised python 
            <rs type="software">script</rs> to solve the impurity problem. Thus, an experienced user can invoke their favourite solver within a DFT+DMFT calculation from 
            <rs type="software">ABINIT</rs> .
        </p>
        <p>DFT+DMFT uses effective interactions parameters U and J as input. They can be computed in ABINIT 27 on the same correlated Wannier orbitals, using the constrained Random Phase Approximation (cRPA) method 28,29 . In cRPA 29 , as the screening arising from electronic transitions among the correlated shell is a correlation effect already described in the CTQMC solution of the impurity problem, only other electronic transitions are used to compute the screening 29 . The cRPA method in ABINIT is documented by a tutorial.DFT+DMFT uses effective interactions parameters U and J as input. They can be computed in ABINIT 27 on the same correlated Wannier orbitals, using the constrained Random Phase Approximation (cRPA) method 28,29 . In cRPA 29 , as the screening arising from electronic transitions among the correlated shell is a correlation effect already described in the CTQMC solution of the impurity problem, only other electronic transitions are used to compute the screening 29 . The cRPA method in ABINIT is documented by a tutorial.</p>
        <p>These schemes were recently used in f electron systems to compute the f effective interactions parameters 20,27,30 and to improve the description of their spectral or structural properties 16,20,23,31 and improve our understanding of the superconducting symmetries in Sr 2 RuO 4 32 .These schemes were recently used in f electron systems to compute the f effective interactions parameters 20,27,30 and to improve the description of their spectral or structural properties 16,20,23,31 and improve our understanding of the superconducting symmetries in Sr 2 RuO 4 32 .</p>
        <p>ABINIT can be used to compute the response to electric fields in several ways. From DFPT, the susceptibility can be calculated 33,34 as the second-order derivative of the total energy at zero field ∂ 2 E/∂ E i ∂ E J . Alternatively, the first order derivative is the electrical polarization P, which may be nonzero even in the absence of external fields, e.g. in ferroelectric materials. Computing this term appears formally equivalent to computing dr rn(r), that is, the dipole moment density, but this expression is ill-defined in an extended system. This problem is solved by the modern theory of polarization 35 , in which the key insight is the recognition that while the polarization is not well-defined, its derivative with respect to a change in the system is, and so the polarization may be computed (up to a constant) through integration. The key formula isABINIT can be used to compute the response to electric fields in several ways. From DFPT, the susceptibility can be calculated 33,34 as the second-order derivative of the total energy at zero field ∂ 2 E/∂ E i ∂ E J . Alternatively, the first order derivative is the electrical polarization P, which may be nonzero even in the absence of external fields, e.g. in ferroelectric materials. Computing this term appears formally equivalent to computing dr rn(r), that is, the dipole moment density, but this expression is ill-defined in an extended system. This problem is solved by the modern theory of polarization 35 , in which the key insight is the recognition that while the polarization is not well-defined, its derivative with respect to a change in the system is, and so the polarization may be computed (up to a constant) through integration. The key formula is</p>
        <p>Eq. ( 1) is implemented in 
            <rs type="software">ABINIT</rs> using both NCPSP and the PAW formalism. In both cases the wavefunction derivatives are computed using a finite-difference scheme, so that a coherent phase relationship between the k-points may be ensured. From this approach, the polarization may be computed.
        </p>
        <p>With a scheme in place to compute the polarization, the response to a finite electric field may be computed by adding a term -P • E to the total energy 36 . Then, its effect is included in the self-consistent energy minimization cycle, through the gradient δ (-P • E )/δ u nk | 37,38 . In this way, Kohn-Sham states that minimize the total energy including the electric field are found (the polarization from Eq. ( 1) is updated at each step as the Kohn-Sham states evolve), provided that the field is not so strong that the insulating gap breaks down.With a scheme in place to compute the polarization, the response to a finite electric field may be computed by adding a term -P • E to the total energy 36 . Then, its effect is included in the self-consistent energy minimization cycle, through the gradient δ (-P • E )/δ u nk | 37,38 . In this way, Kohn-Sham states that minimize the total energy including the electric field are found (the polarization from Eq. ( 1) is updated at each step as the Kohn-Sham states evolve), provided that the field is not so strong that the insulating gap breaks down.</p>
        <p>Using this approach we have computed a number of responses, including linear terms that permit validation against DFPT, and nonlinear responses that are only available using finite field calculations 38 .Using this approach we have computed a number of responses, including linear terms that permit validation against DFPT, and nonlinear responses that are only available using finite field calculations 38 .</p>
        <p>ABINIT provides several features for computing properties that arise from the electronic structure very near the atomic nuclei. These features are of use for computing and interpreting a variety of experimental probes, in particular Mössbauer spectroscopy 39 , and nuclear magnetic and nuclear quadrupole resonance spectroscopy 40,41 .ABINIT provides several features for computing properties that arise from the electronic structure very near the atomic nuclei. These features are of use for computing and interpreting a variety of experimental probes, in particular Mössbauer spectroscopy 39 , and nuclear magnetic and nuclear quadrupole resonance spectroscopy 40,41 .</p>
        <p>Such observables involve the overlap of the electronic wavefunctions with the nucleus, in the case of the Mössbauer isomer shift, and the gradient of the electric field at the nucleus, observed in both Mössbauer spectra and magnetic resonance experiments. As both observables depend sensitively on details of the electronic structure very close to the nuclear position, these are cases where a planewave-only treatment with NCPSP is quite inaccurate and it is necessary to use the PAW formalism.Such observables involve the overlap of the electronic wavefunctions with the nucleus, in the case of the Mössbauer isomer shift, and the gradient of the electric field at the nucleus, observed in both Mössbauer spectra and magnetic resonance experiments. As both observables depend sensitively on details of the electronic structure very close to the nuclear position, these are cases where a planewave-only treatment with NCPSP is quite inaccurate and it is necessary to use the PAW formalism.</p>
        <p>The Mössbauer isomer shift δ , in velocity units, is determined by the overlap of the electronic density with a nucleus undergoing a nuclear state transition, and is given byThe Mössbauer isomer shift δ , in velocity units, is determined by the overlap of the electronic density with a nucleus undergoing a nuclear state transition, and is given by</p>
        <p>for the electron density of the absorber (A) and source (S) at the nucleus (here located at 0). In this formula, E γ , the energy of a nuclear transition, and ∆ r 2 , the change in size of the nucleus, are nuclear properties that must be supplied by the user, while ABINIT can determine the electronic contributions ρ A and ρ S . To do this, the PAW formalism is used, in which an observable A is computed as [42][43][44]for the electron density of the absorber (A) and source (S) at the nucleus (here located at 0). In this formula, E γ , the energy of a nuclear transition, and ∆ r 2 , the change in size of the nucleus, are nuclear properties that must be supplied by the user, while ABINIT can determine the electronic contributions ρ A and ρ S . To do this, the PAW formalism is used, in which an observable A is computed as [42][43][44]</p>
        <p>For properly constructed PAW data, all-electron accuracy may be recovered in this formalism. For computation of ρ(0) appearing in Eq. ( 2), we use as the observable the 3-D deltafunction δ (0) 39 .For properly constructed PAW data, all-electron accuracy may be recovered in this formalism. For computation of ρ(0) appearing in Eq. ( 2), we use as the observable the 3-D deltafunction δ (0) 39 .</p>
        <p>Using the above formalism, isomer shifts may also be computed, given available data for E γ and ∆ r 2 for the transition in question. To validate the method, a range of shifts were computed and then ∆ r 2 extracted by comparison to known shifts; we found excellent agreement for a variety of nuclei, including tin, germanium, and zinc 39 . The zinc case is a very stringent test because the isomer shift range is so small and the transition so sharp; accurate modeling requires inclusion of the secondary Doppler shift, which we computed by first principles from the phonon dispersion relations. The secondary Doppler shift takes the form S D =v 2 /2c, and is obtainable once the full phonon dispersion curves are computed. We found that even in this case the PAW-derived ∆ r 2 was in excellent agreement with experimental values 39 .Using the above formalism, isomer shifts may also be computed, given available data for E γ and ∆ r 2 for the transition in question. To validate the method, a range of shifts were computed and then ∆ r 2 extracted by comparison to known shifts; we found excellent agreement for a variety of nuclei, including tin, germanium, and zinc 39 . The zinc case is a very stringent test because the isomer shift range is so small and the transition so sharp; accurate modeling requires inclusion of the secondary Doppler shift, which we computed by first principles from the phonon dispersion relations. The secondary Doppler shift takes the form S D =v 2 /2c, and is obtainable once the full phonon dispersion curves are computed. We found that even in this case the PAW-derived ∆ r 2 was in excellent agreement with experimental values 39 .</p>
        <p>The electric field gradient calculation proceeds along similar lines, except the observable of interest is now the second derivative of the potential n(r)/|r -r |, for density n(r). The implementation in 
            <rs type="software">ABINIT</rs> 40 is similar to that in other codes, such as QUANTUM ESPRESSO 45 . As usual in PAW, the density is decomposed into a planewave-based part, and PAWsphere corrections. In addition, there is a charge density due to the ions. The planewave-based field gradient is computed in reciprocal space and then evaluated at the nuclear site of interest by Fourier-transformation; the PAW-sphere corrections are computed in real space, noting that the use of the PAW compensation charge ensures that no inter-sphere contributions need be considered; and the gradient due to the fixed ions is computed using an Ewald-sum method 46 . As an example of the application of this feature, we showed 41 the sensitivity of the electric field gradient response to strong correlation effects in LaTiO 3 , by combining the field gradient calculation with the DFT+U method, also available in 
            <rs type="software">ABINIT</rs> , see Sec. IV A.
        </p>
        <p>One of the unique features of ABINIT is the fully selfconsistent implementation of two-component density functional theory (TCDFT) 47,48 within the PAW formalism 44 . This technique allows one to accurately compute various properties of annihilating electron-positron pairs, which in turn can be used to interpret positron annihilation spectroscopy (PAS) measurements 49 .One of the unique features of ABINIT is the fully selfconsistent implementation of two-component density functional theory (TCDFT) 47,48 within the PAW formalism 44 . This technique allows one to accurately compute various properties of annihilating electron-positron pairs, which in turn can be used to interpret positron annihilation spectroscopy (PAS) measurements 49 .</p>
        <p>Within TCDFT, the total energy of interacting positrons and electrons is written as:Within TCDFT, the total energy of interacting positrons and electrons is written as:</p>
        <p>where n + and n -are positron and electron densities, E[n + ] and E[n -] are one-component functionals for positron and electrons, and dr dr n -(r)n + (r)where n + and n -are positron and electron densities, E[n + ] and E[n -] are one-component functionals for positron and electrons, and dr dr n -(r)n + (r)</p>
        <p>|r-r | corresponds to the Hartree interaction. Various approximations can be used to calculate the E e-p c term, both within LDA 48,50 and GGA. 51,52 The TCDFT implementation in 
            <rs type="software">ABINIT</rs> is based on a unified formalism, in which both electron and positron wavefunctions are expressed using the same mixed PAW basis (planewaves and atomic orbitals) 53 . This means that the electronic and positronic energies and forces can be calculated self-consistently. It allows, for example, for full geometry optimisation of systems containing positrons, an effect which has been shown to be critical in determining reliable annihilation features 54 . It is worth noting, however, that the positron calculations within the PAW method are sensitive to the completeness of the PAW dataset. To achieve accurate description of positron densities and wavefunctions, it is often necessary to include semicore electrons in the PAW dataset 53 .
        </p>
        <p>Various properties of annihilating electron-positron pairs can be calculated within ABINIT . First, positronic wavefunctions and densities in the direct space can be accessed and visualized to inspect the localization of the particle in a given system. An example is given in Fig. 4, where the isodensity of a positron localized in a silicon vacancy in SiC is shown. Second, total energies of a system containing a positron can be used to calculate binding energies or affinities. Third, based on the electron and positron densities, the positron lifetime τ FIG. 4. Isodensity of a positron localized inside a silicon vacancy in silicon carbide. The figure was generated using VMD 62 . can be calculated, as the inverse of the annihilation rate λ :Various properties of annihilating electron-positron pairs can be calculated within ABINIT . First, positronic wavefunctions and densities in the direct space can be accessed and visualized to inspect the localization of the particle in a given system. An example is given in Fig. 4, where the isodensity of a positron localized in a silicon vacancy in SiC is shown. Second, total energies of a system containing a positron can be used to calculate binding energies or affinities. Third, based on the electron and positron densities, the positron lifetime τ FIG. 4. Isodensity of a positron localized inside a silicon vacancy in silicon carbide. The figure was generated using VMD 62 . can be calculated, as the inverse of the annihilation rate λ :</p>
        <p>where g(n -, n + ) is an enhancement factor, corresponding to the increase in annihilation due to the screening of the positron by the electrons. Several parametrizations for g(n -, n + ) can be used in ABINIT . Finally, the electron and positron wavefunctions can be used to calculate momentum distributions ρ(p) of annihilating pairs, following 47where g(n -, n + ) is an enhancement factor, corresponding to the increase in annihilation due to the screening of the positron by the electrons. Several parametrizations for g(n -, n + ) can be used in ABINIT . Finally, the electron and positron wavefunctions can be used to calculate momentum distributions ρ(p) of annihilating pairs, following 47</p>
        <p>where Ψ e-p i is the two-particle wavefunction in the state i, and p is the given momentum.where Ψ e-p i is the two-particle wavefunction in the state i, and p is the given momentum.</p>
        <p>The TCDFT implementation in ABINIT has already been applied to various systems. It has been used to calculate annihilation properties of bulk metals and semiconductors 53 . Calculations for vacancy-type defects in systems such as SiC [54][55][56] UO 2 , 57,58 GaN, 59 and yttria-stabilized zirconia, 60 have been performed and used to analyze experimental data. Positron lifetimes and binding energies have also been investigated on Fe(001) surfaces with and without adatoms 61 .The TCDFT implementation in ABINIT has already been applied to various systems. It has been used to calculate annihilation properties of bulk metals and semiconductors 53 . Calculations for vacancy-type defects in systems such as SiC [54][55][56] UO 2 , 57,58 GaN, 59 and yttria-stabilized zirconia, 60 have been performed and used to analyze experimental data. Positron lifetimes and binding energies have also been investigated on Fe(001) surfaces with and without adatoms 61 .</p>
        <p>Many physical properties of materials can be formulated as derivatives of the energy. Although such derivatives might be computed from finite differences techniques, they can also be conveniently determined from perturbation theory. ABINIT does not only compute many energy derivatives from DFPT but also gives readily access to various related physical quantities in Cartesian coordinates and conventional units.Many physical properties of materials can be formulated as derivatives of the energy. Although such derivatives might be computed from finite differences techniques, they can also be conveniently determined from perturbation theory. ABINIT does not only compute many energy derivatives from DFPT but also gives readily access to various related physical quantities in Cartesian coordinates and conventional units.</p>
        <p>As a basic feature, ABINIT routinely determines standard second energy derivatives with respect to atomic displacement (τ q ), homogeneous static electric field (E ) and homogeneousAs a basic feature, ABINIT routinely determines standard second energy derivatives with respect to atomic displacement (τ q ), homogeneous static electric field (E ) and homogeneous</p>
        <p>Array of second derivatives of the appropriate energy functional with respect to atomic displacement (τ), electric field (E ) and strain (η) perturbations. In addition to these three types of perturbations, the magnetic field perturbation is also implemented, with corresponding cross derivatives, see Sec. V H. strain (η) perturbations 33,34,63 , which are related to dynamical matrices at any q-vector (D q ), optical dielectric tensor (ε ∞ ), Born effective charge tensors (Z * ), clamped-ion elastic tensors (C 0 ), clamped-ion piezoelectric tensors (e 0 ) and lattice-strain coupling tensor (γ) as summarized in Table IV. Relying on these bare quantities ABINIT also provides access to additional properties like the full phonon dispersion curves (interpolated by separating short-range and long-range dipolar interactions), interatomic force constants in real space (short-range and dipolar contributions), infra-red intensities, static and infra-red dielectric constants, relaxed ion elastic and piezoelectric tensors. All of these are accessible both with NCPSP and in PAW, using LDA or GGA functionals. The specific case of the strain perturbation 63 that is a unique feature of ABINIT is further discussed in Section V.B Going further, ABINIT also implements some third-order energy derivatives and responses to additional perturbations, providing access to an even much broader set of properties as discussed below.Array of second derivatives of the appropriate energy functional with respect to atomic displacement (τ), electric field (E ) and strain (η) perturbations. In addition to these three types of perturbations, the magnetic field perturbation is also implemented, with corresponding cross derivatives, see Sec. V H. strain (η) perturbations 33,34,63 , which are related to dynamical matrices at any q-vector (D q ), optical dielectric tensor (ε ∞ ), Born effective charge tensors (Z * ), clamped-ion elastic tensors (C 0 ), clamped-ion piezoelectric tensors (e 0 ) and lattice-strain coupling tensor (γ) as summarized in Table IV. Relying on these bare quantities ABINIT also provides access to additional properties like the full phonon dispersion curves (interpolated by separating short-range and long-range dipolar interactions), interatomic force constants in real space (short-range and dipolar contributions), infra-red intensities, static and infra-red dielectric constants, relaxed ion elastic and piezoelectric tensors. All of these are accessible both with NCPSP and in PAW, using LDA or GGA functionals. The specific case of the strain perturbation 63 that is a unique feature of ABINIT is further discussed in Section V.B Going further, ABINIT also implements some third-order energy derivatives and responses to additional perturbations, providing access to an even much broader set of properties as discussed below.</p>
        <p>Beyond the development of DFPT up to second-order 34 , non-linear properties can be accessed using third-order DFPT. Thanks to the 2n + 1 theorem 9,64,65 , third-order energy derivatives can be obtained from wavefunction derivatives up to first order, as already done in second-order response calculations. So, the additional computational cost to access such third energy derivatives is typically negligible compared to that needed for second-order energy derivatives. There are, however, some linear and non-linear properties in which an analytic treatment of the electric field perturbation requires supplementary wavefunction derivatives 33 .Beyond the development of DFPT up to second-order 34 , non-linear properties can be accessed using third-order DFPT. Thanks to the 2n + 1 theorem 9,64,65 , third-order energy derivatives can be obtained from wavefunction derivatives up to first order, as already done in second-order response calculations. So, the additional computational cost to access such third energy derivatives is typically negligible compared to that needed for second-order energy derivatives. There are, however, some linear and non-linear properties in which an analytic treatment of the electric field perturbation requires supplementary wavefunction derivatives 33 .</p>
        <p>In ABINIT , the accessible non-linear properties are (i) the second-order optical susceptibilities (χ (2) ), (ii) the Raman tensors (α m ), and (iii) the electro-optic tensor (r).In ABINIT , the accessible non-linear properties are (i) the second-order optical susceptibilities (χ (2) ), (ii) the Raman tensors (α m ), and (iii) the electro-optic tensor (r).</p>
        <p>The second-order nonlinear optical susceptibility is a thirdrank tensor related to the response of the electrons of the system to optical electric fields, which are a priori frequency dependent. In the present ABINIT context of the 2n + 1 theorem applied to (static) DFT, we neglect the dispersion of χ (2) and compute it as the purely electronic response of the system at zero frequency. Within these conditions, χ (2) is formulated as a third-order derivative of a field-dependent energy functional:The second-order nonlinear optical susceptibility is a thirdrank tensor related to the response of the electrons of the system to optical electric fields, which are a priori frequency dependent. In the present ABINIT context of the 2n + 1 theorem applied to (static) DFT, we neglect the dispersion of χ (2) and compute it as the purely electronic response of the system at zero frequency. Within these conditions, χ (2) is formulated as a third-order derivative of a field-dependent energy functional:</p>
        <p>The χ (2) tensor delivered by ABINIT is related to the nonlinear optic "d-tensor" asThe χ (2) tensor delivered by ABINIT is related to the nonlinear optic "d-tensor" as</p>
        <p>i jk and can be calculated with an additional scissor correction on the electron band energies. Such second-order optical susceptibility has been recently used for high-throughput Second-Harmonic Generation calculations, see Sec. VI B 0 b.i jk and can be calculated with an additional scissor correction on the electron band energies. Such second-order optical susceptibility has been recently used for high-throughput Second-Harmonic Generation calculations, see Sec. VI B 0 b.</p>
        <p>The Raman tensor describes the change of linear optical susceptibility, χ i j , produced by an atomic displacement τ κβ of atom κ in direction β . It is therefore related to the following third energy derivative 66 :The Raman tensor describes the change of linear optical susceptibility, χ i j , produced by an atomic displacement τ κβ of atom κ in direction β . It is therefore related to the following third energy derivative 66 :</p>
        <p>Using Placzek's approximation 67 , the Raman intensity α m i j of a Stokes process associated with a phonon mode m depends on the Raman tensors as 66,68,69 :Using Placzek's approximation 67 , the Raman intensity α m i j of a Stokes process associated with a phonon mode m depends on the Raman tensors as 66,68,69 :</p>
        <p>Depending on the type of phonon mode, i.e. transverse optic (TO) or longitudinal optic (LO), the derivative of the electric susceptibility with respect to an atomic displacement must be written as 66,70 :Depending on the type of phonon mode, i.e. transverse optic (TO) or longitudinal optic (LO), the derivative of the electric susceptibility with respect to an atomic displacement must be written as 66,70 :</p>
        <p>i jl q l (11) where q is the direction along which the Brillouin zone center is approached. Both quantities are provided by ABINIT . The electro-optic tensor is related to the change of linear optical susceptibility produced by a static field. As such, it combines a priori electronic, lattice and strain contributions. The so-called clamped (fixed strain) electro-optic tensor combining electronic and lattice contributions is directly provided by ABINIT from the knowledge of previously discussed quantities 66 :i jl q l (11) where q is the direction along which the Brillouin zone center is approached. Both quantities are provided by ABINIT . The electro-optic tensor is related to the change of linear optical susceptibility produced by a static field. As such, it combines a priori electronic, lattice and strain contributions. The so-called clamped (fixed strain) electro-optic tensor combining electronic and lattice contributions is directly provided by ABINIT from the knowledge of previously discussed quantities 66 :</p>
        <p>The unclamped electro-optic tensor includes an additional piezoelectric contribution (strain response) that can be computed but requires an independent calculation of the elastooptic coefficients by finite differences 71 .The unclamped electro-optic tensor includes an additional piezoelectric contribution (strain response) that can be computed but requires an independent calculation of the elastooptic coefficients by finite differences 71 .</p>
        <p>The computation of the third-order energy derivatives in Eq. ( 7) and Eq. ( 8) (providing access to the different tensors discussed above) was first implemented in ABINIT relying on the "Berry phase" formalism 66 ; this implementation is available using a NCPSP approach within the LDA and for unpolarized systems. Following the scheme of Gonze 33 , Miwa 72 used an alternative approach, where the electric field perturbation is treated analytically, leading to a derivative operator with respect to k vectors (∂ /∂ k α ). At the non-linear level, this derivative operator is applied to first-order derivatives of wavefunctions, leading to second-order wavefunction derivatives. This way, even in the context of the 2n + 1 theorem, a (non self-consistent) second-order Sternheimer equation has to be solved. Our second implementation follows that scheme, and is valid for both NCPSP and PAW approaches. It is available with LDA functionals, and is valid for unpolarized or collinear spin-polarized systems. This second implementation also converges faster than the original one in terms of the k-point sampling. The extension to the PAW+U formalism is under development.The computation of the third-order energy derivatives in Eq. ( 7) and Eq. ( 8) (providing access to the different tensors discussed above) was first implemented in ABINIT relying on the "Berry phase" formalism 66 ; this implementation is available using a NCPSP approach within the LDA and for unpolarized systems. Following the scheme of Gonze 33 , Miwa 72 used an alternative approach, where the electric field perturbation is treated analytically, leading to a derivative operator with respect to k vectors (∂ /∂ k α ). At the non-linear level, this derivative operator is applied to first-order derivatives of wavefunctions, leading to second-order wavefunction derivatives. This way, even in the context of the 2n + 1 theorem, a (non self-consistent) second-order Sternheimer equation has to be solved. Our second implementation follows that scheme, and is valid for both NCPSP and PAW approaches. It is available with LDA functionals, and is valid for unpolarized or collinear spin-polarized systems. This second implementation also converges faster than the original one in terms of the k-point sampling. The extension to the PAW+U formalism is under development.</p>
        <p>ABINIT delivers all the tensors given above in Cartesian coordinates and with clear units (SI or conventional literature choices). These quantities can then be combined to compute the polarization dependent Raman spectra of single crystals or even Raman spectra of powders. In either case, the Raman intensities can be obtained as 74 :ABINIT delivers all the tensors given above in Cartesian coordinates and with clear units (SI or conventional literature choices). These quantities can then be combined to compute the polarization dependent Raman spectra of single crystals or even Raman spectra of powders. In either case, the Raman intensities can be obtained as 74 :</p>
        <p>where G 0 , G 1 , and G 2 are functions of the components of Eq. ( 9) 75 and a Lorentzian function is used for the broadening:where G 0 , G 1 , and G 2 are functions of the components of Eq. ( 9) 75 and a Lorentzian function is used for the broadening:</p>
        <p>Post-processing scripts are provided with ABINIT to extract the Raman tensor and print the powder-average and polarization dependent Raman intensity to a file. An example of a powder-averaged Raman spectra for polycrystalline quartz is shown in Fig. 5.Post-processing scripts are provided with ABINIT to extract the Raman tensor and print the powder-average and polarization dependent Raman intensity to a file. An example of a powder-averaged Raman spectra for polycrystalline quartz is shown in Fig. 5.</p>
        <p>Using the non-linear tensors computed by ABINIT , theoretical Raman spectra have been successfully compared with experiment for many materials including oxides [76][77][78] , organic compounds 79 and transition metal dichalcogenides 80,81 (see also the WURM database of Raman spectra 82 ). Electro-optic tensors have also been computed for various compounds including ferroelectric oxides 71,78 , multiferroics 83 and monolayer transition metal dichalcogenides 81 . Going further, relying on these quantities obtained in DFT at zero Kelvin, nonlinear optical properties at finite temperature were also successfully computed making use of a first-principles based effective Hamiltonian approach 84 .Using the non-linear tensors computed by ABINIT , theoretical Raman spectra have been successfully compared with experiment for many materials including oxides [76][77][78] , organic compounds 79 and transition metal dichalcogenides 80,81 (see also the WURM database of Raman spectra 82 ). Electro-optic tensors have also been computed for various compounds including ferroelectric oxides 71,78 , multiferroics 83 and monolayer transition metal dichalcogenides 81 . Going further, relying on these quantities obtained in DFT at zero Kelvin, nonlinear optical properties at finite temperature were also successfully computed making use of a first-principles based effective Hamiltonian approach 84 .</p>
        <p>B. The strain perturbation in density-functional perturbation theory One of the unique capabilities of ABINIT is the direct calculation of the elastic and piezoelectric properties of materials by DFPT. This involves calculating the responses to three types of perturbations: atomic displacements, electric fields, and strains and appropriately combining the results 85 . The general structure of DFPT is based upon the systematic expansion of the variational expression for the DFT total energy in powers of a parameter λ characterizing some dependence of the energy functional. Such parameters as internal atomic coordinates and the macroscopic electric field could be handled in this framework in a conceptually straightforward manner. Treating macroscopic strain as a parameter within this formalism, however, is less straightforward. The approach developed for ABINIT was based on its existing overall formulation of the DFT energy expression in reduced coordinates. This introduces real-and reciprocal-space metric tensors into every expression. The underlying reduced-coordinate lattice structure is invariant -all unit cells are unit cubes. Strain affects only the metric tensors, and the λ derivatives of every term in the Hamiltonian can be developed from derivatives of these tensors 63 .B. The strain perturbation in density-functional perturbation theory One of the unique capabilities of ABINIT is the direct calculation of the elastic and piezoelectric properties of materials by DFPT. This involves calculating the responses to three types of perturbations: atomic displacements, electric fields, and strains and appropriately combining the results 85 . The general structure of DFPT is based upon the systematic expansion of the variational expression for the DFT total energy in powers of a parameter λ characterizing some dependence of the energy functional. Such parameters as internal atomic coordinates and the macroscopic electric field could be handled in this framework in a conceptually straightforward manner. Treating macroscopic strain as a parameter within this formalism, however, is less straightforward. The approach developed for ABINIT was based on its existing overall formulation of the DFT energy expression in reduced coordinates. This introduces real-and reciprocal-space metric tensors into every expression. The underlying reduced-coordinate lattice structure is invariant -all unit cells are unit cubes. Strain affects only the metric tensors, and the λ derivatives of every term in the Hamiltonian can be developed from derivatives of these tensors 63 .</p>
        <p>The second derivatives of the energy with respect to a pair of perturbations are evaluated using so-called non-stationary expressionsThe second derivatives of the energy with respect to a pair of perturbations are evaluated using so-called non-stationary expressions</p>
        <p>where ψ (λ 2 ) α is first-order wavefunction obtained from the self-consistent Sternheimer equation for perturbation λ 2 , the parenthesized superscripts denote partial derivatives, and the notation for the various energy terms and the ground-state wavefunctions should be self-explanatory 33 . The derivative with respect to strain and the electric field, necessary for the piezoelectric tensor, has the alternative formwhere ψ (λ 2 ) α is first-order wavefunction obtained from the self-consistent Sternheimer equation for perturbation λ 2 , the parenthesized superscripts denote partial derivatives, and the notation for the various energy terms and the ground-state wavefunctions should be self-explanatory 33 . The derivative with respect to strain and the electric field, necessary for the piezoelectric tensor, has the alternative form</p>
        <p>where ψ km ( k j ) is the first-order wavefunction for the ∂ /∂ k perturbation 86 . The metric tensors involved in this context are simple and constant throughout space. They are expressed in terms of the real-and reciprocal-space primitive lattice vectors aswhere ψ km ( k j ) is the first-order wavefunction for the ∂ /∂ k perturbation 86 . The metric tensors involved in this context are simple and constant throughout space. They are expressed in terms of the real-and reciprocal-space primitive lattice vectors as</p>
        <p>Dot products of real-and reciprocal-space vectors can be expressed in terms of their strain-invariant reduced-space counterparts using these tensors. For example, reciprocal-space vectors K = k + G represented by their reduced counterpart K have dot productsDot products of real-and reciprocal-space vectors can be expressed in terms of their strain-invariant reduced-space counterparts using these tensors. For example, reciprocal-space vectors K = k + G represented by their reduced counterpart K have dot products</p>
        <p>First and second strain derivatives of the metric tensors follow from the derivatives of real and reciprocal space vectors with respect to strainsFirst and second strain derivatives of the metric tensors follow from the derivatives of real and reciprocal space vectors with respect to strains</p>
        <p>The only simplifying aspect of all this is that the dot product of a real and a reciprocal lattice vector, typically appearing in phase factors, are merely 2π times their reduced counterparts, and therefore strain-independent 63 . All the terms in the total energy expression in reduced coordinates can be expressed in terms of dot products. Therefore the evaluation of Eq. ( 15) is in principle straightforward while in practice exceedingly tedious. This formalism was initially developed for multi-projector NCPSP and LDA exchangecorrelation functionals. There are special considerations for GGA functionals which were added 87 . Extension to PAW potentials within LDA was recently added 88 .The only simplifying aspect of all this is that the dot product of a real and a reciprocal lattice vector, typically appearing in phase factors, are merely 2π times their reduced counterparts, and therefore strain-independent 63 . All the terms in the total energy expression in reduced coordinates can be expressed in terms of dot products. Therefore the evaluation of Eq. ( 15) is in principle straightforward while in practice exceedingly tedious. This formalism was initially developed for multi-projector NCPSP and LDA exchangecorrelation functionals. There are special considerations for GGA functionals which were added 87 . Extension to PAW potentials within LDA was recently added 88 .</p>
        <p>The terms described so far, derivatives with respect to two strain components (the elastic tensor), one strain component and a uniform electric field (the piezoelectric tensor) and one strain component and one atomic displacement (the so-called internal strain) are all based on strain-independent atomic positions in reduced coordinates. In fact, infinitesimal strains do produce infinitesimal reduced-coordinate changes in atomic positions. Taking this into account modifies the clamped-atom elastic and piezoelectric tensors calculated so far.The terms described so far, derivatives with respect to two strain components (the elastic tensor), one strain component and a uniform electric field (the piezoelectric tensor) and one strain component and one atomic displacement (the so-called internal strain) are all based on strain-independent atomic positions in reduced coordinates. In fact, infinitesimal strains do produce infinitesimal reduced-coordinate changes in atomic positions. Taking this into account modifies the clamped-atom elastic and piezoelectric tensors calculated so far.</p>
        <p>Combining the clamped-ion derivatives with the atomic position contributions is reminiscent of the chain rule for derivatives 85 . The necessary intermediate derivatives (interatomic force constants and Born effective charges) were already available in ABINIT . The DFPT calculations of the clamped-ion tensors and these additional derivatives are performed separately in ABINIT , and the stored results combined in the auxiliary program 
            <rs type="software">ANADDB</rs> to produce the final, physical relaxed-atom quantities. Both the NCPSP and PAW formalism and codes have been verified to a high degree of accuracy, by comparison with finite-difference calculations.
        </p>
        <p>Most DFT functionals lack a proper treatment of the longrange e --e -correlation. This term is crucial to properly describe the structure of weakly-bound compounds and, consequently, their underlying properties (phonons, elastic constants, ...). Several methods have been developed in the past in order to include some long-range e --e -correlation in DFT computations. Notably, one could mention Grimme's DFT-D methods 89,90 , the vdW-DF functionals 91,92 as well as the TS-vdW and MBD methods 93,94 . All of these approaches add new contributions to the energy and its derivatives, that have to be properly taken into account in DFPT computations for self-consistency.Most DFT functionals lack a proper treatment of the longrange e --e -correlation. This term is crucial to properly describe the structure of weakly-bound compounds and, consequently, their underlying properties (phonons, elastic constants, ...). Several methods have been developed in the past in order to include some long-range e --e -correlation in DFT computations. Notably, one could mention Grimme's DFT-D methods 89,90 , the vdW-DF functionals 91,92 as well as the TS-vdW and MBD methods 93,94 . All of these approaches add new contributions to the energy and its derivatives, that have to be properly taken into account in DFPT computations for self-consistency.</p>
        <p>ABINIT allows one to carry out such computations for the Grimme's DFT-D2, -D3 and -D3(BJ) methods 95,96 . These methods add to the DFT energy a contribution that depends only on the atomic positions:ABINIT allows one to carry out such computations for the Grimme's DFT-D2, -D3 and -D3(BJ) methods 95,96 . These methods add to the DFT energy a contribution that depends only on the atomic positions:</p>
        <p>where I and J are atomic indices, C 6,IJ is the dispersion coefficient that depends on the whole set of atomic positions R, and f (R IJ ) is a function that depends on the chosen Grimme flavor (∼ R -6 IJ at long range) and on R IJ , the difference in atomic position between the I and J atoms. This dispersion contribution is not compatible with all ad hoc exchange-correlation functionals (see Refs. 89 and 90 for the current list of compatible functionals). The common GGA-based functionals, like GGA-PBE or revPBE, are nonetheless available. Due to the way these DFT-D methods were constructed, they may not be the most suited to deal with metals.where I and J are atomic indices, C 6,IJ is the dispersion coefficient that depends on the whole set of atomic positions R, and f (R IJ ) is a function that depends on the chosen Grimme flavor (∼ R -6 IJ at long range) and on R IJ , the difference in atomic position between the I and J atoms. This dispersion contribution is not compatible with all ad hoc exchange-correlation functionals (see Refs. 89 and 90 for the current list of compatible functionals). The common GGA-based functionals, like GGA-PBE or revPBE, are nonetheless available. Due to the way these DFT-D methods were constructed, they may not be the most suited to deal with metals.</p>
        <p>Nearly all response functions available in ABINIT can be computed in DFPT with the inclusion of DFT-D dispersion corrections, with the only exception of flexoelectricity. Note that, since these corrections do not rely on the knowledge of the electronic density, the (total) energy derivatives with respect to electric fields remain untouched by the dispersion scheme. This is both an advantage and a drawback of the DFT-D method, since it eases considerably its implementation for response functions, but it prevents at the same time the method to capture any direct electronic contribution (dielectric constants, Raman susceptibility, etc.). The lack of literature on this topic does not allow us to rule on the importance of dispersion contributions in the proper description of these properties. The reason why the DFT-D dispersion corrections are not available for flexoelectricity comes from the indirect dependence of this property on the spatial derivative of the dynamical matrix, as mentioned in Sec. V D. Such spatial derivative is not yet implemented.Nearly all response functions available in ABINIT can be computed in DFPT with the inclusion of DFT-D dispersion corrections, with the only exception of flexoelectricity. Note that, since these corrections do not rely on the knowledge of the electronic density, the (total) energy derivatives with respect to electric fields remain untouched by the dispersion scheme. This is both an advantage and a drawback of the DFT-D method, since it eases considerably its implementation for response functions, but it prevents at the same time the method to capture any direct electronic contribution (dielectric constants, Raman susceptibility, etc.). The lack of literature on this topic does not allow us to rule on the importance of dispersion contributions in the proper description of these properties. The reason why the DFT-D dispersion corrections are not available for flexoelectricity comes from the indirect dependence of this property on the spatial derivative of the dynamical matrix, as mentioned in Sec. V D. Such spatial derivative is not yet implemented.</p>
        <p>All response functions related to the energy derivatives with respect to atomic displacements or to strains are directly affected by the dispersion corrections. Thanks to their pair-wise form, the DFT-D strain-related quantities can be related to derivatives with respect to atomic positionsAll response functions related to the energy derivatives with respect to atomic displacements or to strains are directly affected by the dispersion corrections. Thanks to their pair-wise form, the DFT-D strain-related quantities can be related to derivatives with respect to atomic positions</p>
        <p>where κ is an atomic index. The investigation of several weakly-bound systems (benzene, MoS 2 , etc.) using DFT-D methods has already high-lighted the importance of the dispersion contributions to interatomic force constants and to phonons 80,95 . Such methods generally lead to a better agreement with the experiments than ordinary GGA-PBE. Similarly to the general DFPT implementation, not only the zone-center phonons are accessible, but also those associated to an arbitrary wavevector, allowing the computations of phonon band structures in a fullyconsistent manner. In addition, the present implementation can also be straightforwardly used to study thermal expansion within the quasi-harmonic approximation (see Ref. 97 for an example application) or electron-phonon coupling.where κ is an atomic index. The investigation of several weakly-bound systems (benzene, MoS 2 , etc.) using DFT-D methods has already high-lighted the importance of the dispersion contributions to interatomic force constants and to phonons 80,95 . Such methods generally lead to a better agreement with the experiments than ordinary GGA-PBE. Similarly to the general DFPT implementation, not only the zone-center phonons are accessible, but also those associated to an arbitrary wavevector, allowing the computations of phonon band structures in a fullyconsistent manner. In addition, the present implementation can also be straightforwardly used to study thermal expansion within the quasi-harmonic approximation (see Ref. 97 for an example application) or electron-phonon coupling.</p>
        <p>The flexoelectric (FxE) effect, where a strain gradient deformation results in a macroscopic polarization, is a challenging electromechanical coupling to simulate computationally. The main reason is the a priori incompatibility of a spatially varying strain perturbation with periodic boundary conditions. A recent set of developments in ABINIT has overcome this difficulty by adapting the long-wave method introduced by Born and Huang 98 in the early days of quantum mechanics to the modern tools of the DFPT. ABINIT now has the unique capability to calculate the bulk FxE tensor for any insulating material.The flexoelectric (FxE) effect, where a strain gradient deformation results in a macroscopic polarization, is a challenging electromechanical coupling to simulate computationally. The main reason is the a priori incompatibility of a spatially varying strain perturbation with periodic boundary conditions. A recent set of developments in ABINIT has overcome this difficulty by adapting the long-wave method introduced by Born and Huang 98 in the early days of quantum mechanics to the modern tools of the DFPT. ABINIT now has the unique capability to calculate the bulk FxE tensor for any insulating material.</p>
        <p>Achieving this result has taken nearly a decade of continuing efforts, in order to settle the remarkable number of formal subtleties. Based on the seminal work of Resta, 99 early attempts 100,101 made use of supercell geometries to calculate the relevant ingredients discussed below Later, a long-wave framework in reciprocal space 102 was established, together with a curvilinear-coordinates formulation, 103 which led to the calculation of the full flexoelectric response of SrTiO 3 slabs 104 . (See Ref. 105 for a summary of the pre-2015 developments.) En route towards a practical implementation, additional technical and formal issues were addressed, regarding e.g. the generalization of the uniform strain response to a "metric-wave" perturbation 106,107 , and the proper definition of the current-density operator in presence of nonlocal pseudopotentials 108 . These efforts culminated with the present long-wave method, 109 which paves the way towards the computation of many spatial dispersion properties with a computational burden that is comparable to conventional linearresponse calculations.Achieving this result has taken nearly a decade of continuing efforts, in order to settle the remarkable number of formal subtleties. Based on the seminal work of Resta, 99 early attempts 100,101 made use of supercell geometries to calculate the relevant ingredients discussed below Later, a long-wave framework in reciprocal space 102 was established, together with a curvilinear-coordinates formulation, 103 which led to the calculation of the full flexoelectric response of SrTiO 3 slabs 104 . (See Ref. 105 for a summary of the pre-2015 developments.) En route towards a practical implementation, additional technical and formal issues were addressed, regarding e.g. the generalization of the uniform strain response to a "metric-wave" perturbation 106,107 , and the proper definition of the current-density operator in presence of nonlocal pseudopotentials 108 . These efforts culminated with the present long-wave method, 109 which paves the way towards the computation of many spatial dispersion properties with a computational burden that is comparable to conventional linearresponse calculations.</p>
        <p>An ab initio calculation the FxE tensor (µ) requires the sum of an electronic (clamped-ion), a lattice-mediated and a mixed contribution. This intricate structure can be formulated as 102,105 µ II αλ ,β γ = μII αλ ,β γ elec.An ab initio calculation the FxE tensor (µ) requires the sum of an electronic (clamped-ion), a lattice-mediated and a mixed contribution. This intricate structure can be formulated as 102,105 µ II αλ ,β γ = μII αλ ,β γ elec.</p>
        <p>--</p>
        <p>where κ labels the atomic sublattice and the II superscript indicates that the strain gradient tensor is defined as the gradient of the symmetric strain, i.e., the so-called type-II definition is assumed. The quantities on the right-hand side are: μII αλ ,β γ the clamped-ion FxE tensor, Pwhere κ labels the atomic sublattice and the II superscript indicates that the strain gradient tensor is defined as the gradient of the symmetric strain, i.e., the so-called type-II definition is assumed. The quantities on the right-hand side are: μII αλ ,β γ the clamped-ion FxE tensor, P</p>
        <p>α,κρ the first spatial moment of the polarization field induced by an atomic displacement (also known as P (1) tensor), Γ κ ρβ γ the piezoelectric internal strain tensor, and L κ ρλ ,β γ the flexoelectric internal strain tensor. Whereas Z * and Γ are well known quantities which can be obtained by means of the linear response DFPT with standard perturbations such as atomic displacements, electric field and strain 33,34,63 , Eq. ( 22) demands the calculation of up to four new tensor quantities. These include the μII αλ ,β γ and Pα,κρ the first spatial moment of the polarization field induced by an atomic displacement (also known as P (1) tensor), Γ κ ρβ γ the piezoelectric internal strain tensor, and L κ ρλ ,β γ the flexoelectric internal strain tensor. Whereas Z * and Γ are well known quantities which can be obtained by means of the linear response DFPT with standard perturbations such as atomic displacements, electric field and strain 33,34,63 , Eq. ( 22) demands the calculation of up to four new tensor quantities. These include the μII αλ ,β γ and P</p>
        <p>(1,λ ) α,κρ tensors introduced above, but also the first spatial moments of the dynamical matrix (Φ(1,λ ) α,κρ tensors introduced above, but also the first spatial moments of the dynamical matrix (Φ</p>
        <p>κα,κ ρ ) and of the piezoelectric forceresponse tensor ( Cκ αλ ,β γ ), both required to build L κ ρλ ,β γ following the prescriptions in Ref. 102. These new tensors represent four spatial dispersion properties, i.e., they are only sensitive to a perturbation gradient, not to a uniform perturbation. In principle, however, it is possible to obtain them as momentum derivatives of counterpart tensors from uniform perturbations, when the corresponding DFPT second order energies are generalized to finite momentum q. Thus, for example, the clamped-ion FxE tensor is the spatial dispersion counterpart of the clamped-ion piezoelectric tensor ( ēα,βγ ) 63 and could be calculated as the momentum derivative of a finite-q version of ēα,βγ . This is precisely the procedure adopted in the long-wave DFPT of Ref. 109 that has been implemented in 
            <rs type="software">ABINIT</rs> . In order to obtain the finite-q generalization of the second order energies, the approach reformulates the electric-field and the strain perturbation problems as the time derivative of a vector potential and as the gradient of a metric wave, 107 respectively. In this way, both perturbations are generalized to finite q, as is already the case for atomic displacements. This enables us to carry out an analytical third order derivative of the energy with respect to two of the standard perturbations, and to the momentum q, which directly provides the sought-after spatial dispersion tensors. Remarkably, by virtue of the 2n + 1 theorem 9 , the third-order energies are computed in one shot using precalculated first-order response functions to the standard perturbations, without the necessity of self-consistently computing any response function to a perturbation gradient. After execution, the long-wave DFPT routines generate a derivative database that is subsequently used by post-processing tools implemented in 
            <rs type="software">ANADDB</rs> to compute and print the different contributions to the FxE tensor.
        </p>
        <p>The implementation also provides access to another spatial dispersion property, the dynamical quadrupoles, which can be obtained as the symmetrized sum of the P (1) tensor, 109The implementation also provides access to another spatial dispersion property, the dynamical quadrupoles, which can be obtained as the symmetrized sum of the P (1) tensor, 109</p>
        <p>The dynamical quadrupoles are the spatial dispersion counterparts of Z * and can be used in lattice dynamics calculations to improve the prevalent dipole-dipole treatment of the long-range interactions. The ANADDB routines that carry out the process of interpolating the dynamical matrix following Ref. 34 have been adapted to incorporate the dipolequadrupole and quadrupole-quadrupole electrostatic interactions derived in Ref. 102. This new functionality results in a faster convergence of the phonon bands calculation with respect to the density of q points and, in some materials, represents the only route to obtain the correct sound velocities.The dynamical quadrupoles are the spatial dispersion counterparts of Z * and can be used in lattice dynamics calculations to improve the prevalent dipole-dipole treatment of the long-range interactions. The ANADDB routines that carry out the process of interpolating the dynamical matrix following Ref. 34 have been adapted to incorporate the dipolequadrupole and quadrupole-quadrupole electrostatic interactions derived in Ref. 102. This new functionality results in a faster convergence of the phonon bands calculation with respect to the density of q points and, in some materials, represents the only route to obtain the correct sound velocities.</p>
        <p>The ABINIT implementation of the long-wave DFPT has been used to compute the clamped-ion FxE tensor of Si and SrTiO 3 obtaining an excellent agreement with existing results in the literature 109 . The computed spatial dispersion properties accurately reproduce the sum rules predicted in Refs. 110 and 102 that relate them with specific quantities from uniform perturbation theories.The ABINIT implementation of the long-wave DFPT has been used to compute the clamped-ion FxE tensor of Si and SrTiO 3 obtaining an excellent agreement with existing results in the literature 109 . The computed spatial dispersion properties accurately reproduce the sum rules predicted in Refs. 110 and 102 that relate them with specific quantities from uniform perturbation theories.</p>
        <p>Currently, the implementation is restricted to the use of NCPSP without non-linear core corrections, and the LDA functional.Currently, the implementation is restricted to the use of NCPSP without non-linear core corrections, and the LDA functional.</p>
        <p>With ABINIT , it is possible to compute many physical properties related to electron-phonon (e-ph) interaction. In metallic systems, for instance, one can study conventional superconducting properties within the isotropic Migdal-Eliashberg formalism 111 and compute transport properties in the normal state by solving the linearized Boltzmann equation within the LOVA approach [112][113][114] . In this section, however, we focus on temperature-dependent band structures and the zero-point renormalization of the band gap in semiconductors 115,116 , a subject that in recent years has received increased attention within the electronic structure community [117][118][119][120] . As discussed in the review paper by Giustino 111 , the renormalization of the electron state due to the e-ph interaction is described by the self-energy Σ e-ph (ω) = Σ FM (ω) + Σ DW . The diagonal matrix elements of the Fan-Migdal self-energy in the KS basis set are defined byWith ABINIT , it is possible to compute many physical properties related to electron-phonon (e-ph) interaction. In metallic systems, for instance, one can study conventional superconducting properties within the isotropic Migdal-Eliashberg formalism 111 and compute transport properties in the normal state by solving the linearized Boltzmann equation within the LOVA approach [112][113][114] . In this section, however, we focus on temperature-dependent band structures and the zero-point renormalization of the band gap in semiconductors 115,116 , a subject that in recent years has received increased attention within the electronic structure community [117][118][119][120] . As discussed in the review paper by Giustino 111 , the renormalization of the electron state due to the e-ph interaction is described by the self-energy Σ e-ph (ω) = Σ FM (ω) + Σ DW . The diagonal matrix elements of the Fan-Migdal self-energy in the KS basis set are defined by</p>
        <p>where η is a positive real infinitesimal. The e-ph matrix elements g mnν (k, q) are given bywhere η is a positive real infinitesimal. The e-ph matrix elements g mnν (k, q) are given by</p>
        <p>with ∆ qν V KS the first-order variation of the self-consistent KS potential that can be computed with DFPT 33,121 . The static Debye-Waller (DW) term involves the second order derivative of the KS potential with respect to the nuclear displacements. State-of-the-art implementations approximate the DW contribution withwith ∆ qν V KS the first-order variation of the self-consistent KS potential that can be computed with DFPT 33,121 . The static Debye-Waller (DW) term involves the second order derivative of the KS potential with respect to the nuclear displacements. State-of-the-art implementations approximate the DW contribution with</p>
        <p>where g 2,DW mnν (k, q) is an effective matrix element that, within the rigid-ion approximation, can be expressed in terms of the g mnν (k, q) matrix elements 111 . In principle, the quasi-particle (QP) excitations are defined by the solution(s) in the complex plane of the equation z = ε nk + Σ e-ph nk (z). In practice, the problem is usually simplified by seeking approximated solutions along the real axis following two different approaches. In the on-the-mass-shell approximation, the QP energy is given by the real part of the self-energy evaluated at the bare KS eigenvaluewhere g 2,DW mnν (k, q) is an effective matrix element that, within the rigid-ion approximation, can be expressed in terms of the g mnν (k, q) matrix elements 111 . In principle, the quasi-particle (QP) excitations are defined by the solution(s) in the complex plane of the equation z = ε nk + Σ e-ph nk (z). In practice, the problem is usually simplified by seeking approximated solutions along the real axis following two different approaches. In the on-the-mass-shell approximation, the QP energy is given by the real part of the self-energy evaluated at the bare KS eigenvalue</p>
        <p>The second approach linearizes the self-energy near the KS eigenvalue and evaluates the QP correction usingThe second approach linearizes the self-energy near the KS eigenvalue and evaluates the QP correction using</p>
        <p>with the renormalization factor Z given bywith the renormalization factor Z given by</p>
        <p>Both approaches are implemented in 
            <rs type="software">ABINIT</rs> although it should be noted that, according to recent works, the on-themass-shell approach provides results that are closer to those obtained with more advanced techniques based on the cumulant expansion 122 or self-energy calculations employing an eigenvalue-self-consistent cycle 123 . Accurate calculations of e-ph renormalization are still challenging even by present standards, because the e-ph selfenergy is quite sensitive to the q-point sampling. Moreover a large number of empty states m is usually required to converge the real part of the self-energy. In order to avoid the explicit computation of the DFPT scattering potentials on dense q-grids, 
            <rs type="software">ABINIT</rs> generalizes the Fourier-based interpolation scheme proposed by Eiguren et al. 124 to account for the nonanalytical behaviour associated to the long-range interactions present in semiconductors 125 . The dipolar potentials generated by the Born effective charges in polar materials are treated using a generalized Fröhlich model 126,127 . Further details concerning the implementation are given in Ref. 17. In order to accelerate the convergence with the number of empty states, ABINIT replaces the contributions given by the highenergy states above a certain band index M with the solution of a non-self-consistent Sternheimer equation in which only the first M states are required. The methodology, proposed in Ref. 128, is based on a quasi-static approximation in which the phonon frequencies in the denominator of Eq. ( 24) are neglected and the frequency dependence of Σ is approximated with the value computed at ω = ε nk . This approximation is justified when the bands above M are sufficiently high in energy with respect to the nk states that must be corrected. Furthermore, this upper-bands contribution to Σ converges quickly with respect to q-points sampling, and it can be safely computed on a coarse q-grid 123,129 .
        </p>
        <p>The code can compute QP corrections and lifetimes due to e-ph scattering as well as spectral functions. The lifetimes obtained from the imaginary part of Eq. ( 24) can be used to compute carrier mobilities within the self-energy relaxation time approximation 111,130,131 :The code can compute QP corrections and lifetimes due to e-ph scattering as well as spectral functions. The lifetimes obtained from the imaginary part of Eq. ( 24) can be used to compute carrier mobilities within the self-energy relaxation time approximation 111,130,131 :</p>
        <p>For the computation of electron lifetimes, 
            <rs type="software">ABINIT</rs> implements advanced integration techniques that take advantage of the linear tetrahedron method 44 and double-grid techniques for the q-space integration. Last but not least, 
            <rs type="software">ABINIT</rs> provides a specialized driver to interpolate the DFPT scattering potentials, compute e-ph matrix elements on arbitrarily dense k-meshes and save the results to NETCDF files. This driver can be used by externals codes such as BERKELEYGW 132 to treat e-ph interactions at the GW level as discussed in Ref. 133.
        </p>
        <p>F. A-TDEP: Temperature dependent thermodynamic properties using the TDEP approachF. A-TDEP: Temperature dependent thermodynamic properties using the TDEP approach</p>
        <p>The features and the temperature dependence of the phonon spectrum determine a large number of thermodynamic properties of crystals, such as dynamic and thermodynamic stability, elastic properties, and heat transport within the material. The theory of lattice dynamics at finite temperature has long been a central field of research in condensed matter, and its applications are numerous in geophysics, material science, astrophysics... The calculation of the phonon spectrum is available in ABINIT since the 90's and is based on DFPT. In this framework, the ground state undergoes a small perturbation around its 0 K equilibrium positions in order to describe the shape of the potential energy surface (PES) very near the minimum. Thereafter, in order to capture the temperature effects, the harmonic approximation (HA) or quasi-harmonic approximation (QHA) can be applied. The latter approximation is handled by assuming that the temperature dependency of the phonon frequencies can be taken into account implicitly through a variation of the volume. This treatment generally gives excellent agreement with experimental measurements of the thermal expansion and the elastic constants 134 .The features and the temperature dependence of the phonon spectrum determine a large number of thermodynamic properties of crystals, such as dynamic and thermodynamic stability, elastic properties, and heat transport within the material. The theory of lattice dynamics at finite temperature has long been a central field of research in condensed matter, and its applications are numerous in geophysics, material science, astrophysics... The calculation of the phonon spectrum is available in ABINIT since the 90's and is based on DFPT. In this framework, the ground state undergoes a small perturbation around its 0 K equilibrium positions in order to describe the shape of the potential energy surface (PES) very near the minimum. Thereafter, in order to capture the temperature effects, the harmonic approximation (HA) or quasi-harmonic approximation (QHA) can be applied. The latter approximation is handled by assuming that the temperature dependency of the phonon frequencies can be taken into account implicitly through a variation of the volume. This treatment generally gives excellent agreement with experimental measurements of the thermal expansion and the elastic constants 134 .</p>
        <p>However, the QHA fails or cannot be applied in various particular cases. For example, when the system is close to a phase transition, when the phase of interest is not stable at 0 K, or when one wants properties at high temperature. In these situations, an implicit treatment of the temperature through a volume variation is no longer sufficient and a dedicated calculation, taking into account the temperature explicitly, is needed. One can formalize and synthesize this statement as follows:However, the QHA fails or cannot be applied in various particular cases. For example, when the system is close to a phase transition, when the phase of interest is not stable at 0 K, or when one wants properties at high temperature. In these situations, an implicit treatment of the temperature through a volume variation is no longer sufficient and a dedicated calculation, taking into account the temperature explicitly, is needed. One can formalize and synthesize this statement as follows:</p>
        <p>The second term of the right hand side of Eq. ( 31) is included in the QHA. However, the first term on the right side of Eq. ( 31) is only included when the temperature dependence is explicit. Since the beginning of the 60's, a large number of theoretical studies have been carried out in order to go beyond the simple harmonic crystal and to deal with anharmonic effects [135][136][137][138][139][140][141] . More recently, there has been a revival of such developments. During the last decade, several groups proposed theoretical frameworks coupled to computational methods able to capture anharmonic effects in crystals [142][143][144][145][146][147][148] . One way, chosen and implemented in 
            <rs type="software">ABINIT</rs> , has been proposed by Esfarjani and Stokes 149 then developed by Hellman et al. [150][151][152] . In the framework of TDEP, the anharmonic terms are treated in an effective manner.
        </p>
        <p>Let us define a 3-dimensional crystal and consider that a ground state energy U 0 is obtained when the atoms are in their equilibrium positions. The potential energy of this system can be rewritten using a Taylor expansion around equilibrium positions asLet us define a 3-dimensional crystal and consider that a ground state energy U 0 is obtained when the atoms are in their equilibrium positions. The potential energy of this system can be rewritten using a Taylor expansion around equilibrium positions as</p>
        <p>Φ α 1 ...α p i 1 ...i p the interatomic force constants (IFC) at the p th order and u α i the displacement of atom i along Cartesian direction α.Φ α 1 ...α p i 1 ...i p the interatomic force constants (IFC) at the p th order and u α i the displacement of atom i along Cartesian direction α.</p>
        <p>By performing ab initio molecular dynamics (MD) simulations, the forces F α i,MD (t) and atomic displacements u α i,MD (t) are acquired at each time step t. If we differentiate Eq. ( 32) with respect to atomic displacements and insert the MD quantities, we obtain the following system of equations :By performing ab initio molecular dynamics (MD) simulations, the forces F α i,MD (t) and atomic displacements u α i,MD (t) are acquired at each time step t. If we differentiate Eq. ( 32) with respect to atomic displacements and insert the MD quantities, we obtain the following system of equations :</p>
        <p>Θ αβ ...δ i j...l the effective IFC at the p th order and P the maximum order of the expansion. Eq. ( 33) is non-linear with respect to the atomic displacements and can be rewritten as:Θ αβ ...δ i j...l the effective IFC at the p th order and P the maximum order of the expansion. Eq. ( 33) is non-linear with respect to the atomic displacements and can be rewritten as:</p>
        <p>where θ pλ being the λ th are now the effective IFC at the p th order and f α i,pλ (u MD (t)) a function gathering all the contributions coming from the atomic displacements. This system of equations is now linear as a function of θ pλ (the unknown variables of the system) and can be solved using a least-squares method. The solution is given by Θwhere θ pλ being the λ th are now the effective IFC at the p th order and f α i,pλ (u MD (t)) a function gathering all the contributions coming from the atomic displacements. This system of equations is now linear as a function of θ pλ (the unknown variables of the system) and can be solved using a least-squares method. The solution is given by Θ</p>
        <p>Note the difference between the trueNote the difference between the true</p>
        <p>Φ and effectiveΦ and effective</p>
        <p>Θ IFC. The latter includes the effects of all the IFC not taken into account in the expansion (i.e. beyond the P th order). For instance, if P = 2, the 2 nd order effective IFC incorporates all higher anharmonic terms, in an effective way. Consequently, the effective IFC acquire a dependency on the temperature, at odds with the true IFC.Θ IFC. The latter includes the effects of all the IFC not taken into account in the expansion (i.e. beyond the P th order). For instance, if P = 2, the 2 nd order effective IFC incorporates all higher anharmonic terms, in an effective way. Consequently, the effective IFC acquire a dependency on the temperature, at odds with the true IFC.</p>
        <p>The number of time steps needed to solve Eq. ( 34) has to be large with respect to the number of unknown variables θ pλ . By taking into account properties of the system (translation and rotation invariances, crystal symmetries...) the number of independent and non-zero IFC coefficients of a cubic system with one hundred atoms in the supercell can be reduced to around ten at the second order, tens at the third order and around a hundred at the fourth order.The number of time steps needed to solve Eq. ( 34) has to be large with respect to the number of unknown variables θ pλ . By taking into account properties of the system (translation and rotation invariances, crystal symmetries...) the number of independent and non-zero IFC coefficients of a cubic system with one hundred atoms in the supercell can be reduced to around ten at the second order, tens at the third order and around a hundred at the fourth order.</p>
        <p>Once the IFC coefficients are obtained, many dynamic, elastic and thermodynamic properties can be evaluated:Once the IFC coefficients are obtained, many dynamic, elastic and thermodynamic properties can be evaluated:</p>
        <p>• As usual, the phonon spectrum is obtained after the diagonalization of the dynamical matrix.• As usual, the phonon spectrum is obtained after the diagonalization of the dynamical matrix.</p>
        <p>• Then, the phonon density of states is built and used to compute various thermodynamic properties 153 : the free energy, the specific heat, the entropy...• Then, the phonon density of states is built and used to compute various thermodynamic properties 153 : the free energy, the specific heat, the entropy...</p>
        <p>• By computing the elastic constants using the secondorder effective IFC 135,141 , it is possible to obtain the bulk and shear moduli.• By computing the elastic constants using the secondorder effective IFC 135,141 , it is possible to obtain the bulk and shear moduli.</p>
        <p>• The Grüneisen parameter is obtained using the third order effective IFC 154,155 which leads to other important quantities: the thermal expansion, the isentropic compressibility, the constant pressure specific heat, sound velocities... Since the effective IFC include an explicit temperature dependency, all the quantities listed above do as well.• The Grüneisen parameter is obtained using the third order effective IFC 154,155 which leads to other important quantities: the thermal expansion, the isentropic compressibility, the constant pressure specific heat, sound velocities... Since the effective IFC include an explicit temperature dependency, all the quantities listed above do as well.</p>
        <p>The 
            <rs type="software">ABINIT</rs> implementation of the TDEP algorithm, referred to as A-TDEP , has produced a number of applications in the last five years [156][157][158][159][160] . We recommend the user to read the A-TDEP documentation distributed in the 
            <rs type="software">ABINIT</rs> package before any calculations, and also to read the article dedicated to this implementation 161 .
        </p>
        <p>The necessity to treat non-collinear magnetism (NCM) in DFT codes is more and more important for spintronic applications studies. NCM can arise naturally, from geometrical frustration of anti-ferromagnetic interactions, e.g. in triangular lattices, by the magnetic anisotropy generated by the presence of a preferred direction of magnetization, or by the competition between exchange interactions. However, the generalization of DFPT for non-collinear magnetic simulations has only recently been attempted. Within the non-collinear DFT scheme, the density is described by a four-component matrix instead of two (in collinear magnetism) which is required to account for the spin-orbit coupling (SOC), except when time-reversal symmetry induces vanishing of the magnetization everywhere 162 . This last term, in current DFT code implementations, implies a partial loss of symmetry [163][164][165] , which worsens the calculation time and explains the scarcity of such calculations. Additionally, the treatment of the electronic exchange-correlation (XC) term is more complicated, since the functionals are usually built in a collinear framework. We have proposed 166 three different approaches to perform the energy derivatives in the non-collinear regime treating opportunely the XC term, and have implemented these for the atomic displacement (phonons) and electric field perturbations.The necessity to treat non-collinear magnetism (NCM) in DFT codes is more and more important for spintronic applications studies. NCM can arise naturally, from geometrical frustration of anti-ferromagnetic interactions, e.g. in triangular lattices, by the magnetic anisotropy generated by the presence of a preferred direction of magnetization, or by the competition between exchange interactions. However, the generalization of DFPT for non-collinear magnetic simulations has only recently been attempted. Within the non-collinear DFT scheme, the density is described by a four-component matrix instead of two (in collinear magnetism) which is required to account for the spin-orbit coupling (SOC), except when time-reversal symmetry induces vanishing of the magnetization everywhere 162 . This last term, in current DFT code implementations, implies a partial loss of symmetry [163][164][165] , which worsens the calculation time and explains the scarcity of such calculations. Additionally, the treatment of the electronic exchange-correlation (XC) term is more complicated, since the functionals are usually built in a collinear framework. We have proposed 166 three different approaches to perform the energy derivatives in the non-collinear regime treating opportunely the XC term, and have implemented these for the atomic displacement (phonons) and electric field perturbations.</p>
        <p>The first method exploits the local transformation from non-collinear to collinear magnetization: at each point of space, we align the local system of reference to the local quantization axis of the magnetization, then we perform the derivatives in this locally collinear framework and finally we return to the lab frame of reference. The unitary transformation diagonalizing the 2 × 2 density matrix ρ(0) , and its derivative ρ(1) , have to be determined at the zeroth (U (0) ) and first order (U (1) ) of perturbation, to fully characterize the problem (see Ref. 166).The first method exploits the local transformation from non-collinear to collinear magnetization: at each point of space, we align the local system of reference to the local quantization axis of the magnetization, then we perform the derivatives in this locally collinear framework and finally we return to the lab frame of reference. The unitary transformation diagonalizing the 2 × 2 density matrix ρ(0) , and its derivative ρ(1) , have to be determined at the zeroth (U (0) ) and first order (U (1) ) of perturbation, to fully characterize the problem (see Ref. 166).</p>
        <p>The second method consists in writing the U (0) and U (1) analytically in terms of the Pauli matrices σ αβ , i. e., the generators of the Lie group SU (2).The second method consists in writing the U (0) and U (1) analytically in terms of the Pauli matrices σ αβ , i. e., the generators of the Lie group SU (2).</p>
        <p>The third method evaluates explicitly the expression of the first order XC potential, specifically for the LSDA expression of the XC energy, which is easy to derive.The third method evaluates explicitly the expression of the first order XC potential, specifically for the LSDA expression of the XC energy, which is easy to derive.</p>
        <p>The three methods have been tested on two particular systems Cr 2 O 3 and RuCl 3 166 . Cr 2 O 3 has been used to test the implementations because it is one of the simplest and best known collinear antiferromagnetic and magneto-electric systems. Thanks to these tests we have demonstrated that the two first methods are closely equivalent in terms of second derivatives quality and timing performance (calculations of phonons, electronic dielectric constant and Born effective charges). However, the third one requires twice as many self consistent iterations to give the same quantities. On RuCl 3 , we have applied our methods to predict the change in phonon frequencies induced by the non-collinearity of the magnetic moments. Comparing the frequencies estimated in collinear and non-collinear frameworks, we have shown the signature of non-negligible NCM: certain phonon modes of specific irreducible representations have their frequency modified by up to 10 cm -1 depending on the chosen direction (see Ref. 166 for more details).The three methods have been tested on two particular systems Cr 2 O 3 and RuCl 3 166 . Cr 2 O 3 has been used to test the implementations because it is one of the simplest and best known collinear antiferromagnetic and magneto-electric systems. Thanks to these tests we have demonstrated that the two first methods are closely equivalent in terms of second derivatives quality and timing performance (calculations of phonons, electronic dielectric constant and Born effective charges). However, the third one requires twice as many self consistent iterations to give the same quantities. On RuCl 3 , we have applied our methods to predict the change in phonon frequencies induced by the non-collinearity of the magnetic moments. Comparing the frequencies estimated in collinear and non-collinear frameworks, we have shown the signature of non-negligible NCM: certain phonon modes of specific irreducible representations have their frequency modified by up to 10 cm -1 depending on the chosen direction (see Ref. 166 for more details).</p>
        <p>The different methods of magnetization rotation can be set through the ixcrot ABINIT input flag. The default value is method 1 (ixcrot=1). The method 2 or 3 can be used by setting ixcrot to 2 or 3. 167 Although in the corresponding ABINIT version of Ref. 166 we implemented the NCM DFPT formalism at the Γ point only, further developments have been completed in order to account for the full q dependence in the phonon spectra (available in the next production version, only with ixcrot=3). The implementation is valid for NCPSP only but work is ongoing to extend it to the PAW formalism.The different methods of magnetization rotation can be set through the ixcrot ABINIT input flag. The default value is method 1 (ixcrot=1). The method 2 or 3 can be used by setting ixcrot to 2 or 3. 167 Although in the corresponding ABINIT version of Ref. 166 we implemented the NCM DFPT formalism at the Γ point only, further developments have been completed in order to account for the full q dependence in the phonon spectra (available in the next production version, only with ixcrot=3). The implementation is valid for NCPSP only but work is ongoing to extend it to the PAW formalism.</p>
        <p>The linear response of the magnetization to static and dynamical magnetic fields (spin magnetic susceptibility χ m ), is one of the key characteristics of magnetic materials. This quantity is intrinsically linked to the spin fluctuation spectrum and hence not only allows one to identify and characterize the relevant magnetic excitations, but also to understand their character and estimate the strength of spin interactions. The latter case appears to be particularly important in the view of the ever-growing need for accurate lattice spin models to predict finite-temperature properties of spin systems, and understand the physics of magnetic and topological materials. While the theoretical framework for linear spin response calculations within the DFPT formalism has been established several decades ago 168 , practical implementations of this method are still rare in DFT codes 169 .The linear response of the magnetization to static and dynamical magnetic fields (spin magnetic susceptibility χ m ), is one of the key characteristics of magnetic materials. This quantity is intrinsically linked to the spin fluctuation spectrum and hence not only allows one to identify and characterize the relevant magnetic excitations, but also to understand their character and estimate the strength of spin interactions. The latter case appears to be particularly important in the view of the ever-growing need for accurate lattice spin models to predict finite-temperature properties of spin systems, and understand the physics of magnetic and topological materials. While the theoretical framework for linear spin response calculations within the DFPT formalism has been established several decades ago 168 , practical implementations of this method are still rare in DFT codes 169 .</p>
        <p>We have implemented and tested the variational DFPT method for computing the linear spin response to a small, qdependent, magnetic field of the form B = be iq•r + b * e -iq•r . The first derivatives of the density and magnetization are obtained by considering the first order external potential vWe have implemented and tested the variational DFPT method for computing the linear spin response to a small, qdependent, magnetic field of the form B = be iq•r + b * e -iq•r . The first derivatives of the density and magnetization are obtained by considering the first order external potential v</p>
        <p>nk-q σ u nk , with the sum running over the occupied Kohn-Sham orbitals n. For an arbitrary wavevector q = 0 it is thus necessary to find the Bloch-periodic parts of the first-order wavefunctions unk-q σ u nk , with the sum running over the occupied Kohn-Sham orbitals n. For an arbitrary wavevector q = 0 it is thus necessary to find the Bloch-periodic parts of the first-order wavefunctions u</p>
        <p>(1) nk-q and u (1) nk+q at both k + q and kq points. This is done by performing two state-by-state minimizations of the second order energy functional at each SCF iteration, using the selfconsistent potential v (1) scf,q and its Hermitian conjugate v(1) nk-q and u (1) nk+q at both k + q and kq points. This is done by performing two state-by-state minimizations of the second order energy functional at each SCF iteration, using the selfconsistent potential v (1) scf,q and its Hermitian conjugate v</p>
        <p>(1) scf,-q , respectively.(1) scf,-q , respectively.</p>
        <p>The implementation of the algorithm has been tested by comparing the spin susceptibility obtained from DFPT calculations with the finite-difference derivatives estimated from ground state DFT calculations with finite magnetic field. Specifically, for q = 0, we have performed calculations of the longitudinal magnetization response of ferromagnetic bcc Fe as well as longitudinal and transverse spin susceptibilities of antiferromagnetic Cr 2 O 3 . These two examples were chosen to test both metallic and insulating occupations. To verify the validity of q = 0 implementation, we have further performed ground-state DFT calculations with harmonically varying Zeeman field B = b cos(qr) with q = (1/2, 0, 0) and q = (1/4, 0, 0) for bcc Fe in corresponding supercells. The periodic parts of the first order density and magnetization obtained using the first-order finite-difference scheme were then compared to the corresponding results obtained from single unit cell DFPT run. All considered test cases for q = 0 and q = 0 showed good agreement between DFPT and finite field results, even in the case of coarse Brillouin zone sampling, e.g. 2x2x2 and 4x4x4 k-point grids. Furthermore, to verify the accuracy of the approach we have performed the calculation of the Heisenberg exchange parameters J for bcc Fe. These are derived from the transverse spin susceptibility χ ⊥ (q) and the corresponding Fourier components of the super-exchange parameters J(q) = χ(q) (-1) , yielding couplings of 18.9 meV (9.8 meV) for the first (second) shell of nearest neighbors, in good agreement with previous literature 170 .The implementation of the algorithm has been tested by comparing the spin susceptibility obtained from DFPT calculations with the finite-difference derivatives estimated from ground state DFT calculations with finite magnetic field. Specifically, for q = 0, we have performed calculations of the longitudinal magnetization response of ferromagnetic bcc Fe as well as longitudinal and transverse spin susceptibilities of antiferromagnetic Cr 2 O 3 . These two examples were chosen to test both metallic and insulating occupations. To verify the validity of q = 0 implementation, we have further performed ground-state DFT calculations with harmonically varying Zeeman field B = b cos(qr) with q = (1/2, 0, 0) and q = (1/4, 0, 0) for bcc Fe in corresponding supercells. The periodic parts of the first order density and magnetization obtained using the first-order finite-difference scheme were then compared to the corresponding results obtained from single unit cell DFPT run. All considered test cases for q = 0 and q = 0 showed good agreement between DFPT and finite field results, even in the case of coarse Brillouin zone sampling, e.g. 2x2x2 and 4x4x4 k-point grids. Furthermore, to verify the accuracy of the approach we have performed the calculation of the Heisenberg exchange parameters J for bcc Fe. These are derived from the transverse spin susceptibility χ ⊥ (q) and the corresponding Fourier components of the super-exchange parameters J(q) = χ(q) (-1) , yielding couplings of 18.9 meV (9.8 meV) for the first (second) shell of nearest neighbors, in good agreement with previous literature 170 .</p>
        <p>All the test simulations described above were performed within the LSDA approximation, which is currently the only exchange-correlation functional implemented for linear spin response calculations in 
            <rs type="software">ABINIT</rs> . Furthermore, for the q = 0, case, it is imperative to use the explicit evaluation of the firstorder XC functional (ixcrot=3 ABINIT input flag). Furthermore, at present and similarly to atomic displacement perturbations with non-collinear magnetism, the implementation of zeeman magnetic field perturbation is limited to NCPSP formalism. Within MBPT, one can address the computation of the energies and related characteristics of charged excitations as well as those of neutral excitations 11 . For the former, the GW approximation is the state-of-the-art, while for the latter, one relies on the Bethe-Salpeter equation (BSE) which includes excitonic effects. Such approaches produce optical absorption spectra which are much more accurate than independentparticle approaches, such as the simple sum-over-states.
        </p>
        <p>The implementation of the BSE in ABINIT has been previously described in Refs. 5 and 171. An efficient interpolation allows on to cut down significantly the CPU time needed to obtain optical spectra converged with respect to the Brillouin Zone sampling.The implementation of the BSE in ABINIT has been previously described in Refs. 5 and 171. An efficient interpolation allows on to cut down significantly the CPU time needed to obtain optical spectra converged with respect to the Brillouin Zone sampling.</p>
        <p>As a salient example, the ABINIT implementation has been used to obtain frequency-dependent Raman intensities [172][173][174] , by finite difference of optical spectra, even for the secondorder Raman spectrum.As a salient example, the ABINIT implementation has been used to obtain frequency-dependent Raman intensities [172][173][174] , by finite difference of optical spectra, even for the secondorder Raman spectrum.</p>
        <p>The MBPT calculations can be combined with temperature dependent electronic structure presented above, Sec. V E, to compute temperature-dependent optical spectra. The effect of the electron-phonon interaction is included in the diagonal part of the BSE Hamiltonian according to:The MBPT calculations can be combined with temperature dependent electronic structure presented above, Sec. V E, to compute temperature-dependent optical spectra. The effect of the electron-phonon interaction is included in the diagonal part of the BSE Hamiltonian according to:</p>
        <p>, where H FA is the "frozen-atom" expression for the BSE Hamiltonian introduced in Ref. 5. Fig. 6 illustrates the agreement observed for silicon, when compared with experimental data, as well as with Ref. 175. Note that the Bethe-Salpether Hamiltonian is not Hermitian, but can be tackled by an iterative Bi-Lanczos algorithm 5,174 ., where H FA is the "frozen-atom" expression for the BSE Hamiltonian introduced in Ref. 5. Fig. 6 illustrates the agreement observed for silicon, when compared with experimental data, as well as with Ref. 175. Note that the Bethe-Salpether Hamiltonian is not Hermitian, but can be tackled by an iterative Bi-Lanczos algorithm 5,174 .</p>
        <p>Planewave calculations are almost invariably performed in conjunction with some sort of pseudization scheme that freezes the inner core electrons and replaces their sharply varying wavefunctions in the region around the nucleus with smoother orbitals, which are easier to describe in Fourier space with a finite basis set 7 . On the one hand, this approach allows one to reduce significantly the computational cost and enjoy the advantages of the planewave basis set: orthogonality, systematic convergence, ease of implementation and efficient Fast-Fourier-Transforms. On the other hand, as these pseudopotential operators are supposed to mimic the KS potential felt by the valence electrons in an all-electron DFT calculation, they imply a trade-off between accuracy and computational efficiency. Generating reliable and accurate tables of pseudopotentials therefore represents a highly nontrivial task, especially for end-users who are not familiar with the pseudopotential formalism and all its intricacies. For this reason, in the last few years, a significant effort has been made by the ABINIT community in order to provide users with a recommended set of pseudopotential tables that have been carefully crafted and validated against ground-state reference results obtained with all-electron codes 177,178 . In what follows, we briefly describe the main features of the two official PAW and norm-conserving (NC) tables provided by the ABINIT group, and their design principles.Planewave calculations are almost invariably performed in conjunction with some sort of pseudization scheme that freezes the inner core electrons and replaces their sharply varying wavefunctions in the region around the nucleus with smoother orbitals, which are easier to describe in Fourier space with a finite basis set 7 . On the one hand, this approach allows one to reduce significantly the computational cost and enjoy the advantages of the planewave basis set: orthogonality, systematic convergence, ease of implementation and efficient Fast-Fourier-Transforms. On the other hand, as these pseudopotential operators are supposed to mimic the KS potential felt by the valence electrons in an all-electron DFT calculation, they imply a trade-off between accuracy and computational efficiency. Generating reliable and accurate tables of pseudopotentials therefore represents a highly nontrivial task, especially for end-users who are not familiar with the pseudopotential formalism and all its intricacies. For this reason, in the last few years, a significant effort has been made by the ABINIT community in order to provide users with a recommended set of pseudopotential tables that have been carefully crafted and validated against ground-state reference results obtained with all-electron codes 177,178 . In what follows, we briefly describe the main features of the two official PAW and norm-conserving (NC) tables provided by the ABINIT group, and their design principles.</p>
        <p>a. JTH table To perform calculations in the frame of the PAW 44 methodology, atomic data are needed, which correspond to the pseudopotentials in the norm-conserving approach. We deliver a Mendeleev table of PAW data -the JTH table 179 -on the ABINIT website. This table has been generated thanks to the atomic code ATOMPAW 180 for 86 elements, from H to Rn. It is available within the scalar relativistic approximation, both for LDA and PBE XC functionals. The files are provided in a standard XML format for use in any PAW electronic structure code, following the specifications given in Ref. 181. The XML format allows one to introduce new tags for special developments: for instance, pre-calculated atomic matrix elements are given, to be used for calculations with hybrid functionals. In v2.0 version of the JTH table, data enabling calculations within the LDA-1/2 182 approximation are provided for some elements. Each file contains suggested planewave cut-offs, according to a requested accuracy. The input file of the ATOMPAW code is also provided for each element to allow the user to modify the parameters used for the generation of the data, if needed.a. JTH table To perform calculations in the frame of the PAW 44 methodology, atomic data are needed, which correspond to the pseudopotentials in the norm-conserving approach. We deliver a Mendeleev table of PAW data -the JTH table 179 -on the ABINIT website. This table has been generated thanks to the atomic code ATOMPAW 180 for 86 elements, from H to Rn. It is available within the scalar relativistic approximation, both for LDA and PBE XC functionals. The files are provided in a standard XML format for use in any PAW electronic structure code, following the specifications given in Ref. 181. The XML format allows one to introduce new tags for special developments: for instance, pre-calculated atomic matrix elements are given, to be used for calculations with hybrid functionals. In v2.0 version of the JTH table, data enabling calculations within the LDA-1/2 182 approximation are provided for some elements. Each file contains suggested planewave cut-offs, according to a requested accuracy. The input file of the ATOMPAW code is also provided for each element to allow the user to modify the parameters used for the generation of the data, if needed.</p>
        <p>b. PseudoDojo The PSEUDODOJO project 183 provides two predefined set of NC pseudopotentials: standard and stringent. The standard set is designed for conventional DFT and DFPT applications while the stringent version contains pseudopotentials with more electrons in valence, smaller pseudization radii and improved scattering properties at high energies. The stringent set is recommended for performing DFT/DFPT calculations in which high precision is needed, or for many-body applications such as GW that are quite sensitive to the inclusion of semi-core states and to the quality of the logarithmic derivative in the empty region. The majority of the pseudopotentials include non-linear core corrections 184 with model core charges generated following Teter's approach 185 , which produces smooth core charges in real space with reasonably fast decay in reciprocal space. The inclusion of the non-linear core correction improves the transferability of the pseudopotential and turned out to be crucial to avoid unphysical oscillations in the local part of the potential in the region around the atom. These oscillations worsen the convergence rate, as well as the fulfillment of the acoustic sum rule in phonon calculations, especially when GGA functionals are employed 183 .b. PseudoDojo The PSEUDODOJO project 183 provides two predefined set of NC pseudopotentials: standard and stringent. The standard set is designed for conventional DFT and DFPT applications while the stringent version contains pseudopotentials with more electrons in valence, smaller pseudization radii and improved scattering properties at high energies. The stringent set is recommended for performing DFT/DFPT calculations in which high precision is needed, or for many-body applications such as GW that are quite sensitive to the inclusion of semi-core states and to the quality of the logarithmic derivative in the empty region. The majority of the pseudopotentials include non-linear core corrections 184 with model core charges generated following Teter's approach 185 , which produces smooth core charges in real space with reasonably fast decay in reciprocal space. The inclusion of the non-linear core correction improves the transferability of the pseudopotential and turned out to be crucial to avoid unphysical oscillations in the local part of the potential in the region around the atom. These oscillations worsen the convergence rate, as well as the fulfillment of the acoustic sum rule in phonon calculations, especially when GGA functionals are employed 183 .</p>
        <p>At present, the PSEUDODOJO provides NC tables generated with three different XC functionals: LDA, PBE and PBEsol. For each XC flavor, one can opt for the scalar-relativistic or for the fully relativistic version, which includes the additional projectors required to treat spin-orbit coupling 186 . Finally, a specialized set of pseudopotentials for the lanthanides is also available, with f -electrons frozen in the core. These pseudopotentials are supposed to be used for calculations in which the lanthanide is in the 3 + oxidation state. For each pseudopotential, three different hints (low, normal and high) for the planewave cutoff energy are suggested on the basis of the convergence studies performed during the validation tests 183 . These cutoff hints are employed in high-throughput studies, to implement machine-friendly workflows, but can also be used as a starting point in more conventional convergence studies. The pseudopotentials can be downloaded from the official website or alternatively from a GitHub repository. The data is available in three different formats: the original psp8 file format implemented by Hamann, the UPF format and the psml format 187 . The graphical interface of the official website allows users to select an element of the periodic table, the XC functional as well as the accuracy level and the relativistic version. Jupyter notebooks with pre-generated figures showing the convergence of physical properties as a function of the cutoff energy and the results produced by the ONCVPSP pseudopotential generator are also provided. The same interface can be used to download the PAW atomic data of the JTH table.At present, the PSEUDODOJO provides NC tables generated with three different XC functionals: LDA, PBE and PBEsol. For each XC flavor, one can opt for the scalar-relativistic or for the fully relativistic version, which includes the additional projectors required to treat spin-orbit coupling 186 . Finally, a specialized set of pseudopotentials for the lanthanides is also available, with f -electrons frozen in the core. These pseudopotentials are supposed to be used for calculations in which the lanthanide is in the 3 + oxidation state. For each pseudopotential, three different hints (low, normal and high) for the planewave cutoff energy are suggested on the basis of the convergence studies performed during the validation tests 183 . These cutoff hints are employed in high-throughput studies, to implement machine-friendly workflows, but can also be used as a starting point in more conventional convergence studies. The pseudopotentials can be downloaded from the official website or alternatively from a GitHub repository. The data is available in three different formats: the original psp8 file format implemented by Hamann, the UPF format and the psml format 187 . The graphical interface of the official website allows users to select an element of the periodic table, the XC functional as well as the accuracy level and the relativistic version. Jupyter notebooks with pre-generated figures showing the convergence of physical properties as a function of the cutoff energy and the results produced by the ONCVPSP pseudopotential generator are also provided. The same interface can be used to download the PAW atomic data of the JTH table.</p>
        <p>B. High-throughput: phonons, second-harmonic generation, and GW Using a first-principles package for high-throughput applications places more stringent demands on the implementation details than the traditional approach based on singlestep operations. 
            <rs type="software">ABINIT</rs> implements two important features to accommodate these needs: portable machine-readable output files in binary NETCDF format 188,189 to communicate results to external software, as well as automatic algorithms to select optimal parallelization settings at runtime. Besides these features directly implemented in the code itself, efficient high-throughput calculations require a highlevel library to programmatically interact with the Fortran code; the ABINIT group provides this framework in the 
            <rs type="software">ABIPY</rs> project 190 . These features have enabled the development of the following high-throughput projects.
        </p>
        <p>a. DFPT phonons The vibrational properties of a material represent a fundamental ingredient for understanding a variety of physical phenomena and 
            <rs type="software">ABINIT</rs> provides accurate and efficient algorithms based on the DFPT formalism (Sec. V). In order to fully exploit the features of the code and handle a large number of calculations, a new python project has been developed, 
            <rs type="software">ABIFLOWS</rs> . The package contains all the functionalities required to execute high-throughput workflows with the 
            <rs type="software">FIREWORKS</rs> framework 191 and to store the results in a MongoDB database in a standardized format for later queries and analysis. 
            <rs type="software">ABIFLOWS</rs> heavily relies on the API implemented in 
            <rs type="software">ABIPY</rs> , not only for the aforementioned properties, but also for the automatic generation of 
            <rs type="software">ABINIT</rs> inputs for different kinds of calculations, and the post-processing of results. In order to provide sensible input configurations for phonon calculations and avoid expensive convergence studies for each material, a global study has been performed and a set of heuristic optimal parameters has been determined 192 . These parameters have been used to compute in an automated way the dynamical matrix, the phonon dispersion and the density of states for more than 2000 materials 193 . Taking advantage of the post-processing tools implemented in 
            <rs type="software">ANADDB</rs> , a set of derived quantities has been obtained for these materials. These include the dielectric permittivity tensors, Born effective charges, temperature dependent thermodynamic properties (entropy, heat capacity, Helmholtz free energy, vibrational internal energy), frequency-dependent dielectric tensor, speed of sound along high symmetry directions, and the Debye-Waller tensor 153 . All these quantities are freely available on the MATERIALS PROJECT website 194 .
        </p>
        <p>b. DFPT SHG The workflow for the calculation of vibrational properties discussed in the previous paragraph has been extended to compute the optical dielectric tensor ε ∞ and the second-order susceptibility χ (2) (see Sec. V). This gives access to optical properties beyond the linear regime with minimum effort. For instance, the second-order susceptibility leads to the nonlinear Second Harmonic Generation (SHG) coefficient d eff 195 . SHG processes play an important role in modern optics, especially in laser-related science and technology 196 . Only non-centrosymmetric materials are SHG-active and the calculation of the d eff is possible in ABINIT through the 2n + 1 theorem 9,66 .b. DFPT SHG The workflow for the calculation of vibrational properties discussed in the previous paragraph has been extended to compute the optical dielectric tensor ε ∞ and the second-order susceptibility χ (2) (see Sec. V). This gives access to optical properties beyond the linear regime with minimum effort. For instance, the second-order susceptibility leads to the nonlinear Second Harmonic Generation (SHG) coefficient d eff 195 . SHG processes play an important role in modern optics, especially in laser-related science and technology 196 . Only non-centrosymmetric materials are SHG-active and the calculation of the d eff is possible in ABINIT through the 2n + 1 theorem 9,66 .</p>
        <p>By selecting the non-centrosymmetric materials from databases 197,198 in which the optical dielectric tensors were already available, we built up a new set of candidates including more than 800 compounds aiming at calculating their secondorder susceptibility. At this stage, we have computed the nonlinear properties for more than 400 materials employing the above-mentioned ABIFLOWS workflow. The results of this study will be presented in more detail in a future publication, and many more materials are being added to the list.By selecting the non-centrosymmetric materials from databases 197,198 in which the optical dielectric tensors were already available, we built up a new set of candidates including more than 800 compounds aiming at calculating their secondorder susceptibility. At this stage, we have computed the nonlinear properties for more than 400 materials employing the above-mentioned ABIFLOWS workflow. The results of this study will be presented in more detail in a future publication, and many more materials are being added to the list.</p>
        <p>c. GW Computing the excited-state properties of materials (such as band gaps) implies going beyond standard DFT and its fundamental shortcomings. MBPT provides a rigorous and well-established formalism for accurate band-structure calculations 11 . The main ingredients of MBPT are the Green's function G, the screened Coulomb interaction W and the electronic self-energy Σ that is usually approximated with the GW method 199 . Automating GW calculations at the high-throughput level represents, however, a significant challenge. Compared to the DFT electron density in which only occupied states are needed, the Green's function requires the knowledge of all unoccupied states of the systems. In practical implementations, the sum over an infinite number of bands is avoided by introducing a cutoff (nband) beyond which the contribution of the high-energy states is considered negligible and the Fourier expansion of the two-point function W is restricted to G-vectors lying inside a sphere of kinetic energy ecuteps. The required computational resources increase steeply when these two cutoffs are increased. An additional problem is that these two convergence parameters are linked, i.e. the convergence with respect to one cutoff is determined by the value of the other parameter with a rate that is systemdependent. The level of coupling, moreover, varies strongly from one material to another. Determining reliable input parameters is, hence, of crucial importance to achieve precise and efficient MBPT calculations.c. GW Computing the excited-state properties of materials (such as band gaps) implies going beyond standard DFT and its fundamental shortcomings. MBPT provides a rigorous and well-established formalism for accurate band-structure calculations 11 . The main ingredients of MBPT are the Green's function G, the screened Coulomb interaction W and the electronic self-energy Σ that is usually approximated with the GW method 199 . Automating GW calculations at the high-throughput level represents, however, a significant challenge. Compared to the DFT electron density in which only occupied states are needed, the Green's function requires the knowledge of all unoccupied states of the systems. In practical implementations, the sum over an infinite number of bands is avoided by introducing a cutoff (nband) beyond which the contribution of the high-energy states is considered negligible and the Fourier expansion of the two-point function W is restricted to G-vectors lying inside a sphere of kinetic energy ecuteps. The required computational resources increase steeply when these two cutoffs are increased. An additional problem is that these two convergence parameters are linked, i.e. the convergence with respect to one cutoff is determined by the value of the other parameter with a rate that is systemdependent. The level of coupling, moreover, varies strongly from one material to another. Determining reliable input parameters is, hence, of crucial importance to achieve precise and efficient MBPT calculations.</p>
        <p>To enable high-throughput GW calculations, an automated convergence framework has been developed using the 
            <rs type="software">ABIPY</rs> package 200,201 . A typical workflow is illustrated in Fig. 7. At a low density k-grid, the two interdependent cutoffs are treated in the same loop ensuring convergence of both. The convergence in k-space is treated separately since it was found to be unconnected. In the last step, the convergence rates of the screening cutoff and the unoccupied states cutoff at high k-space sampling are compared to those at low sampling density to finally ensure converged results. This method was used to compute the GW correction for about 90 crystalline compounds 200 .
        </p>
        <p>The 
            <rs type="software">ABINIT</rs> implementation of PAW 44 -although not the only one -is one of the most complete available in a DFT code. Ground-state properties (DFT), excited states (MBPT) and response functions (DFPT) can be computed within PAW. However, the PAW method should theoretically be implemented in the same way in all DFT codes, regardless of the basis used to represent the electronic wavefunctions.
        </p>
        <p>From our original PAW implementation 42 , we have developed a portable PAW library, called 
            <rs type="software">LIBPAW 202</rs> in order to facilitate the porting of PAW in other codes. This library provides a formalism for computational physics -the pseudopotential/PAW approach -at a relatively high implementation level (not only low-level methods, such as I/O, error-handling or systems resolution). It is packaged in such a way that it gives access to implementations of core PAW procedures with basis-independent data interfaces and thus can potentially be combined with any other basis used in different programs.
        </p>
        <p>At present, the 
            <rs type="software">LIBPAW</rs> library -initially used in 
            <rs type="software">ABINIT</rs> -has been integrated in at least two other codes: the wavelet-based 
            <rs type="software">BIGDFT</rs> software 202,203 as well as a re- . Schematic representation of a typical GW workflow. First (w0), the SCF density is calculated (DEN) followed by a non-SCF calculation of a large number of unoccupied states (WFK). Then (w1), the latter are used to determine the screening (SCR). Finally (w2), the GW corrections are computed for different k-points. In the graph, two screening calculations are represented corresponding to different sets of values for the two cutoff parameters. Each of them is followed by three GW calculations corresponding to different kpoints.
        </p>
        <p>cently developed Gaussian-Type Atomic Orbital based DFT code 204 . The use of LIBPAW in three codes, using three different types of basis functions (planewaves, wavelets, gaussians) highlights its portability. Other projects based on the LIBPAW are in progress. The library is currently built "on the fly" from 
            <rs type="software">ABINIT</rs> source files. A standalone and 
            <rs type="software">ABINIT</rs> independent package is generated and can be directly inserted in a "host" code. At present this is the only way to get the 
            <rs type="software">LIBPAW</rs> library; in the near future the 
            <rs type="software">LIBPAW</rs> package will be directly downloadable as a separate package.
        </p>
        <p>As soon as a host code uses the 
            <rs type="software">LIBPAW library</rs>, it can access at low cost a full PAW implementation, and take advantage of regular library updates, new features and debugging. Some features are automatically available because they are only implemented in "on-site" PAW contributions such as, for example, Hubbard Hamiltonian calculations (DFT+U). The library provides a module to access PAW atomic datasets in XML format and in ABINIT proprietary format (legacy). The XML format 181 then gives access to several PAW atomic datasets tables: JTH 179 , GBRV 177 , ATOM-PAW 205 , and GPAW 206 .
        </p>
        <p>The library fits very easily into the host code. A simple libpaw.h header file has to be adapted to integrate the LIB-PAW. In the libpaw.h file, one has to specify which routines are used for the I/O and the error handling, as well as the de-pendencies shared with the LIBPAW (eg, the LIBXC electronic exchange and correlation library 207 or NETCDF interfaces). Most of the low-level dependencies can be shared with the host code. The library is made of a complete collection of Fortran 2003 modules. Therefore it can most easily be incorporated in 
            <rs type="software">codes</rs> written in Fortran. Each Fortran module is related to a specific "object" of the PAW formalism and contains associated methods.
        </p>
        <p>Among the provided objects, the following are worth mentioning (a more complete description is available in Ref. 202):Among the provided objects, the following are worth mentioning (a more complete description is available in Ref. 202):</p>
        <p>• m_pawrad: contains all functions related to the PAW radial meshes and associated derivation/integration routines, for different kinds of meshes (linear or logarithmic).• m_pawrad: contains all functions related to the PAW radial meshes and associated derivation/integration routines, for different kinds of meshes (linear or logarithmic).</p>
        <p>• m_pawpsp: used to read PAW atomic datasets (XML or ABINIT legacy formats),• m_pawpsp: used to read PAW atomic datasets (XML or ABINIT legacy formats),</p>
        <p>• m_pawtab: used to define non-self-consistent tabulated PAW data either read from the atomic dataset or directly deduced from it,• m_pawtab: used to define non-self-consistent tabulated PAW data either read from the atomic dataset or directly deduced from it,</p>
        <p>• m_pawxc: computes the exchange and correlation potential/energy in the PAW augmentation regions using developments over spherical harmonics,• m_pawxc: computes the exchange and correlation potential/energy in the PAW augmentation regions using developments over spherical harmonics,</p>
        <p>• m_pawcprj: calculates, stores and manipulates projections of pseudo-wavefunctions Ψnk on PAW non-local projectors pi : c i nk = pi | Ψnk . Note that the routine dedicated to the computation of these projections has to be provided by the host code,• m_pawcprj: calculates, stores and manipulates projections of pseudo-wavefunctions Ψnk on PAW non-local projectors pi : c i nk = pi | Ψnk . Note that the routine dedicated to the computation of these projections has to be provided by the host code,</p>
        <p>• m_pawrhoij: computes and manipulates the PAW occupancy matrix ρ i j = ∑ nk c i * nk c j nk , especially ensuring the use of symmetries,• m_pawrhoij: computes and manipulates the PAW occupancy matrix ρ i j = ∑ nk c i * nk c j nk , especially ensuring the use of symmetries,</p>
        <p>• m_pawdij: computes and manipulates the PAW nonlocal potential intensities D i j (see Ref. 42 for a complete expression). In this routine all the physical ingredients are included (eg electronic correlations, spinorbit, hybrid functionals, etc.).• m_pawdij: computes and manipulates the PAW nonlocal potential intensities D i j (see Ref. 42 for a complete expression). In this routine all the physical ingredients are included (eg electronic correlations, spinorbit, hybrid functionals, etc.).</p>
        <p>All available methods are fully compatible with the Message Passing Interface (MPI) distributed parallelism, including parallelization over atomic sites, as well as over the real space grid sampling the augmentation regions. A MPI communicator has to be provided.All available methods are fully compatible with the Message Passing Interface (MPI) distributed parallelism, including parallelization over atomic sites, as well as over the real space grid sampling the augmentation regions. A MPI communicator has to be provided.</p>
        <p>The 
            <rs type="software">LIBPAW</rs> library is a perfect example of "code sharing", in the perspective of outsourcing and sharing components common to DFT pseudopotential-based codes. The advantages of code sharing are numerous:
        </p>
        <p>• It enforces clean and structured object-oriented programming (not obvious in the case of Fortran). Strong links to a specific code must be removed, and strong optimization can be implemented once and used widely.• It enforces clean and structured object-oriented programming (not obvious in the case of Fortran). Strong links to a specific code must be removed, and strong optimization can be implemented once and used widely.</p>
        <p>• It allows one to implement a cross-validation process, thanks to the use of the code in different contexts (here different electronic wavefunction bases).• It allows one to implement a cross-validation process, thanks to the use of the code in different contexts (here different electronic wavefunction bases).</p>
        <p>• It allows one to substantially expand the user base and thus to reinforce user feedback.• It allows one to substantially expand the user base and thus to reinforce user feedback.</p>
        <p>• It avoids developers re-coding what already exists, and concentrates human work in implementations of novel physical quantities.• It avoids developers re-coding what already exists, and concentrates human work in implementations of novel physical quantities.</p>
        <p>In the case of ABINIT , this code sharing effort is only in its early stages; other features could be easily packaged and shared: the handling of crystal symmetries, sampling of the Brillouin zone, self-consistent cycle preconditioning/mixing algorithms, ...In the case of ABINIT , this code sharing effort is only in its early stages; other features could be easily packaged and shared: the handling of crystal symmetries, sampling of the Brillouin zone, self-consistent cycle preconditioning/mixing algorithms, ...</p>
        <p>With the increasing use of DFT for materials science applications, the need to have user-friendly packages which calculate and predict structural, electronic, vibrational, and elastic properties is essential. In this paper, we have presented the case of 
            <rs type="software">ABINIT</rs> , an electronic structure package for materials and nanosystem simulations. Though 
            <rs type="software">ABINIT</rs> originally focused on the "simple" solution of the ground state Kohn-Sham equations of DFT, it has broadened to include many different theories with far reaching applications, including DFT, DFPT, TD-DFT, MBPT, and DMFT. Similarly, two different treatments of core electrons are provided: norm-conserving pseudopotentials and projector-augmented waves. Each of these methodologies implement a different set of properties, which are summarized in the previous sections. A list of the capabilities offered by 
            <rs type="software">ABINIT</rs> has been presented, with particular attention given to the graphical interfaces created by the 
            <rs type="software">ABIPY</rs> workflow manager and the post-processing tool 
            <rs type="software">AGATE</rs> .
        </p>
        <p>In this paper, we have also concentrated on the properties which make ABINIT rather unique. We started with DMFT, the application of finite electric fields, probes of nuclei properties (such as the Mössbauer and nuclear spectroscopy), and positron annihilation. We then moved to response functions, which are the most developed features of ABINIT : sections on Raman spectroscopy, electro-optic effects and strain perturbation, van der Waals interactions, flexoelectricity, the electronphonon interaction, anharmonic interatomic force constants, non-collinear magnetism, spin magnetic field and temperature dependence of the optical response with the Bethe-Salpeter equation.In this paper, we have also concentrated on the properties which make ABINIT rather unique. We started with DMFT, the application of finite electric fields, probes of nuclei properties (such as the Mössbauer and nuclear spectroscopy), and positron annihilation. We then moved to response functions, which are the most developed features of ABINIT : sections on Raman spectroscopy, electro-optic effects and strain perturbation, van der Waals interactions, flexoelectricity, the electronphonon interaction, anharmonic interatomic force constants, non-collinear magnetism, spin magnetic field and temperature dependence of the optical response with the Bethe-Salpeter equation.</p>
        <p>After examining individual properties, we presented some of our efforts in community projects and library generation, which can be used by 
            <rs type="software">ABINIT</rs> and many other electronic structure codes. For example, we mention the distribution of reliable and well tested PAW data sets, LIBPAW, the PSEU-DODOJO project, and high-throughput developments to calculate advanced properties in the MBPT and DFPT formalisms.
        </p>
        <p>In conclusion, we have presented here the evolution of 
            <rs type="software">ABINIT</rs> , from its history to the most recent developments. We have also included links to the code documentation and tutorials. The basic theory and frameworks were discussed, which allow users to calculate a broad set of properties. Beyond the features with unique implementations in 
            <rs type="software">ABINIT</rs> , we encourage interested users to visit the 
            <rs type="software">ABINIT</rs> web page for more general documentation, tutorials, and information.
        </p>
        <p>A large part of the data presented in this paper is available directly from the Abinit Web page www.abinit.org. Any other data not appearing in this web page can be provided by the corresponding author upon reasonable request.A large part of the data presented in this paper is available directly from the Abinit Web page www.abinit.org. Any other data not appearing in this web page can be provided by the corresponding author upon reasonable request.</p>
        <p>topic:GW, plot_qps.html Electronic band gap, temperature-dependent Sec. V E, topic:TDepES Electronic band structure Sec. VI B, topic:ElecBandStructure, topic:GW, topic:ldaminushalf, plot_ebands_edos.html, plot_ebands.html, plot_kpath_from_ibz.html, plot_ejdos.html, plot_qpbands_with_scissors.topic:GW, plot_qps.html Electronic band gap, temperature-dependent Sec. V E, topic:TDepES Electronic band structure Sec. VI B, topic:ElecBandStructure, topic:GW, topic:ldaminushalf, plot_ebands_edos.html, plot_ebands.html, plot_kpath_from_ibz.html, plot_ejdos.html, plot_qpbands_with_scissors.</p>
        <p>This work (A.H.R.) has been supported by the DMREF-NSF 1434897, National Science Fondation OAC-1740111 and U.S. Department of Energy DE-SC0016176 and DE-SC0019491 projects.This work (A.H.R.) has been supported by the DMREF-NSF 1434897, National Science Fondation OAC-1740111 and U.S. Department of Energy DE-SC0016176 and DE-SC0019491 projects.</p>
        <p>N.A.P. and M.J.V. gratefully acknowledge funding from the Belgian Fonds National de la Recherche Scientifique (FNRS) under grant PDR T.1077.15-1/7. M.J.V. also acknowledges a sabbatical "OUT" grant at ICN2 Barcelona, as well as ULiège and the Communauté Française de Belgique (ARC AIMED G.A. 15/19-09).N.A.P. and M.J.V. gratefully acknowledge funding from the Belgian Fonds National de la Recherche Scientifique (FNRS) under grant PDR T.1077.15-1/7. M.J.V. also acknowledges a sabbatical "OUT" grant at ICN2 Barcelona, as well as ULiège and the Communauté Française de Belgique (ARC AIMED G.A. 15/19-09).</p>
        <p>X.G. and M.J.V. acknowledge funding from the FNRS under grant number T.0103. 19 -ALPS. X.G. and G.-M. R. acknowledge support from the Communauté française de Belgique through the SURFASCOPE project (ARC 19/24-057). X.G. acknowledges the hospitality of the CEA DAM-DIF during the year 2017. G.H. acknowledges support from the U.S. Department of Energy, Office of Science, United States, Office of Basic Energy Sciences, United States, Materials Sciences and Engineering Division under Contract DE-AC02-05-CH11231: Materials Project program KC23MP. The Belgian authors acknowledge computational resources from supercomputing facilities of the University of Liège, the Consortium des Equipements de Calcul Intensif (FRS-FNRS G.A. 2.5020.11) and Zenobe/CENAERO funded by the Walloon Region under G.A. 1117545. M.C. and O.G. acknowledge support from the Fonds de Recherche du Québec Nature et Technologie (FRQ-NT), Canada, and the Natural Sciences and Engineering Research Council of Canada (NSERC) under grant RGPIN-2016-06666. The implementation of the 
            <rs type="software">LIBPAW</rs> library (M.T., T.R., D.C.) was supported by the ANR NEWCASTLE project, grant ANR-2010-COSI-005-01 of the French National Research Agency. M.R. and M.S. acknowledge funding from Ministerio de Economia, Industria y Competitividad (MINECO-Spain) through Grants No. MAT2016-77100-C2-2-P and No. SEV-2015-0496, and of Generalitat de Catalunya (Grant No. 2017 SGR1506). This work has received funding from the European Research Council (ERC) under the European Union's Horizon 2020 research and innovation program (Grant Agreement No. 724529).
        </p>
        <p>Ph.G. acknowledges support from FNRS Belgium through PDR grant HiT4FiT, ULiège and the Communauté française de Belgique through the ARC project AIMED, the EU and FNRS through M.ERA.NET project SIOX, and the European Funds for Regional Developments (FEDER) and the Walloon Region in the framework of the operational program "Wallonie-2020.EU" through the project Multifunctional thin films/LoCoTED).Ph.G. acknowledges support from FNRS Belgium through PDR grant HiT4FiT, ULiège and the Communauté française de Belgique through the ARC project AIMED, the EU and FNRS through M.ERA.NET project SIOX, and the European Funds for Regional Developments (FEDER) and the Walloon Region in the framework of the operational program "Wallonie-2020.EU" through the project Multifunctional thin films/LoCoTED).</p>
        <p>The Flatiron Institute is a division of the Simons Foundation.The Flatiron Institute is a division of the Simons Foundation.</p>
    </text>
</tei>
