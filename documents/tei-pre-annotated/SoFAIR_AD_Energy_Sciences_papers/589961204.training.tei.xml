<?xml version="1.0" encoding="UTF-8"?>
<tei xmlns="http://www.tei-c.org/ns/1.0">
    <teiHeader>
        <fileDesc xml:id="_1"/>
        <encodingDesc>
            <appInfo>
                <application version="0.8.1-SNAPSHOT" ident="GROBID" when="2024-06-24T12:33+0000">
                    <ref target="https://github.com/kermitt2/grobid">A machine learning software for extracting information from scholarly documents</ref>
                </application>
            </appInfo>
        </encodingDesc>
    </teiHeader>
    <text xml:lang="en">
        <p>The optimal sizing of stand-alone renewable H 2 -based microgrids requires the load demand to be reliably satisfied by means of local renewable energy supported by a hybrid battery/hydrogen storage unit, while minimizing the system costs. However, this task is challenging because of the high number of components that have to be installed and operated. In this work, an MILP optimization framework has been developed and applied to the off-grid village of Ginostra (on the Stromboli island, Italy), which is a good example of several other insular sites throughout the Mediterranean area. A year-long time horizon was considered to model the seasonal storage, which is necessary for off-grid areas that wish to achieve energy independence by relying on local renewable sources. The degradation costs of batteries and H 2 -based devices were included in the objective function of the optimization problem, i.e., the annual cost of the system. Efficiency and investment cost curves were considered for the electrolyzer and fuel cell components in order to obtain a more detailed and precise techno-economic estimation. The design optimization was also performed with the inclusion of a general demand response program (DRP) to assess its impact on the sizing results. Moreover, the effectiveness of the proposed MILP-based method was tested by comparing it with a more traditional approach, based on a metaheuristic algorithm for the optimal sizing complemented with ruled-based strategies for the system operation. Thanks to its longer-term storage capability, hydrogen is required for the optimal system configuration in order to reach energy selfsufficiency. Finally, considering the possibility of load deferral, the electricity generation cost can be reduced to an extent that depends on the amount of load that is allowed to participate in the DRP scheme. This cost reduction is mainly due to the decreased capacity of the battery storage system.</p>
        <p>Immediate and worldwide changes are necessary to meet the main sustainable energy goals [1]. Renewable energy sources (RES) are expected to play a key role in guaranteeing a clean and sustainable development, and in counteracting the effects of climate change [2]. Variable RES, such as solar and wind, have recently shown dramatic growth trajectories, cost reductions and technological improvements [3]. However, the fluctuating and unpredictable nature of RES complicates their integration with power systems [4]. This issue can be addressed by adopting electrical energy storage (EES) devices, which enable any excess renewable energy to be stored for later use [5,6]. As far as remote areas are concerned, the market for off-grid renewable energy systems is expected to increase in the short-to medium-term, through the hybridisation of already existing diesel generators with local RES-based power systems [7]. As a result of their increasing performance and declining costs, batteries are currently the first choice as EES options to make the RES-based energy supply more reliable and effective. However, when energy storage is required for long periods and for large loads, batteries become expensive and their hybridization with other storage typologies may result in a cost-effective solution [8]. In this context, hydrogen can represent an effective storage option, thanks to its long-term storage capability [9].</p>
        <p>The optimal design of off-grid hybrid renewable energy systems (HRESs) is a critical process that must be faced to make the energy supply reliable, cost effective and less polluting. Similarly to the literature on MESs (multi-energy systems) and CHP systems [10,11], twolayer (TL) models are used largely for HRES design optimization. Design and dispatch problems are decoupled in the TL formulation: the outer loop iteratively generates a potential design solution, whereas the inner one deals with the system dispatch and estimates the operational expenses of that given system configuration. Design optimization is usually performed by employing metaheuristic algorithms, whereas ruled-based strategies (RBS) or optimization algorithms are considered to manage operation of the system. Particle swarm optimization (PSO) and genetic algorithms (GAs) are among the most frequently used metaheuristic techniques to cope with the design optimization problem. Maleki et al. [12] found that PSO is better performing and more robust than other optimization methods. The GA technique has also been reported to be highly effective, especially when dealing with multiobjective optimization [13]. With reference to the dispatch problem, ruled-based (RB) energy management strategies (EMSs) consist of a set of pre-defined priority rules that are used to control the system based on the status and characteristics of the installed equipment. More advanced methods, used to deal with the second-layer scheduling problem, may rely on mixed integer linear programming (MILP) techniques [14][15][16][17], which offer the advantage of being able to handle the optimization of the on/off status and operating power of the units [18]. On the other hand, MILP-based approaches can lead to increased computational burden compared to RBSs. Li et al. [14] combined a GA-based sizing algorithm with an MILP-based scheduling algorithm to perform the optimal sizing of a hydrogen/battery power-to-power (P2P) system. In order to limit the simulation time to a reasonable value, they used average weekly data as input for the bi-level optimization process. For the comparison purposes, they also formulated the same problem by means of a more traditional approach based on a ruled-based strategy. A similar bi-level procedure was then applied by Li et al. [15] to a more complex system to deal with cooling, heat and power loads. However, the authors considered only 12 reference days in order to avoid long simulation times. Rullo et al. [16], who also suggested a bi-level framework, employed a GA approach for the outer sizing loop and a rolling horizon MILP technique for the inner scheduling loop. They compared their predictive sizing methodology with a more common procedure based on a ruledbased EMS, and they showed that cost savings could be achieved by adopting the MILP-based approach. Fioriti et al. [17], who also carried out comparisons of priority-and MILP-based operational strategies, performed the outer optimization loop by means of PSO. They observed that the predictive approach based on MILP allowed a slightly lower system cost to be obtained, but at the expense of increased computational requirements.</p>
        <p>HRES design optimization can also be tackled by means of a singlelayer (SL) MILP formulation, which allows the system design and dispatch to be jointly optimized. Unlike the two-layer methodology, the SL approach is able to impose constraints over specific time spans, e.g., yearly system reliability or CO 2 emissions over the year (in TL models, instead, this can only be done by a posteriori penalizing the fitness function of the design solutions that do not satisfy the considered global constraints) [19]. The optimal sizing and scheduling of isolated minigrids, based on RES coupled with batteries and diesel by means of a single-layer MILP, was investigated in Refs. [19][20][21][22]. By applying the MILP-based methodology, Malheiro et al. [20] observed that RES hybridization leads to lower energy costs and that the presence of diesel generators is necessary to limit the system costs and to avoid battery over-sizing. Moretti et al. [19] developed an MILP-based algorithm for the predictive design and dispatch optimization of microgrids, comparing it with a previously developed heuristic methodology. The authors formulated the SL MILP by considering four representative weeks to simulate the entire year. They showed that the MILP-based approach leads to lower electricity costs, improved reliability and greater RES penetration. A single-layer MILP formulation was also developed by Alberizzi et al. [21,22], who performed the HRES sizing problem with limited time spans of 1 day and 1 month. Novel MILP methodologies may be required when dealing with the design of more complex energy systems, especially when seasonal storage devices are included. Gabrielli et al. [23] developed an SL MILP formulation based on the coupling of typical days with the aim of reducing the number of binary variables and thus the complexity of the problem. Clustering approaches, such as k-means, k-medoids and hierarchical clustering [24], are commonly used to select typical periods for the optimal system design. Novel clustering formulations can also be found, such as the one developed by Zatti et al. [25], which is able to find both the most representative days of the year and the extreme days.</p>
        <p>The present study focuses on the optimal design of a stand-alone HRES that includes photovoltaic panels, batteries and hydrogen (i.e., electrolyzer, H2 storage tank and fuel cell). The optimization framework was applied to the off-grid village of Ginostra (on the island of Stromboli, Italy), which is representative of many other isolated insular locations. A single-layer MILP method was formulated to deal with both the design and the scheduling of the system. A year-long time horizon, with an hourly resolution, was considered to account for the seasonality of RES production and electrical demand, and thus to size seasonal energy storage devices (which are key components for off-grid communities that rely on local RESs) more accurately. The wear costs of batteries and H2-based devices were considered, in terms of operating costs included in the objective function of the optimization problem, in order to preserve as much as possible their state-of-health. Piecewise affine approximations of the efficiency curves of the electrolyzer and fuel cell were also included for a more detailed modelling of their performance. This is particularly suited when analyzing energy systems that involve intermittent renewable energy sources. To the best of our knowledge, no studies have been published that have dealt with singlelayer MILP methods with 1-year time horizon and with the inclusion of degradation costs of the P2P components. Moreover, the effect of the demand response program (DRP) on the optimal size of the components was investigated by means of the time of use (TOU) approach [26,27]. An increasing number of studies have addressed the problem of demand response strategies for an optimum power management [28]. However, the literature about DRP applied to the design optimization problem is scarce [29,30]. The investigation of how DRP can affect the overall system costs, and hence the component sizes, is therefore of great interest.</p>
        <p>The paper is structured as follows: Section 2 introduces the selected case study and the related problem that has to be solved. Section 3 describes how the various components are modelled within the MILP formulation and presents the objective function that has to be minimized. Section 4 reports the main results and the related discussion about the optimal sizing problem. A comparison with a more traditional metaheuristic-based sizing approach, based on RB operational strategies, is also performed. Finally, the conclusions of the work are presented in Section 5. Additional information about how the MILP problem is formulated is shown in the Appendix, together with main input data used for the selected case study.</p>
        <p>The design optimization methodology was applied to the case study of Ginostra [8,31], a village on the island of Stromboli in the South of Italy. This small remote island community is completely off-grid and its electric load, of approximately 172 MWh per year, is covered entirely by means of diesel generators. The cost of energy is at present very high (around 0.86 €/kWh) because of the expensive operating costs of the gensets. The difficult fuel supply logistics of isolated off-grid areas inevitably result in high fuel transportation costs: the diesel price in Ginostra is about 2 €/L [8] (which is in line with that assumed by Gracia et al. [32] and Alberizzi et al. [21]). The energy needs are also highly seasonal, ranging from around 10 MWh/month in winter to 30 MWh/ month in summer. This is mainly due to tourism, which causes the number of inhabitants to increase to about 200 people during summertime (the village has only 40 people who live there throughout the rest of the year). Reducing the current fuel consumption, by exploiting local renewable sources, is therefore of great interest for the village in order to lower the cost of electricity, decrease local pollution and make the island energy independent. However, an effective EES solution also needs to be integrated to cope with the RES intermittency and load highly seasonal behavior.</p>
        <p>The input data for the Ginostra site (the hourly profiles of meteorological and load data over the year) are reported in Appendix B. PVGIS was used to derive the ambient air temperature and solar irradiance values, referring to a typical meteorological year (TMY) [33]. The electrical load data were instead taken from [8].</p>
        <p>A single-layer MILP problem was developed, considering a time horizon (T) of one year with a time step discretization of one hour. The model enables the optimal sizing of the renewable P2P system to be obtained together with its optimal hourly dispatch strategy throughout the entire year.</p>
        <p>The considered input data for the optimization problem are:</p>
        <p>1. Meteorological data (i.e., site-specific temperature and irradiance data) ∀ t ∈ T 2. The electricity demand ∀ t ∈ T 3. Performance and cost data of the various components, i.e., photovoltaic panels (PV), electrolyzer (EL), fuel cell (FC), hydrogen tank (HT) and battery (BT).</p>
        <p>The following decision variables were computed:</p>
        <p>1. The sizes of the various components (i.e., PV, EL, FC, HT and BT), which were treated as continuous variables and allowed to vary over a certain size range. 2. The on/off status of EL and FC ∀ t ∈ T 3. The input and output power of EL and FC and the charging/discharging power of BT ∀ t ∈ T 4. The energy stored in the HT and BT ∀ t ∈ T 5. The curtailed power and load that is not satisfied ∀ t ∈ T 6. The amount of load increase/decrease in the case of DRP ∀ t ∈ T The stand-alone HRES is composed of the following components: PV panels, a battery storage system (BSS) and a hydrogen storage system (HSS), which includes an electrolyzer, pressurized H 2 tanks and a fuel cell. All the elements are connected to a direct current (DC) bus by means of power converters. The general scheme of the HRES is shown in Fig. 1.</p>
        <p>The power balance that has to be satisfied at any time step on the DC bus is represented by the following equation: P RES (t) + P BT,dc (t) + P FC (t) + P NS (t) = P LD (t) + P BT,ch (t) + P EL (t) + P CT (t)</p>
        <p>where P RES (t) is the power produced by the installed renewable generators (i.e., PV in this study), P BT,dc (t) and P BT,ch (t) correspond to the discharging and charging power of the battery, respectively, P FC (t) is the fuel cell operating power, P EL (t) is the electrolyzer operating power, P LD (t) is the total power required by the load, P NS (t) is the load that is not satisfied (i.e., the fraction of load not satisfied by the renewable P2P system) and P CT (t) is the curtailed power. The sizing methodology, by means of the MILP approach, is outlined in Fig. 2. The various steps of the optimal sizing procedure are described in the following subsections.</p>
        <p>The size of each component of the renewable P2P system is imposed to lie between a minimum and maximum value, according to the following constraints (with j = PV, FC, EL and i = BT, HT): P j,rated,min ≤ P j,rated ≤ P j,rated,max</p>
        <p>(2)</p>
        <p>where P j,rated (in kW) corresponds to the rated power of the j-th component and Cap i (in kWh) represents the rated storage capacity of the i-th component. More specifically, P EL,rated is the gross inlet rated power of the electrolyzer (gross of BOP losses) and P FC,rated is the net outlet rated power of the fuel cell (net of BOP losses).</p>
        <p>The lower size limit of each technology was set to zero. A certain component is thus selected, within the system configuration, whenever the MILP simulation returns a value of its size greater than zero.</p>
        <p>The power produced by the PV generator was computed as in [14,34,35]:</p>
        <p>where G(t) (in kW/m 2 ) is the total irradiance incident on the PV array, G STC (in kW/m 2 ) is the incident irradiance under standard test conditions (STC), P PV,rated (in kW) is the rated PV power, T cell (in • C) is the PV cell temperature , T cell,STC (in • C) corresponds to the PV cell temperature under standard test conditions, f PV is the derating factor and γ (in 1/K) is the temperature coefficient. The PV cell temperature was derived according to the relationship reported in [36]. The total irradiance G(t) was computed based on the direct normal irradiance and the diffusive and total irradiance on the horizontal surface [37,38]. These values were obtained from the 
            <rs type="software">Photovoltaic</rs> geographical information system (
            <rs type="software">PVGIS)</rs> software [33], considering a typical meteorological year (TMY).
        </p>
        <p>In order to define the minimum and maximum operating power of the electrolyzer and fuel cell, the following auxiliary variable should be defined (with j = EL, FC): P j,rated,aux (t) = P j,rated ⋅δ j (t)</p>
        <p>where P j,rated (in kW) is the EL/FC rated power and δ j (t) is a binary variable that is equal to 1 when the EL/FC device is operating, and 0 otherwise. The auxiliary variable allows the product of the two decision variables to be transformed into the following set of linear inequalities:</p>
        <p>P j,rated,aux (t) ≥ P j,rated -</p>
        <p>P j,rated,aux (t) ≤ P j,rated,max ⋅δ j (t)</p>
        <p>P j,rated,aux (t) ≥ P j,rated,min ⋅δ j (t)</p>
        <p>It is thus possible to impose a constraint on the minimum and maximum operating power of the electrolyzer and fuel cell as follows (with j = EL, FC): y j,min ⋅P j,rated,aux (t) ≤ P j (t) ≤ y j,max ⋅P j,rated,aux (t) (10) where the terms y j,min and y j,max represent the lower and upper boundaries of the EL/FC modulation range. P j (t), as shown in Fig. 1, is defined at the AC bus level (it corresponds to the gross inlet electrical power for the electrolyzer and to the net outlet electrical power for the fuel cell).</p>
        <p>A piecewise affine (PWA) approximation was implemented to describe the detailed nonlinear performance curve of the electrolyzer and fuel cell devices (i.e., the relationship between the input and output operating power). The curves were described by means of n line segments, and the positions of the related n + 1 breakpoints were found by resolving an optimization problem [39], whose procedure is detailed in Appendix A.</p>
        <p>The PWA approximation of the performance curve was then implemented in the MILP formulation. This was performed by applying the following relationship for each i-th line segment of the curve (with j = EL, FC): P j,out (t) ≤ α j,i ⋅P j,in (t) + c β j,i ⋅P j,rated,aux (t) (11) where P j,in (t) and P j,out (t) correspond to the inlet and outlet power of the EL/FC device, respectively. The α j,i term is the slope of the i-th segment; whereas c β j,i is a coefficient that refers to the intercept of the segment. Additional details are provided in Appendix A. The inlet and outlet power of the fuel cell correspond to the inlet hydrogen power (LHV basis) and the generated electrical power (net value), respectively. The inlet and outlet power of the electrolyzer instead represent the absorbed electrical power (gross value) and the produced hydrogen power (LHV basis).</p>
        <p>The battery component was modelled by introducing an energy balance in the form of the following linear in [14,34,35]equation:</p>
        <p>where E BT (t) (in kWh) is the amount of energy stored in the battery, σ BT is the battery self-discharge coefficient, η BT,conv is the efficiency of the battery converter, η BT,ch is the battery charging efficiency and η BT,dc is the battery discharging efficiency. A certain energy content was imposed in the battery at the beginning of the simulation: (13) where SOC in corresponds to the initial state of charge (SOC) and Cap BT (in kWh) is the battery rated capacity. The battery SOC is here defined as the ratio of the energy stored in the battery to the battery rated capacity.</p>
        <p>The following equality constraint was also introduced to enforce that the state of charge of the battery at the end of the year was equal to the initial one, thus guaranteeing the sustainability of the BSS:</p>
        <p>The energy stored in the battery should lie between a minimum and maximum value at each time step:</p>
        <p>where SOC min corresponds to the minimum SOC below which the battery should not operate in order to avoid a significant decrease in the number of cycles before being replaced. SOC max is instead the state-of-charge value that is reached by the battery when it is fully charged. The values chosen for SOC in , SOC min and SOC max are reported in Table C2. Unlike Refs. [14,15], the definition of binary variables that specify whether the battery is charging or discharging is not required here, with a consequent saving of computational time. This is because the charging/discharging efficiency of the battery is lower than 1, and the energy lost by charging and discharging the battery at the same time instant has a greater influence than the chosen MIP gap [40]. Therefore, the optimization process is able to automatically select the most appropriate operating mode of the battery at each time step.</p>
        <p>Pressurized tanks are employed to store the hydrogen produced by the electrolyzer. A compression step may be required, depending on the electrolyzer output pressure and the maximum pressure reachable within the tank. In this study, a direct connection between the electrolyzer outlet and the pressurized hydrogen tank is considered, i.e., no compression is necessary [8].</p>
        <p>Analogously to the BSS, the energy that is stored in the tank in the form of hydrogen (i.e., E H2 (t) in kWh) was computed at each time step using the following energy balance:</p>
        <p>+P EL,out (t -1)⋅Δt -P FC,in (t -1)⋅Δt (16) where P EL,out (in kW) is the electrolyzer outlet power (corresponding to the generated H 2 power on an LHV basis) and P FC,in (in kW) is the fuel cell inlet power (corresponding to the consumed H 2 power on an LHV basis).</p>
        <p>The related H 2 pressure can then easily be derived by employing the ideal gas law. The equality constraints (17) and (18) were employed to impose the same storage level at the beginning and at the end of the year in order to guarantee the energy self-sufficiency of the HSS:</p>
        <p>E H2 (t end ) + P EL,out (t end )⋅Δt -P FC,in (t end )⋅Δt = Cap H2 ⋅LOH in (18) where LOH in corresponds to the level of hydrogen at the beginning of the simulation and Cap H2 (in kWh) is the hydrogen storage rated capacity.</p>
        <p>The LOH parameter can be defined as the ratio of the hydrogen pressure to the maximum storage pressure.</p>
        <p>The energy content of the hydrogen tank should be between a minimum and maximum value, which are related to the hydrogen tank rated capacity and the LOH boundaries:</p>
        <p>In order to allow hydrogen to be supplied to the fuel cell, the H 2 pressure in the tank should not fall below a certain value (corresponding to a certain LOH min ), which depends on the constraint on the FC supply pressure imposed by the manufacturer. The LOH in , LOH min and LOH max values are shown in Table C3.</p>
        <p>The loss of power supply probability (LPSP) index was used to quantify the reliability of the stand-alone renewable P2P system [41]. This index represents the ratio of the energy shortage to the total energy demand over the whole simulation period T (i.e., 1 year):</p>
        <p>The following constraint was applied:</p>
        <p>where LPSP * is the LPSP target value that has to be satisfied. A value of 0 was considered to make the off-grid system completely energy autonomous.</p>
        <p>The objective function (OF) of the optimization problem is given by the total annual cost of the system C AC,tot (in €/yr) that is not discounted.</p>
        <p>It is composed of the following three contributions:</p>
        <p>where C AC,inv is the initial annual investment cost, C AC,OM,fix corresponds to the yearly fixed costs related to maintenance and operation, which do not depend on the energy management strategy, and C AC,op,var represents the yearly operating costs that depend on the EMS. The annual investment cost was defined as (with i = PV, HT and j = EL, FC, BT):</p>
        <p>where L PR (in yr) corresponds to the lifetime of the project, C inv,i/j is the investment cost of the i/j-th component and y BOP,j represents the fraction of the investment cost that is due to the balance of plant (BOP). The costs related to the battery module and to the stack of the EL/FC devices are not included in the above equation since they are already accounted for in the C AC,op,var term. These costs in fact depend on the number of times the BT module and EL/FC stacks are bought during the lifetime of the project (i.e., at the beginning of the project period and potentially one or more times due to replacements). This number of purchases depends on the lifetime of the BT module and of the EL/FC stack, which is a consequence of their size and degradation pattern related to the yearly dispatch profile. This also implies a linear depreciation of the components, meaning that their salvage value is directly proportional to their remaining life.</p>
        <p>As far as the electrolyzer and fuel cell are concerned, the power cost functions from Marocco et al. [31] were considered for C inv . The PWA approach was used to approximate these cost functions. The positions of the various breakpoints, related to the line segments of the PWA approximation, were computed by carrying out an optimization process analogous to the one developed for the performance curves. However, when implementing the PWA approximation in the MILP problem, since the investment cost has to be minimized and the cost function is concave, the introduction of a binary variable is necessary for each of the n line segments in order to identify the active one. A continuous variable should also be added for each line segment. Details of the methodology used to implement the size dependency of the investment cost are reported in Appendix A.</p>
        <p>The fixed operating and maintenance cost term (C AC,OM,fix ) is given by the sum of the fixed O&amp;M costs of all the components of the system, which are expressed as a fraction of their investment cost (EL, FC, HT) or as a function of their rated size (PV, BT). The variable operating term (C AC,op,var ) was instead expressed as follows (with i = BT ch , BT dc , EL, FC):</p>
        <p>where the term C op,var,i (t) corresponds to the variable operating cost associated with the i-th system operation mode during time step t.</p>
        <p>The battery operating cost was treated as a degradation cost, which can be defined as the cost of the energy flowing through the battery bank. It was hypothesized that the battery component will be replaced once its overall throughput becomes equal to its lifetime throughput (LT). The lifetime throughput was computed starting from the lifetime curve in which different depth-of-discharge (DOD) values are reported together with the related cycles-to-failure (CTF) values [42]. The LT (in kWh) is given by:</p>
        <p>where DOD i and CTF i represent the DOD and CTF values of the i-th point of the lifetime curve and n is the number of CTF-DOD points of the lifetime curve.</p>
        <p>The battery operation cost during charging (in €/h) can then be described as [15]:</p>
        <p>which, once rearranged, becomes:</p>
        <p>where C BT,mod (in €) is the battery module cost, whereas c BT,mod (in €/kW)</p>
        <p>is the specific battery module cost. Similarly, the operating cost during battery discharging is:</p>
        <p>C op,var,BTdc (t) = c BT,mod 2⋅(DOD i ⋅CTF i ) avg ⋅η BT,dc ⋅η BT,conv ⋅P BT,dc (t) (28)</p>
        <p>The cost incurred in operating the electrolyzer and the fuel cell (in €/h) can be defined as (with j = EL, FC) [15]:</p>
        <p>where N h,tot,j (in h) represents the total number of life hours of the device, C j,stack (in €) is the EL/FC stack cost and C OM,var,j (in €/h) is the variable hourly O&amp;M cost. As can be seen in Eqs. ( 27) and ( 28), the variable O&amp;M cost of the battery was neglected, as commonly adopted in the literature [14,15]. Considering the auxiliary variable P j,rated,aux (t), the above expression can be rearranged as follows:</p>
        <p>where c j,stack (in €/kW) is the specific stack cost of the electrolyzer and fuel cell and c OM,var,j (in €/kW/h) is the specific variable hourly O&amp;M cost.</p>
        <p>The total O&amp;M cost of the electrolyzer and fuel cell (set to 4% of the investment cost) was supposed to be divided into 1/3 fixed and 2/3 variable costs [43]. The variable costs are proportional to the operating time of the device:</p>
        <p>The variable C j,start (t) (in €/start-up) corresponds to the start-up cost associated with the electrolyzer and fuel cell. It is described, in the MILP formulation, by the following two linear constraints:</p>
        <p>C j,start (t) ≥ c j,stack N start,tot,j ⋅ ( P j,rated,aux (t) -P j,rated,aux (t -1)</p>
        <p>where N start,tot,j is the total number of start-ups that the device can undergo during its lifetime. The stack cost, as reported in Table C3, was defined as a fraction of the investment cost. In order to avoid the introduction of new auxiliary variables, which would make the problem more complex, the investment cost that appears in Eq. (30) (in the c j,stack , c OM,var,j and C j,start (t) terms) was linearly approximated.</p>
        <p>The aim of a demand response program is to reduce the overall costs by varying the load consumption patterns. Various techniques can be applied to include the DRP in an optimization problem. In the present study, the time-of-use (TOU) rate of DRP [26,27,44] is considered. The load curve over a defined time horizon is changed by shifting a certain percentage of load from expensive periods to other cheaper periods, thereby allowing a reduction of the total cost to be achieved.</p>
        <p>The new electrical load thus becomes equal to the base load plus a variable power term, which can be either positive or negative:</p>
        <p>The amount of the load increase/decrease should be less than a certain percentage of the base load (DRP MAX ), as described by the following constraint:</p>
        <p>The overall load over a certain time (T DRP ) remains fixed, as the DRP mechanism is just a translation of a certain amount of load from some periods to others to achieve a cost reduction. This can be expressed by the following constraint:</p>
        <p>A daily time horizon (i.e., T DRP =24) is considered in this study.</p>
        <p>As can be seen in Eq. ( 35), the maximum capability of load shifting is limited: the DPR MAX parameter was set to 20% in Refs. [27,44], where the optimal scheduling of a grid-connected hybrid system was performed. The DPR MAX parameter was varied in the 0-30% range by Majidi et al. [26] for a similar system. Sensitivity analyses in the 0-15% and 0-20% ranges were instead performed in Refs. [45,46], where the energy management of off-grid renewable systems was analyzed. In our study, a sensitivity of DPR MAX in the 0-30% range is considered to better evaluate the influence of a demand-side management mechanism on the optimal microgrid sizing.</p>
        <p>A practical implementation of the DRP could involve sending online signals to consumers in order to modify their consumption pattern, but leaving the daily energy demand constant (as imposed by Eq. ( 36)) [45,46]. This can be done, for example, by means of a Supervisory Control and Data Acquisition (SCADA) approach, as described by Palma-Behnke et al. [47].</p>
        <p>The techno-economic parameters of the various components of the [31].</p>
        <p>Four line segments, corresponding to 5 breakpoints, were chosen for the efficiency curves of the electrolyzer and fuel cell since they were found to accurately describe the EL and FC performance, as shown by the relative error graphs in Fig. 3. The performance curves were taken from [31], where the electrochemical models were validated using experimental data from Refs. [48,49].</p>
        <p>The main parameters of the PWA approximation of the performance curves of the electrolyzer and fuel cell devices are reported in Table 1.</p>
        <p>The η k and z k terms correspond to the efficiency (on an LHV basis) and the fraction of the rated inlet power in correspondence to the k-th breakpoint. It can be noted that z 1 is 0.1 for the PEM electrolyzer, which corresponds to the lower boundary of the EL modulation range (see Table C.3). The z 1 value reported in Table 1 for the PEM FC is instead slightly different from the minimum fuel cell power fraction (i.e., 6% of the rated net outlet power) since z 1 refers to the rated inlet power, i.e., power in terms of hydrogen for the FC.</p>
        <p>The scale dependency of the EL and FC system investment cost was modelled by means of a power function [8]:</p>
        <p>where c inv (in €/kW) is the specific investment cost of the EL/FC component, whose rated size is P rated (in kW), and c inv,ref (in €/kW) represents the reference specific investment cost of the same component with a reference rated size P rated,ref (in kW). The term n stands for the cost exponent of the power function.</p>
        <p>The parameters of the PWA approximation of the investment cost curve are shown in Table 2 for both the electrolyzer and the fuel cell. The terms z k and c inv,k represent the fraction of the maximum rated power (i. e., P EL,rated,max and P FC,rated,max ) and the specific investment cost (in €/kW) with reference to the k-th breakpoint of the cost curve. Three line segments (i.e., four breakpoints) were considered to obtain a good representation, while limiting the number of binary variables.</p>
        <p>After performing the full year MILP process to optimally size the system, another full year MILP simulation was carried out with fixed component sizes. In this second MILP formulation, the investment and replacement-related costs were calculated using the power function of Eq. ( 37) without PWA approximation (since sizes of the installed technologies are already known). This was done to obtain a more accurate estimate of the various techno-economic parameters. The levelized cost of energy (LCOE) was then derived as follows (with i = PV, EL, FC, BT, HT; k = EL, FC, BT and z = EL, FC):</p>
        <p>where C inv,i,0 is the investment cost of the i-th component performed at the beginning of the analysis period, C OM,var,z,j is the variable O&amp;M cost of the z-th component for the j-th year (this term is only considered for EL and FC), C OM,fix,i,j is the fixed O&amp;M cost of the i-th component for the j-th year, C rep,k,j is the replacement cost of the k-th component for the j-th year (related to battery module and/or EL/FC stack replacement), C sal,k,LPR is the salvage term of the k-th component at the end of the lifetime of the project (L PR ), E tot,j is the total amount of energy provided by the renewable P2P system to the final user over the j-th year and, finally, d is the real discount rate.</p>
        <p>The real discount rate (d) was derived based on the nominal discount and inflation rates, according to the relationship outlined in [8]. The salvage value, which depends on the replacement cost, was assumed to be directly proportional to the remaining life of the component and to occur at the end of the lifetime of the project (it was considered for devices that could need replacement, i.e., BT, EL and FC).</p>
        <p>The BT, EL and FC lifespans need to be computed to know when the replacement cost occurs. The battery lifetime is given by the ratio of the replacement cost to the yearly degradation cost as follows:</p>
        <p>Similarly, the lifetime of the electrolyzer and fuel cell stack is defined as (with j = EL, FC):</p>
        <p>The variable O&amp;M term (C OM,var,j ) is removed from the denominator of Eq. ( 40) since it does not account for component degradation. Eqs. (39) and ( 40) are equivalent to the relationships reported in Ref. [31]. As shown in the above formula for the lifetime estimation, when the computed lifetime value is higher than the duration of the project, the lifetime of the component is set equal to L PR .</p>
        <p>It should be noted that the LCOE was derived in the post-processing phase (as also shown in Fig. 2). This economic parameter is often considered in the literature when performing techno-economic analysis of HRES. Its estimation may therefore be useful for comparison with other studies dealing with off-grid energy systems. In the present work, the LCOE was not used as objective function in the single-layer MILP, due to the impracticability of discounting the cash flows related to the replacement costs of the P2P components (whose lifetime is not known a-priori, but defined by the MILP optimization). As reported in Eq. ( 22), the OF is thus given by the total annual cost (which is undiscounted).</p>
        <p>The storage autonomy (SA) was also computed in the post-processing step. It is defined as the ratio of the maximum useful energy that can be stored to the daily average load:</p>
        <p>where η FC,avg (with inclusion of BOP losses) is the average fuel cell efficiency and L avg,day (in kWh/day) is the daily average load.</p>
        <p>For comparison purposes, a design optimization of the RES + P2P system was also performed by employing the PSO algorithm (for the system sizing) with the implementation of a ruled-based EMS (for the system operation), as described in Ref. [31]. PSO is one of the most widely used metaheuristic techniques to deal with the optimal sizing of renewable energy systems [50], due to its good performance and high level of robustness [12].</p>
        <p>The ruled-based EMS that is adopted in the present study has frequently been used in the literature [31]. Priority of operation is given to the battery device, which acts as a short-term energy storage device to smooth the RES intermittency and limit the number of start-ups and shutdowns of the electrolyzer and fuel cell. Surplus energy, if present, is used to charge the battery and then converted into hydrogen through the PEM electrolyzer when the maximum battery SOC has been reached. Instead, during renewable power shortages, the battery first intervenes to cover the load until the minimum SOC is reached (and the fuel cell is switched on).</p>
        <p>Eqs. ( 12) and ( 16) were used to compute the energy content in the battery and H 2 tank at each time step, respectively. Like the MILP methodology, the LPSP index was considered to assess the reliability of the stand-alone energy system. A sustainability constraint was also introduced to guarantee that the SOC and LOH values at the end of the reference year were no lower than the ones at the beginning of the simulation. The techno-economic data reported in Appendix C were used as input for the simulation. The LCOE, computed through Eq. ( 38), was considered as objective function of the optimal sizing problem.</p>
        <p>The optimization problem was formulated in the 
            <rs type="software">MATLAB</rs> environment employing 
            <rs type="creator">IBM</rs>
            <rs type="software">CPLEX</rs> as the solver. A relative MIP gap of 1% was imposed. Simulations were performed on a desktop computer with an Intel(R) Core(TM) i7-4770 CPU of 3.4 GHz and with 32 GB RAM.
        </p>
        <p>The main results, referring to both the single-layer (SL) MILP-based algorithm and the more traditional two-layer (TL) approach (with a metaheuristic algorithm for the optimal design and ruled-based strategies for the system operation), are shown in Table 3. It can be noted that the LCOE computed by means of the SL technique is around 11% lower than the one derived when employing the TL methodology (0.455 €/kWh compared to 0.512 €/kWh). PV panels and hydrogen-based components are in fact smaller in size when the MILP-based technique is applied (the battery capacity is instead slightly higher).</p>
        <p>The contribution of the various components to the overall LCOE is depicted in Fig. 4. With reference to the MILP-based approach (Fig. 4a), the BSS accounts for almost half of the LCOE, whereas the HSS accounts for approximately 17%. Batteries in fact operate daily as short-term storage devices and their rated capacity should be sufficient to cover most of the power shortages that can occur throughout the year. Hydrogen, instead, intervenes less frequently; however, because of its longer-term storage capability, its presence is essential to provide a costeffective and reliable power supply service.</p>
        <p>The main technical KPIs are summarized in Table 4. A battery duration of approximately 13 years was derived, which is in line with the lifetime values commonly employed in the literature for Li-ion batteries [8]. The lifetime of the PEM electrolyzer was found to be lower for the MILP-based method, due to the higher number of operating hours in the reference year (4739 h for the SL technique compared to 1655 h for the TL method). However, the size of the electrolyzer computed by the MILP-based approach is less than half that obtained when using the metaheuristic approach. This results in lower electrolyzer costs over the lifetime of the project for the SL model (despite the lower EL lifetime). No necessity of replacement of the fuel cell stack was observed for either of the optimization methodologies. In fact, fuel cell operation is not required over the whole year, and is mainly focused on the summer period to cope with the increase in load.</p>
        <p>Despite its advantages, the MILP-based approach presents some limitations that should be pointed out. Unlike the TL method, the MILP formulation requires all of the non-linear equations to be linearized, which results in increased problem complexity. Moreover, the proposed SL method needs more time to be solved: approximately 4 h are necessary to solve the MILP problem, whereas just a few minutes are sufficient for the other sizing technique. However, the CPU time of the SL method can still be considered reasonable.</p>
        <p>The yearly profiles of the energy stored in the form of electrochemical energy (battery) and chemical energy (hydrogen) are shown in Fig. 5 for the MILP approach. It can be noted that the battery component absorbs and desorbs energy on a short-term basis, thereby smoothing the RES intermittency. The profile of the energy stored through hydrogen is instead less variable and shows a seasonal trend. The H 2 tank installed capacity is around 5 times higher than that of the battery (3092 kWh of HT compared to 613 kWh of BT). The resulting total storage autonomy, defined by Eq. ( 41), is almost 4 days. The small-size electrolyzer intervenes at full power almost every time there is a surplus of RES energy (4739 h per year). Its size is sufficient to gradually produce hydrogen during the spring and fill the pressurized tank, which is then quickly emptied in summer because of the increased energy consumption in Ginostra. The fuel cell operates mainly in summer (686 h per year) and its size, which is around three times higher than that of the electrolyzer, is required to fully cover the peak demand.</p>
        <p>A stand-alone system with only batteries as storage medium was also analyzed to further highlight the role of hydrogen. The LCOE of this HRES configuration (of around 0.544 €/kWh) is higher than the LCOE of the hybrid storage case (i.e., 0.455 €/kW for the SL MILP). This is due to the higher PV rated power (291 kW) and BT capacity (941 kWh). Thus, hydrogen becomes crucial to avoid the over-dimensioning of the battery size and to better exploit the local solar source.</p>
        <p>Local renewables, together with batteries and hydrogen, therefore represent a cheaper solution than the current diesel-based power system (whose LCOE is 0.86 €/kWh [8]). The renewable P2P system is also an environmentally friendly option since, unlike diesel engines, no carbon dioxide or local contaminants are released during its operation.</p>
        <p>A demand response strategy was implemented in the MILP-based problem in order to decrease the cost of energy and assess its influence on the sizes of the components. The time of use (TOU) rate of the DRP approach (Section 3.4) is considered in the present study. A sensitivity of the DRP MAX parameter in the 0-30% range was also performed.</p>
        <p>Table 5 reports the main sizing results for the various DRP scenarios. The total system cost is observed to decrease as a result of implementing a demand management program. Moreover, the cost reduction becomes more relevant as the amount of the load that is allowed to participate in DRP is increased (i.e., a higher value of the DRP MAX parameter). The LCOE drops from 0.455 €/kWh, for the base case without DRP, to around 0.402 €/kWh when a DRP MAX equal to 30% is applied. This cost reduction has mainly been ascribed to the decrease in the Li-ion battery capacity, which moves from 613 to 454 kWh when the DRP MAX value changes from 0 to 30%. Almost no changes in size are noticed for the other system components (i.e., PV panels and HSS) when considering the demand response. The main contribution of the battery component to lowering the cost of energy in the presence of DRP can also be observed by looking at the LCOE breakdown for the various DRP cases shown in Fig. 6. As previously reported, the battery device works mainly as a daily energy buffer to cope with renewable energy surplus and shortages. In the presence of DRP, the load is generally deferred from night hours to the period of the day during which there is excess renewable energy (from the PV system). A smaller amount of energy therefore needs to be provided by the BSS, due to the increased direct consumption of solar energy, with a consequent decrease in the battery capacity that has to be installed. Instead, the hydrogen storage system, which acts mainly as a long-term storage device (to deal with the seasonal variations of the electrical demand), is almost not influenced by the adoption of DRP.</p>
        <p>The effectiveness of load deferral in reducing the LCOE, thanks to the reduction in the required energy storage capacity (of the BSS in the case study under analysis), is thus shown. The adopted DRP formulation could be made more specific if more detailed information about the electrical load composition were available. In case the individual appliances that contribute to the electrical demand are known, it would be possible to choose those that are given the flexibility of load deferral and those that require immediate coverage.</p>
        <p>The optimal design and yearly dispatch of a stand-alone renewable P2P system has been investigated by developing an MILP-based optimization methodology. For comparison purposes, the optimal design was also carried out by means of a metaheuristic technique together with ruled-based operational strategies. The optimization framework was applied to the off-grid insular village of Ginostra.</p>
        <p>The proposed MILP-based approach was shown to be more performing than the alternative metaheuristic method since it allows a cheaper system configuration to be identified. However, because of the larger number of decision variables, greater computational resources were required for the resolution of the MILP problem.</p>
        <p>Concerning the case study of Ginostra, the electricity generation cost is currently very high (approximately 0.86 €/kWh), mainly because of the high operating costs related to the consumption of fossil fuel. Relying on local renewables, coupled with batteries and hydrogen, was found to be economically more competitive than the current diesel-based power system. In fact, a levelized cost of energy of around 0.455 €/kWh was computed by the MILP methodology for the renewable hydrogen-battery system (0.512 €/kWh when employing the metaheuristic technique).</p>
        <p>Especially, the hydrogen storage system is necessary in the optimal HRES configuration thanks to its cost-effective long-term capability, which reduces the required battery capacity and leads to a better exploitation of the local RES. Demand side management was also applied to evaluate its impact on the sizing optimization. By improving the balance between RES supply and demand, it has been shown that the DRP leads to a reduction in the cost of the system: the LCOE moves from 0.455 €/kWh for the base case with no DRP to around 0.402 €/kWh when the DRP MAX parameter is set equal to 30%. This cost reduction is mainly due to the decreased capacity of the battery storage system, which drops from 613 kWh to 454 kWh.</p>
        <p>In conclusion, the proposed MILP-based methodology has proved to be effective in coping with the design of reliable and cost-competitive off-grid HRESs. Future works will further investigate this topic by analyzing poly-generation systems with a greater number of technologies and different loads, e.g. as a fuel for clean mobility.</p>
        <p>renewable P2P system are listed in Tables C1-C4 in Appendix C. They are mainly based on data reported in</p>
        <p>This project has received funding from the Fuel Cells and Hydrogen 2 Joint Undertaking under grant agreement No 779541. This Joint Undertaking receives support from the European Union's Horizon 2020 research and innovation program, Hydrogen Europe and Hydrogen Europe research.</p>
        <p>The authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper.</p>
        <p>A piecewise affine (PWA) approximation was implemented to describe the EL and FC performance curve by means of n line segments. The position of the related n + 1 breakpoints {(x 1 , y 1 ), … (x n+1 , y n+1 )}, was obtained through an optimization procedure. The optimization procedure was carried out considering specific cell inlet/outlet power values (p in/out ), i.e., normalized to the number of cells composing the stack and to the cell area. The outlet power of the electrolyzer corresponds to the generated hydrogen power (on an LHV basis), whereas it represents the net generated electrical power for the fuel cell.</p>
        <p>First, a discretized performance curve, composed of M points {(p in,model,1 , p out,model,1 ), … (p in,model,M , p out,model,M )}, was generated, starting from the detailed electrolyzer/fuel cell model. The optimal positions of the n + 1 breakpoints were then computed by minimizing the sum of the squares of the difference between the approximated and model values of the electrolyzer/fuel cell outlet power:</p>
        <p>where p out,approx,m and p out,model,m (in kW/cm 2 ) represent the approximated and model specific outlet power, respectively. The term p out,approx,m was derived from the following relationship:</p>
        <p>where the slope of the i-th line segment is:</p>
        <p>and p in,model,m lies within the following operating range:</p>
        <p>The following constraint was also added to the fitting problem:</p>
        <p>Unlike [39], the first and last breakpoints were imposed to coincide with the first and last points of the original curve, similarly to what performed by Gabrielli et al. [40]:</p>
        <p>x n+1 = p in,model,M (A8)</p>
        <p>The PWA approximation of the EL and FC performance curves was implemented in the MILP formulation by employing the following relationship for each i-th line segment of the performance curve (with j = EL, FC):</p>
        <p>where P j,out (t) and P j,in (t) correspond to the outlet and inlet power of the EL/FC device, respectively. The term α j,i is the slope of the i-th segment, whereas β j,i is its intercept. The α j,i term was computed in the following way:</p>
        <p>The intercept, β j,i , was instead derived as:</p>
        <p>)</p>
        <p>⋅P EL,rated (A12)</p>
        <p>where η j,k and z j,k represent the efficiency and the fraction of the rated inlet power (H 2 power for the FC and electrical power for the EL), respectively, for the k-th breakpoint of the performance curve. The n term stands for the number of line-segments of the curve. By grouping the various terms of Eqs. (A12) and (A13) in the c β j,i coefficient (except for the P j,rated term), Eq. (A10) can be rearranged as follows:</p>
        <p>where P j,rated,aux (t) is an auxiliary variable defined by Eq. ( 5). Constraints were also added to impose the lower and upper boundaries of the operating map:</p>
        <p>⋅P FC,rated,aux (t) (A16)</p>
        <p>Since the investment cost should be minimized and the cost function is concave, the introduction of a binary variable B i is required for each of the n line segments in order to identify the active one. A continuous variable was also added for each line segment of the cost curve.</p>
        <p>The rated power of the electrolyzer and fuel cell is given by (with j = EL, FC):</p>
        <p>where P j,rated,i represents the continuous variable associated with the i-th line segment, which needs to fulfil the following constraint:</p>
        <p>z j,i ⋅P j,rated,max ⋅B j,i ≤ P j,rated,i ≤ z j,i+1 ⋅P j,rated,max ⋅B j,i (A18)</p>
        <p>The following constraint should also be introduced to ensure that no more than one binary variable B j,i is equal to 1:</p>
        <p>which means that the electrolyzer/fuel cell is installed when the sum of all the B j,i variables is equal to 1.</p>
        <p>The electrolyzer/fuel cell investment cost for a certain rated power was then computed as follows:</p>
        <p>where α j,i and β j,i represent the slope and the intercept of the i-th segment, which are defined as follows:</p>
        <p>α j,i = c inv,j,i+1 ⋅z j,i+1c inv,j,i ⋅z j,i z j,i+1z j,i (A21)</p>
        <p>where c inv,j,k and z j,k represent the specific investment cost (in €/kW) and the fraction of the maximum rated power, respectively, when referring to the k-th breakpoint of the investment cost curve.</p>
        <p>The input data used in this work for the Ginostra site, namely the hourly profiles over the year of the solar irradiance on the PV plane (in kW/m 2 ), ambient temperature (in • C) and electrical demand (in kW), are shown in Fig. B1. Fig. B1. Input data (meteorological and load) for the MILP simulation of the Ginostra site: temperature, solar irradiance and electrical load [31].</p>
        <p>Tables C1-C4 report the main techno-economic input parameters of the components considered in the renewable P2P system (mainly taken from [31]).</p>
        <p>Techno-economic input data for the PV system.</p>
        <p>Investment cost 1,547 €/kW [8] (monocrystalline silicon)</p>
        <p>Project lifetime Fixed O&amp;M cost 24</p>
        <p>Techno-economic input data for the BSS.</p>
        <p>Investment cost (system) 550 €/kWh [8] Module cost,c BT,mod 275 €/kWh (50% of Inv. cost [52])</p>
        <p>Project lifetime Fixed O&amp;M cost 10 €/kWh/y [54] Charging efficiency, η BT,ch 0.95 [54] Discharging efficiency, η BT,dc 0.95 [54] Self-discharge,σBT 5%/month [32] Minimum SOC,SOCmin 0.2 [32] Maximum SOC,SOCmax 1</p>
        <p>Initial SOC,SOCin 0.5</p>
        <p>Other techno-economic data. On-off cycle number,Nstart,tot,FC 10,000 [60]</p>
    </text>
</tei>
