<?xml version="1.0" encoding="UTF-8"?>
<tei xmlns="http://www.tei-c.org/ns/1.0">
    <teiHeader>
        <fileDesc xml:id="_1"/>
        <encodingDesc>
            <appInfo>
                <application version="0.8.1-SNAPSHOT" ident="GROBID" when="2024-06-14T07:03+0000">
                    <ref target="https://github.com/kermitt2/grobid">A machine learning software for extracting information from scholarly documents</ref>
                </application>
            </appInfo>
        </encodingDesc>
    </teiHeader>
    <text xml:lang="en">
        <p>Energy Peer-to-Peer Trading in Virtual Microgrids in Smart Grids: A Game-Theoretic Approach Kelvin Anoh, (Member IEEE), Sabita Maharjan, (Member IEEE), Augustine Ikpehai, (Member IEEE), Yan Zhang, (Senior Member IEEE), Bamidele Adebisi, (Senior Member IEEE)Energy Peer-to-Peer Trading in Virtual Microgrids in Smart Grids: A Game-Theoretic Approach Kelvin Anoh, (Member IEEE), Sabita Maharjan, (Member IEEE), Augustine Ikpehai, (Member IEEE), Yan Zhang, (Senior Member IEEE), Bamidele Adebisi, (Senior Member IEEE)</p>
        <p>Abstract-Traditionally, energy consumers pay non-commodity charges (e.g. transmission, environmental and network costs) as a major component of their energy bills. With the distributed energy generation, enabling energy consumption close to producers can minimize such costs. The physically constrained energy prosumers in power networks can be logically grouped into virtual microgrids (VMGs) using communication systems. Prosumer benefits can be optimised by modelling the energy trading interactions among producers and consumers in a VMG as a Stackelberg game in which producers lead and consumers follow. Considering renewable (RES) and non-renewable energy (nRES) resources, and given that RES are unpredictable thus unschedulable, we also describe cost and utility models that include load uncertainty demands of producers. The results show that under Stackelberg equilibrium (SE), the costs incurred by a consumer for procuring either the RES or nRES are significantly reduced while the derived utility by producer is maximized. We further show that when the number of prosumers in the VMG increases, the CO2 emission cost and consequently the energy cost are minimized at the SE. Lastly, we evaluate the peer-to-peer (P2P) energy trading scenario involving noncooperative energy prosumers with and without Stackelberg game. The results show that the P2P energy prosumers attain 47% higher benefits with Stackelberg game. Index Terms-CO2 emission, communication, energy trading, non-cooperative game, non-renewable energy, peer-to-peer, Stackelberg game, virtual microgrid. energy consumed by prosumer i E (g) i energy generated by producer i E min i energy consumed by i's non-flexible load e ii energy generated and consumed locally by i E ij energy sold by prosumer i to j E ji energy sold by prosumer j to i f (x) function of x k ij willingness of i to sell to j N Total number of prosumers n i set of indices of customers of producer i P (b) ji energy price paid by prosumer j to i P (v) t,ji energy transmission price paid by prosumer j to i P g grid price P s i selling price of prosumer i P v t,i i's excess energy transmission price by i P g,i price of energy generated by prosumer i P t,i price of generated energy transferred by prosumer i q i total energy generated and bought U i total utility of prosumer i subscript ij denotes the flow of commodity from i to j subscript ji denotes the flow of price (cost) paid by j to iAbstract-Traditionally, energy consumers pay non-commodity charges (e.g. transmission, environmental and network costs) as a major component of their energy bills. With the distributed energy generation, enabling energy consumption close to producers can minimize such costs. The physically constrained energy prosumers in power networks can be logically grouped into virtual microgrids (VMGs) using communication systems. Prosumer benefits can be optimised by modelling the energy trading interactions among producers and consumers in a VMG as a Stackelberg game in which producers lead and consumers follow. Considering renewable (RES) and non-renewable energy (nRES) resources, and given that RES are unpredictable thus unschedulable, we also describe cost and utility models that include load uncertainty demands of producers. The results show that under Stackelberg equilibrium (SE), the costs incurred by a consumer for procuring either the RES or nRES are significantly reduced while the derived utility by producer is maximized. We further show that when the number of prosumers in the VMG increases, the CO2 emission cost and consequently the energy cost are minimized at the SE. Lastly, we evaluate the peer-to-peer (P2P) energy trading scenario involving noncooperative energy prosumers with and without Stackelberg game. The results show that the P2P energy prosumers attain 47% higher benefits with Stackelberg game. Index Terms-CO2 emission, communication, energy trading, non-cooperative game, non-renewable energy, peer-to-peer, Stackelberg game, virtual microgrid. energy consumed by prosumer i E (g) i energy generated by producer i E min i energy consumed by i's non-flexible load e ii energy generated and consumed locally by i E ij energy sold by prosumer i to j E ji energy sold by prosumer j to i f (x) function of x k ij willingness of i to sell to j N Total number of prosumers n i set of indices of customers of producer i P (b) ji energy price paid by prosumer j to i P (v) t,ji energy transmission price paid by prosumer j to i P g grid price P s i selling price of prosumer i P v t,i i's excess energy transmission price by i P g,i price of energy generated by prosumer i P t,i price of generated energy transferred by prosumer i q i total energy generated and bought U i total utility of prosumer i subscript ij denotes the flow of commodity from i to j subscript ji denotes the flow of price (cost) paid by j to i</p>
        <p>In the UK, non-commodity charges account for 55-65% of energy bills [1] and network charges alone account for about 25% of that figure [2]. Peer-to-peer (P2P) energy trading offers a unique approach to produce and sell energy at the edge of the network and can help in reducing such charges. When these prosumers are coordinated using communication systems [3], [4], significant power network values could be achieved including reduced pollution and, increased energy network efficiency and security [5].In the UK, non-commodity charges account for 55-65% of energy bills [1] and network charges alone account for about 25% of that figure [2]. Peer-to-peer (P2P) energy trading offers a unique approach to produce and sell energy at the edge of the network and can help in reducing such charges. When these prosumers are coordinated using communication systems [3], [4], significant power network values could be achieved including reduced pollution and, increased energy network efficiency and security [5].</p>
        <p>Reliable communication systems play vital roles in smart grids [3], [6]. For example, communication infrastructure can be leveraged to regroup prosumers into logical clusters called virtual microgrids (VMGs) in order to improve performance and aid network management cost reduction [3], [4], [7]. When realised, optimal grouping can improve efficiency of the energy network by allowing the prosumers to trade locally, thereby reducing the non-commodity charges.Reliable communication systems play vital roles in smart grids [3], [6]. For example, communication infrastructure can be leveraged to regroup prosumers into logical clusters called virtual microgrids (VMGs) in order to improve performance and aid network management cost reduction [3], [4], [7]. When realised, optimal grouping can improve efficiency of the energy network by allowing the prosumers to trade locally, thereby reducing the non-commodity charges.</p>
        <p>The interactions of uncoordinated P2P energy prosumers in a large area can be both varied and complicated. Thus, optimal trading strategies, such as game theory, are needed to optimize resources and costs to enhance prosumer benefits [6], [8], [9]. In this study, we explore the art of optimising energy trading cost using game theory in VMGs. The main contributions are:The interactions of uncoordinated P2P energy prosumers in a large area can be both varied and complicated. Thus, optimal trading strategies, such as game theory, are needed to optimize resources and costs to enhance prosumer benefits [6], [8], [9]. In this study, we explore the art of optimising energy trading cost using game theory in VMGs. The main contributions are:</p>
        <p>• a clustering scheme for heterogeneous prosumers seeking to trade energy within their locality. The model not only supports existing communication systems but also fits well with emerging 5G and edge computing technologies. • a game theoretical framework to model the interactions between producers and consumers in a VMG for prosumers equipped with renewable energy resources. We also formulate a Stackelberg game with producers as leaders and consumers as followers, and optimize both the cost for consumers and the utility for producers. We prove that a unique Stackelberg equilibrium (SE) exists. • given that power generation from renewable energy resources (RES) are not predictable and thus unschedulable, we formulate the energy trading cost and utility models in terms of load demand uncertainty for VMG energy trading system equipped with RES only and that are also grid-connected. • Lastly, we solve the social welfare problem under P2P energy trading scenario for non-cooperative energy prosumers. The result shows reduced energy trading costs for the consumer and enhanced utility for the producer compared to the SE with the added advantage of reduced emission for increasing number of prosumers.• a clustering scheme for heterogeneous prosumers seeking to trade energy within their locality. The model not only supports existing communication systems but also fits well with emerging 5G and edge computing technologies. • a game theoretical framework to model the interactions between producers and consumers in a VMG for prosumers equipped with renewable energy resources. We also formulate a Stackelberg game with producers as leaders and consumers as followers, and optimize both the cost for consumers and the utility for producers. We prove that a unique Stackelberg equilibrium (SE) exists. • given that power generation from renewable energy resources (RES) are not predictable and thus unschedulable, we formulate the energy trading cost and utility models in terms of load demand uncertainty for VMG energy trading system equipped with RES only and that are also grid-connected. • Lastly, we solve the social welfare problem under P2P energy trading scenario for non-cooperative energy prosumers. The result shows reduced energy trading costs for the consumer and enhanced utility for the producer compared to the SE with the added advantage of reduced emission for increasing number of prosumers.</p>
        <p>The remaining part of this paper is organized as follows:The remaining part of this paper is organized as follows:</p>
        <p>In Section II, we provide literature review and describe the system model in Section III. We formulate the problem in Section IV. In Section V, we evaluate the social benefits of non-cooperative energy trading while we present our main results in Section VI. Section VII concludes the paper.In Section II, we provide literature review and describe the system model in Section III. We formulate the problem in Section IV. In Section V, we evaluate the social benefits of non-cooperative energy trading while we present our main results in Section VI. Section VII concludes the paper.</p>
        <p>P2P energy trading scheme has recently gained traction with diverse motivations [3], [4], [6], [7], [10]- [14]. The motivations include modelling the psychological behaviour of the traders, the problems of feed-in tariff (FiT), the imposition of energy dispatch limits on distributed energy generators (DEG) by some local governments [13], [15] and incentives [16], [17]. These plethora of research literature that use P2P algorithm in the energy sector can be generally grouped into three areas [13], [18]; electric vehicles [19], microgrid [3], [20] and distribution network [21]. This study focuses on the microgrid area. It uses the evolving IoT and edge computing technologies [22], [23] to form VMGs to manage DEGs.P2P energy trading scheme has recently gained traction with diverse motivations [3], [4], [6], [7], [10]- [14]. The motivations include modelling the psychological behaviour of the traders, the problems of feed-in tariff (FiT), the imposition of energy dispatch limits on distributed energy generators (DEG) by some local governments [13], [15] and incentives [16], [17]. These plethora of research literature that use P2P algorithm in the energy sector can be generally grouped into three areas [13], [18]; electric vehicles [19], microgrid [3], [20] and distribution network [21]. This study focuses on the microgrid area. It uses the evolving IoT and edge computing technologies [22], [23] to form VMGs to manage DEGs.</p>
        <p>The idea is inspired by the microgeneration of energy at the edge of the distribution network [24], as renewable energy generation is now prevalent in residential and commercial buildings, and the pervasive nature of wireless communication technologies. Without altering the physical topology of power network, VMG scheme allows logical grouping of prosumers using communication systems as the key enabler [3], [4] as shown in Fig. 1. Coordinating prosumers locally in VMGs could provide significant advantages to power systems, such as increasing network efficiency and security, reducing pollution and alleviating the burden of investing in upstream energy generation and transmission [5]. In terms of communication networks, the costs of traversing a wide (or metropolitan) area network to complete energy transactions is overcome.The idea is inspired by the microgeneration of energy at the edge of the distribution network [24], as renewable energy generation is now prevalent in residential and commercial buildings, and the pervasive nature of wireless communication technologies. Without altering the physical topology of power network, VMG scheme allows logical grouping of prosumers using communication systems as the key enabler [3], [4] as shown in Fig. 1. Coordinating prosumers locally in VMGs could provide significant advantages to power systems, such as increasing network efficiency and security, reducing pollution and alleviating the burden of investing in upstream energy generation and transmission [5]. In terms of communication networks, the costs of traversing a wide (or metropolitan) area network to complete energy transactions is overcome.</p>
        <p>We approach the study of interactions among the prosumers as a noncooperative game. In the game, players make decisions independently [25] with the leader (e.g. seller) making the first move. The players in VMGs are managed using communication systems. Unlike [26] that considered the interactions between microgrid operators (or aggregators [27]) and prosumers of a homogeneous energy trading system as a noncooperative game, we consider the case heterogeneous energy prosumers since they cannot be practicably isolated.We approach the study of interactions among the prosumers as a noncooperative game. In the game, players make decisions independently [25] with the leader (e.g. seller) making the first move. The players in VMGs are managed using communication systems. Unlike [26] that considered the interactions between microgrid operators (or aggregators [27]) and prosumers of a homogeneous energy trading system as a noncooperative game, we consider the case heterogeneous energy prosumers since they cannot be practicably isolated.</p>
        <p>Noncooperative game theoretic approaches including the Nash game, Stackelberg game and others to study energy trading is widely reported [9], [15], [25]- [30]. Some of these studies involve where the utility companies attempt to maximize their revenue while the consumers are interested in maximizing their own pay-offs [28]. Nash game has also been applied to study energy trading in DSM, where there is one utility company and multiple consumers [9]. In [30], the authors derived a Nash equilibrium (NE) to maximize utility for geographically distributed energy storage units and unfairness between high and low capacity consumers at NE [27]. Apart from Nash game, Stackelberg game has been used to maximize seller utility and to minimize user costs [29]. NE is a specific solution for noncooperative games where each player in the game can not get a higher payoff by deviating unilaterally. Noncooperative game equilibrium is a more general concept that includes NE but extends to include other equilibrium concepts as well such as SE.Noncooperative game theoretic approaches including the Nash game, Stackelberg game and others to study energy trading is widely reported [9], [15], [25]- [30]. Some of these studies involve where the utility companies attempt to maximize their revenue while the consumers are interested in maximizing their own pay-offs [28]. Nash game has also been applied to study energy trading in DSM, where there is one utility company and multiple consumers [9]. In [30], the authors derived a Nash equilibrium (NE) to maximize utility for geographically distributed energy storage units and unfairness between high and low capacity consumers at NE [27]. Apart from Nash game, Stackelberg game has been used to maximize seller utility and to minimize user costs [29]. NE is a specific solution for noncooperative games where each player in the game can not get a higher payoff by deviating unilaterally. Noncooperative game equilibrium is a more general concept that includes NE but extends to include other equilibrium concepts as well such as SE.</p>
        <p>The authors in [20] studied P2P energy trading to balance local generation and demand for grid-connected renewable energy generators. In [31], Stackelberg game was applied to optimize energy trading among multiple prosumers and multiple consumers. The study in [3] examined distributed energy trading involving multiple prosumers and multiple generators for multiple VMGs. These consumers may range from local energy generators from renewable sources such as wind, solar or geothermal, to residential units, commercial units, industry and cooperative sellers. Each VMG could involve a VPP for prosumers with storage facilities.The authors in [20] studied P2P energy trading to balance local generation and demand for grid-connected renewable energy generators. In [31], Stackelberg game was applied to optimize energy trading among multiple prosumers and multiple consumers. The study in [3] examined distributed energy trading involving multiple prosumers and multiple generators for multiple VMGs. These consumers may range from local energy generators from renewable sources such as wind, solar or geothermal, to residential units, commercial units, industry and cooperative sellers. Each VMG could involve a VPP for prosumers with storage facilities.</p>
        <p>Consider reducing the cost incurred by the energy consumer and maximizing utility for the producer. A prosumer can act as an energy generator or consumer at different trading intervals. Since there are multiple producers and consumers involved, attaining optimal pricing as well as utility for the consumers and producers respectively, can be complicated. We introduce a game theory-based approach to optimize energy trading costs in a single VMG. This important area has not been reported in other studies investigating VMG such as [3], [4], [32], [33].Consider reducing the cost incurred by the energy consumer and maximizing utility for the producer. A prosumer can act as an energy generator or consumer at different trading intervals. Since there are multiple producers and consumers involved, attaining optimal pricing as well as utility for the consumers and producers respectively, can be complicated. We introduce a game theory-based approach to optimize energy trading costs in a single VMG. This important area has not been reported in other studies investigating VMG such as [3], [4], [32], [33].</p>
        <p>Communication systems play a crucial role informing VMG as shown in Fig. 1. The computational agents can reside in local edge computing systems or in a cloud [22], [23]. Assuming a wireless communication systems, the radio access network (RAN) is equipped with eNode-B (eNB) and MEC facilities; e.g. the emerging 5G standard [34], [35]. The RAN is connected to the network cloud and enables prosumers to identify local energy trading neighbours in its VMG. In this case, the prosumers connect to the MEC via the eNB in a machine-type communication (MTC) fashion. The software configured on the MEC which achieves the transactional service together with the external communication hardware will be referred to as energy trading agent (ETA).Communication systems play a crucial role informing VMG as shown in Fig. 1. The computational agents can reside in local edge computing systems or in a cloud [22], [23]. Assuming a wireless communication systems, the radio access network (RAN) is equipped with eNode-B (eNB) and MEC facilities; e.g. the emerging 5G standard [34], [35]. The RAN is connected to the network cloud and enables prosumers to identify local energy trading neighbours in its VMG. In this case, the prosumers connect to the MEC via the eNB in a machine-type communication (MTC) fashion. The software configured on the MEC which achieves the transactional service together with the external communication hardware will be referred to as energy trading agent (ETA).</p>
        <p>In terms of communication network, VMG relieves data transfer over the core network and encourages information processing within the edge communication infrastructure using the evolving MEC. In terms of power network, it encourages local energy trading as prosumers can find buyers and sellers within its neighbourhood. In terms of the environment, energy loss due to long distance transmission will be reduced and thus CO 2 emission will be cut down.In terms of communication network, VMG relieves data transfer over the core network and encourages information processing within the edge communication infrastructure using the evolving MEC. In terms of power network, it encourages local energy trading as prosumers can find buyers and sellers within its neighbourhood. In terms of the environment, energy loss due to long distance transmission will be reduced and thus CO 2 emission will be cut down.</p>
        <p>In this study, the ETA coordinates the transaction messaging services between producers and consumers. Examples of communication infrastructure that may implement the ETA include NB-IoT, LoRaWAN, Wi-Fi, WIMAX, or LTE-MTC [36], [37]. The prosumers have finite energy generation capacity and also need to act as energy consumers at times. This phenomenon makes the peers interdependent. The energy prosumers are also equipped with communication (hardware) and application (software) with which they exchange energy trading messages with other prosumers over the ETA. The combined hardware and software infrastructure are referred to as energy trading client (ETC). We assume that the ETC is able to connect wirelessly to the ETA via the eNB. Except for the recent study [22] on the cost uncertainties due to communication systems in a single VMG, no other study has investigated the problem of optimising energy trading costs and utility for prosumers in a given VMG. This problem is addressed in this study, by first considering the energy trading interactions among prosumers as a game.In this study, the ETA coordinates the transaction messaging services between producers and consumers. Examples of communication infrastructure that may implement the ETA include NB-IoT, LoRaWAN, Wi-Fi, WIMAX, or LTE-MTC [36], [37]. The prosumers have finite energy generation capacity and also need to act as energy consumers at times. This phenomenon makes the peers interdependent. The energy prosumers are also equipped with communication (hardware) and application (software) with which they exchange energy trading messages with other prosumers over the ETA. The combined hardware and software infrastructure are referred to as energy trading client (ETC). We assume that the ETC is able to connect wirelessly to the ETA via the eNB. Except for the recent study [22] on the cost uncertainties due to communication systems in a single VMG, no other study has investigated the problem of optimising energy trading costs and utility for prosumers in a given VMG. This problem is addressed in this study, by first considering the energy trading interactions among prosumers as a game.</p>
        <p>Consider energy P2P trading in a single VMG as shown in the Fig. 1, wherein there are {A = {A i : ∀i ∈ N }} producers and {B = {B j : ∀j ∈ n i }} consumers; n i ⊆ N is a set of indices of consumers that buy energy from producer i, N = {1, 2, • • • , N } and N is the number of prosumers. Both A i and B j are physically connected in a power distribution network, and are also allowed to trade energy. The peer connectivity may be denoted using an energy trading graph G = (P, E) with set of edges E ⊂ P × P and P = {P 1 , • • • , P N } is a set of peers. Prosumers can act (and are referred to) as consumers when they need to buy energy. In the model, A i sets up its own energy price and the consumer has the liberty to choose who to purchase energy from. Typically, the energy price defined by A i is cheaper than the grid-price at the prevailing transaction interval. Thus, the price set by A i depends on the prices set by other A i 's and the grid. This type of coupling between prosumers' trading strategies necessitates the use of game theory to model the interaction between the producers and consumers. Specifically, we adopt a multi-leader multi-follower Stackelberg game.Consider energy P2P trading in a single VMG as shown in the Fig. 1, wherein there are {A = {A i : ∀i ∈ N }} producers and {B = {B j : ∀j ∈ n i }} consumers; n i ⊆ N is a set of indices of consumers that buy energy from producer i, N = {1, 2, • • • , N } and N is the number of prosumers. Both A i and B j are physically connected in a power distribution network, and are also allowed to trade energy. The peer connectivity may be denoted using an energy trading graph G = (P, E) with set of edges E ⊂ P × P and P = {P 1 , • • • , P N } is a set of peers. Prosumers can act (and are referred to) as consumers when they need to buy energy. In the model, A i sets up its own energy price and the consumer has the liberty to choose who to purchase energy from. Typically, the energy price defined by A i is cheaper than the grid-price at the prevailing transaction interval. Thus, the price set by A i depends on the prices set by other A i 's and the grid. This type of coupling between prosumers' trading strategies necessitates the use of game theory to model the interaction between the producers and consumers. Specifically, we adopt a multi-leader multi-follower Stackelberg game.</p>
        <p>Given the prices set by {A i : ∀i ∈ N }, {B j : ∀j ∈ n i } chooses its own energy price {PGiven the prices set by {A i : ∀i ∈ N }, {B j : ∀j ∈ n i } chooses its own energy price {P</p>
        <p>ji is the price which the consumer can afford to buy from producer i and P s i is the selling price of the producer. Also, we note that {P (b) ji ∈ (P s i P g ) : ∀i ∈ N , j ∈ n i } which implies that the price paid by consumer j is drawn from either P s i or P g , where P g is the price set by the grid. Based on P (b) ji set by B j , A i unveils the quantity of energy (E (g) i -e ii ) that it is willing to sell after satisfying its non-flexible loadji is the price which the consumer can afford to buy from producer i and P s i is the selling price of the producer. Also, we note that {P (b) ji ∈ (P s i P g ) : ∀i ∈ N , j ∈ n i } which implies that the price paid by consumer j is drawn from either P s i or P g , where P g is the price set by the grid. Based on P (b) ji set by B j , A i unveils the quantity of energy (E (g) i -e ii ) that it is willing to sell after satisfying its non-flexible load</p>
        <p>is the amount of energy generated by producer i and {e ii : ∀i ∈ N } is the amount of energy that the producer chooses to consume. The energy and price flows are illustrated in Fig. 2. It shows that when the producer and consumer agree to trade, the energy (E (b) ij ) is sent from producer i to consumer j and the money (P (b) ji ) flows from consumer j to producer i. The Stackelberg game is characterised by i) sequential actions in which the leader makes the first move, followed by optimal reaction from the followers ii) information asymmetry such that the amount of energy on offer is not revealed until the price is mutually agreed. In our model the producer is the leader and the consumer is the follower; these positions can be taken by any prosumer depending on its circumstance at a given trading period. We consider a game where P2P energy prosumers compete to satisfy their own goal. In this scenario, the producer evaluates its non-flexible load requirement and estimates any excess amount of energy for trading depending on the pricing information that it receives from the consumer. The consumer then considers the grid price to determine its own bid for the excess energy from other prosumers within the ETA service area.is the amount of energy generated by producer i and {e ii : ∀i ∈ N } is the amount of energy that the producer chooses to consume. The energy and price flows are illustrated in Fig. 2. It shows that when the producer and consumer agree to trade, the energy (E (b) ij ) is sent from producer i to consumer j and the money (P (b) ji ) flows from consumer j to producer i. The Stackelberg game is characterised by i) sequential actions in which the leader makes the first move, followed by optimal reaction from the followers ii) information asymmetry such that the amount of energy on offer is not revealed until the price is mutually agreed. In our model the producer is the leader and the consumer is the follower; these positions can be taken by any prosumer depending on its circumstance at a given trading period. We consider a game where P2P energy prosumers compete to satisfy their own goal. In this scenario, the producer evaluates its non-flexible load requirement and estimates any excess amount of energy for trading depending on the pricing information that it receives from the consumer. The consumer then considers the grid price to determine its own bid for the excess energy from other prosumers within the ETA service area.</p>
        <p>Denote n i := {j : (P i , P j ) ∈ E} to be all the set of peers that can sell energy to P i (i.e. ingoing-neighbours) and n - i := {j : (P i , P j ) ∈ E} to be the set of all peers that can buy energy from P i (i.e. outgoing-neighbours). The energy trading model described in [3] involves outgoing energy E ij ≥ 0 to prosumer i and incoming energy E ji ≥ 0 to prosumer i. Let the energy consumed by i be EDenote n i := {j : (P i , P j ) ∈ E} to be all the set of peers that can sell energy to P i (i.e. ingoing-neighbours) and n - i := {j : (P i , P j ) ∈ E} to be the set of all peers that can buy energy from P i (i.e. outgoing-neighbours). The energy trading model described in [3] involves outgoing energy E ij ≥ 0 to prosumer i and incoming energy E ji ≥ 0 to prosumer i. Let the energy consumed by i be E</p>
        <p>where n i ⊆ N is the set of neighbours of prosumer i.where n i ⊆ N is the set of neighbours of prosumer i.</p>
        <p>The expression in (1) denotes the well-known energy balance model which indicates that the total energy generated must be equivalent to the total energy consumed. In terms of energy generated, we can rewrite (1) asThe expression in (1) denotes the well-known energy balance model which indicates that the total energy generated must be equivalent to the total energy consumed. In terms of energy generated, we can rewrite (1) as</p>
        <p>By letting the price of every unit of energy (kWh) generated by prosumer i be linear multiple of the quantity, thenBy letting the price of every unit of energy (kWh) generated by prosumer i be linear multiple of the quantity, then</p>
        <p>where P g,i represents the price of energy generated and P t,i represents the price of energy transferred by prosumer i.where P g,i represents the price of energy generated and P t,i represents the price of energy transferred by prosumer i.</p>
        <p>Note that if a given quantity of energy is generated locally and consumed locally, then P t,i = 0. The model in (3) represents the cost of energy locally generated and that bought externally from another prosumer. Our interest is in a single VMG and since each prosumer is selfish and concerned with optimizing own energy production cost, the optimal energy cost of generating E (g) i units of energy can be expressed asNote that if a given quantity of energy is generated locally and consumed locally, then P t,i = 0. The model in (3) represents the cost of energy locally generated and that bought externally from another prosumer. Our interest is in a single VMG and since each prosumer is selfish and concerned with optimizing own energy production cost, the optimal energy cost of generating E (g) i units of energy can be expressed as</p>
        <p>If prosumer i always buys energy, then one of the ways of minimizing its generation cost is by minimizing the energy trading cost, e.g. by generating, trading locally or choosing cheapest seller. Given a microgrid with many prosumers to buy the energy from, the consumer can achieve its goal of minimizing the cost for E ij units of energy by choosing the cheapest price offer among the n i ⊆ N prosumers present in the trading area. On the other hand, prosumer j is interested in maximizing the utility it derives from consuming only e ii . The interdependence of consumer and producer coupled with the complex exchange of trading information (i.e. quantity and price) can be modelled as a Stackelberg game. In the game, the consumer pursues minimizing energy trading cost while the producer (seller) seeks to maximize the benefit it derives from consuming e ii only out of E (g) i that it produces.If prosumer i always buys energy, then one of the ways of minimizing its generation cost is by minimizing the energy trading cost, e.g. by generating, trading locally or choosing cheapest seller. Given a microgrid with many prosumers to buy the energy from, the consumer can achieve its goal of minimizing the cost for E ij units of energy by choosing the cheapest price offer among the n i ⊆ N prosumers present in the trading area. On the other hand, prosumer j is interested in maximizing the utility it derives from consuming only e ii . The interdependence of consumer and producer coupled with the complex exchange of trading information (i.e. quantity and price) can be modelled as a Stackelberg game. In the game, the consumer pursues minimizing energy trading cost while the producer (seller) seeks to maximize the benefit it derives from consuming e ii only out of E (g) i that it produces.</p>
        <p>In this section, we formulate energy trading cost models for prosumers equipped with renewable (RES) and non-renewable energy resources (nRES).In this section, we formulate energy trading cost models for prosumers equipped with renewable (RES) and non-renewable energy resources (nRES).</p>
        <p>There are three components of total energy cost model [3]. These include the cost of energy generated and consumed locally and the cost of all the energy bought from other prosumers, which can be represented asThere are three components of total energy cost model [3]. These include the cost of energy generated and consumed locally and the cost of all the energy bought from other prosumers, which can be represented as</p>
        <p>is the quantity of energy that prosumer j buys from other prosumers i. Lastly,is the quantity of energy that prosumer j buys from other prosumers i. Lastly,</p>
        <p>t,ji is the energy transmission cost, where P (v) t,ji is the energy transmission price paid by consumer j to producer i per kWh for E (b) ij units of energy bought over a unit distance. In addition to these, we account for the emission cost I ji (q ij ), ∀i ∈ N , j ∈ n i . Hence, by combiningt,ji is the energy transmission cost, where P (v) t,ji is the energy transmission price paid by consumer j to producer i per kWh for E (b) ij units of energy bought over a unit distance. In addition to these, we account for the emission cost I ji (q ij ), ∀i ∈ N , j ∈ n i . Hence, by combining</p>
        <p>t,ji , the total cost can be expressed ast,ji , the total cost can be expressed as</p>
        <p>We make clear distinction on the energy sources to facilitate the carbon target being pursued around the globe. We define the emission cost as [38]We make clear distinction on the energy sources to facilitate the carbon target being pursued around the globe. We define the emission cost as [38]</p>
        <p>where α ji and β ji are emission penalty variables and q ij is the total amount of energy generated and bought. Note that as energy flows from prosumer i to j and cost (price i.e. money) from prosumer j to i, we have denoted the variables as q ij and α ij , respectively. In that case, substituting ( 6) into (5) the total energy cost for the consumer takes the formwhere α ji and β ji are emission penalty variables and q ij is the total amount of energy generated and bought. Note that as energy flows from prosumer i to j and cost (price i.e. money) from prosumer j to i, we have denoted the variables as q ij and α ij , respectively. In that case, substituting ( 6) into (5) the total energy cost for the consumer takes the form</p>
        <p>For RES producer, α ji = 0, β ji = 0, thus I ji (q ij ) = 0. If the producer generates energy from nRES, then both α ji &gt; 0 and β ji &gt; 0. Sample realistic energy cost models follow two-step conservation rate or quadratic cost function [39].For RES producer, α ji = 0, β ji = 0, thus I ji (q ij ) = 0. If the producer generates energy from nRES, then both α ji &gt; 0 and β ji &gt; 0. Sample realistic energy cost models follow two-step conservation rate or quadratic cost function [39].</p>
        <p>At each trading period, the consumer minimizes the energy trading cost for buying E (b) ij units of energy over a unit distance at a transmission price P t while the producer pursues to maximize utility it derives from selling E (b) ij units of energy. Note that since the renewable energy source is unpredictable, the renewable energy generators are unscheduleable.At each trading period, the consumer minimizes the energy trading cost for buying E (b) ij units of energy over a unit distance at a transmission price P t while the producer pursues to maximize utility it derives from selling E (b) ij units of energy. Note that since the renewable energy source is unpredictable, the renewable energy generators are unscheduleable.</p>
        <p>Suppose that the producer consumes {e ii : 0 ≤ e ii ≤ E (g) i } amount of energy, the total utility derived from consuming a certain quantity of energy is realized from combining the local utility of the prosumer and the revenue it generates after selling its excess energy, i.e. (E (g) i -e ii ). From (2), we can express the excess energy that can be sold by prosumer i asSuppose that the producer consumes {e ii : 0 ≤ e ii ≤ E (g) i } amount of energy, the total utility derived from consuming a certain quantity of energy is realized from combining the local utility of the prosumer and the revenue it generates after selling its excess energy, i.e. (E (g) i -e ii ). From (2), we can express the excess energy that can be sold by prosumer i as</p>
        <p>When (EWhen (E</p>
        <p>, the prosumer has extra energy and may be interested to sell. When (E, the prosumer has extra energy and may be interested to sell. When (E</p>
        <p>, the prosumer may require to procure additional amount of energy. These two conditions may attract the prosumers to engage in an energy P2P trading., the prosumer may require to procure additional amount of energy. These two conditions may attract the prosumers to engage in an energy P2P trading.</p>
        <p>The total utility of a prosumer for consuming only e ii units of energy out of what it generates can be expressed asThe total utility of a prosumer for consuming only e ii units of energy out of what it generates can be expressed as</p>
        <p>where k ij is the willingness [40] of prosumer i to sell to prosumer j and γ i is a constant. We have adopted the ln(•)-based utility model because it leads to proportional fair demand response, and is well accepted and widely used model [28], [29], [41]. With γ i &gt; 0, the log(•)-based utility part in (9) does not tend to -∞ when e ii = 0; an example of γ i = 1.where k ij is the willingness [40] of prosumer i to sell to prosumer j and γ i is a constant. We have adopted the ln(•)-based utility model because it leads to proportional fair demand response, and is well accepted and widely used model [28], [29], [41]. With γ i &gt; 0, the log(•)-based utility part in (9) does not tend to -∞ when e ii = 0; an example of γ i = 1.</p>
        <p>The model in (10) can be explained as having two variables; the first variable k ij ln(γ i + e ii ) represents the local utility derived by the prosumer for consuming e ii units ofThe model in (10) can be explained as having two variables; the first variable k ij ln(γ i + e ii ) represents the local utility derived by the prosumer for consuming e ii units of</p>
        <p>is the revenue it receives for selling the excess energy it generates after satisfying its local load requirements. From (10), it is easy to show that producers with higher willingness to sell (E (g) i -e ii ) tend to achieve higher utility than prosumers with lower willingness.is the revenue it receives for selling the excess energy it generates after satisfying its local load requirements. From (10), it is easy to show that producers with higher willingness to sell (E (g) i -e ii ) tend to achieve higher utility than prosumers with lower willingness.</p>
        <p>Supposing a strictly RES trading system and considering that RES is unschedulable, we can as well discuss both (7) and (10) with respect to load uncertainty demand quantity, ii . In that case, we rewrite (7) as followsSupposing a strictly RES trading system and considering that RES is unschedulable, we can as well discuss both (7) and (10) with respect to load uncertainty demand quantity, ii . In that case, we rewrite (7) as follows</p>
        <p>wherewhere</p>
        <p>i -êii ) and êii = (e ii + ii ). Also, in terms of the load uncertainty the cost in (7) can be rewritten asi -êii ) and êii = (e ii + ii ). Also, in terms of the load uncertainty the cost in (7) can be rewritten as</p>
        <p>Since ( 11) and ( 12) appeal to RES only, we shall continue our discussion with the more general models, i.e. ( 7) and (10).Since ( 11) and ( 12) appeal to RES only, we shall continue our discussion with the more general models, i.e. ( 7) and (10).</p>
        <p>Notice that the uncertainty of producer's loads and that RES is unschedulable will affect the energy balance, in particularly, the amount of energy consumed by the prosumer, namely e ii in (8) by ii units of energy.Notice that the uncertainty of producer's loads and that RES is unschedulable will affect the energy balance, in particularly, the amount of energy consumed by the prosumer, namely e ii in (8) by ii units of energy.</p>
        <p>In this study, producers are prosumer with surplus energy to sell and knows the grid price. Consumers have need to buy energy to satisfy their minimum load requirement and are interested in minimizing the cost of such energy "production". In a Stackelberg game, leaders act first; in this study producers (or leaders) announce the availability of, and willingness to sell, their surplus energy. Consumers, as followers, follow this announcement by announcing the price they are able to pay. In Stackelberg game, while both the leader and the follower pursue their own interests, the leader of the game reacts to the behaviour of the follower to advertise own quantity of excess energy that it is willing to sell. The leader and follower are interested in optimizing their benefits and costs respectively. Thus, let us start with the leader's side.In this study, producers are prosumer with surplus energy to sell and knows the grid price. Consumers have need to buy energy to satisfy their minimum load requirement and are interested in minimizing the cost of such energy "production". In a Stackelberg game, leaders act first; in this study producers (or leaders) announce the availability of, and willingness to sell, their surplus energy. Consumers, as followers, follow this announcement by announcing the price they are able to pay. In Stackelberg game, while both the leader and the follower pursue their own interests, the leader of the game reacts to the behaviour of the follower to advertise own quantity of excess energy that it is willing to sell. The leader and follower are interested in optimizing their benefits and costs respectively. Thus, let us start with the leader's side.</p>
        <p>The producer is interested in maximizing the utility it derives from consuming only e ii units of energy out of E (g) i units it generates. That is, (9) takes the form where U i is the optimal utility derived by prosumer i for consuming e ii units of energy it generates and also selling the remaining quantity i.e. (E (g) i -e ii ). In that case, we estimate the first order optimal quantity of energy it can sell to the consumer by taking the first derivative of (10) and find that (see Appendix A)The producer is interested in maximizing the utility it derives from consuming only e ii units of energy out of E (g) i units it generates. That is, (9) takes the form where U i is the optimal utility derived by prosumer i for consuming e ii units of energy it generates and also selling the remaining quantity i.e. (E (g) i -e ii ). In that case, we estimate the first order optimal quantity of energy it can sell to the consumer by taking the first derivative of (10) and find that (see Appendix A)</p>
        <p>ji in (35), so that k ij /P (b)ji in (35), so that k ij /P (b)</p>
        <p>ji &gt;&gt; 1. This ensures that the energy consumed must satisfy e ii ∈ R + .ji &gt;&gt; 1. This ensures that the energy consumed must satisfy e ii ∈ R + .</p>
        <p>Having received the amount of excess energy that the producer is willing to sell to the consumer, the consumer computes and gives the best price it can pay. To estimate the optimal price the consumer can pay, it has to solve the problemHaving received the amount of excess energy that the producer is willing to sell to the consumer, the consumer computes and gives the best price it can pay. To estimate the optimal price the consumer can pay, it has to solve the problem</p>
        <p>Note that the energy consumption of each prosumer is decoupled; i.e. it does not depend on how much the other peers consume. This implies that the trading optimization problem can be decomposed into n i sub-problems and solved independently. The price realized from solving (15) becomes the best price the consumer is willing to pay for the excess amount of energy (ENote that the energy consumption of each prosumer is decoupled; i.e. it does not depend on how much the other peers consume. This implies that the trading optimization problem can be decomposed into n i sub-problems and solved independently. The price realized from solving (15) becomes the best price the consumer is willing to pay for the excess amount of energy (E</p>
        <p>-e ii ) from the producer. The consumer minimizes the cost of energy it buys by solving (15) as in (39) to obtain (see Appendix B)-e ii ) from the producer. The consumer minimizes the cost of energy it buys by solving (15) as in (39) to obtain (see Appendix B)</p>
        <p>In this case, P (b) † ji is the best response that the consumer can buy the excess energy (E (g) i -e ii ) from the producer. The optimal energy consumed by the producer will beIn this case, P (b) † ji is the best response that the consumer can buy the excess energy (E (g) i -e ii ) from the producer. The optimal energy consumed by the producer will be</p>
        <p>SE for P2P Energy Resources: Consider a game Γ played by N producers and n i consumers, by choosing (e † ii ,PSE for P2P Energy Resources: Consider a game Γ played by N producers and n i consumers, by choosing (e † ii ,P</p>
        <p>† ji ) strategies, which can be expressed as† ji ) strategies, which can be expressed as</p>
        <p>where {P (b) } ∈ {P (s) } ∪ P (g) is the set of energy prices that the consumer is able to pay and {e i } i∈N is the set of strategies of producer i with {e ii : 0 ≤ e ii ≤ E ji ), attains equilibrium if and only if the chosen strategies satisfy the following criteria:where {P (b) } ∈ {P (s) } ∪ P (g) is the set of energy prices that the consumer is able to pay and {e i } i∈N is the set of strategies of producer i with {e ii : 0 ≤ e ii ≤ E ji ), attains equilibrium if and only if the chosen strategies satisfy the following criteria:</p>
        <p>wherewhere</p>
        <p>ji and e † ii ∈ e ii . Once the game attains the equilibrium, no member of the game will be able to deviate P (b) ji,r = 20 P (b) ji,nr = 31 P (b) ji,r = 30 P (b) ji,nr = 41 P (b) ji,r = 40 P (b) ji,nr = 51 P (b) ji,r = 50 P (b) ji,nr = 61 ji ) because by doing so, the player cannot achieve additional gain. To verify the existence and uniqueness of the strategy chosen by a producer, we take the second derivative of ( 9) i.e.,ji and e † ii ∈ e ii . Once the game attains the equilibrium, no member of the game will be able to deviate P (b) ji,r = 20 P (b) ji,nr = 31 P (b) ji,r = 30 P (b) ji,nr = 41 P (b) ji,r = 40 P (b) ji,nr = 51 P (b) ji,r = 50 P (b) ji,nr = 61 ji ) because by doing so, the player cannot achieve additional gain. To verify the existence and uniqueness of the strategy chosen by a producer, we take the second derivative of ( 9) i.e.,</p>
        <p>which is strictly concave (i.e. ∂ 2 Ui ∂e 2 ii &lt; 0). It follows that for any price that the consumer chooses that satisfies P (b) ji &gt; 0, there exists a unique e ii chosen by the producer that satisfieswhich is strictly concave (i.e. ∂ 2 Ui ∂e 2 ii &lt; 0). It follows that for any price that the consumer chooses that satisfies P (b) ji &gt; 0, there exists a unique e ii chosen by the producer that satisfies</p>
        <p>Similarly by taking the second derivative of (15), for the cost paid by the consumer, it can be seen that (see Appendix C)Similarly by taking the second derivative of (15), for the cost paid by the consumer, it can be seen that (see Appendix C)</p>
        <p>Since α ji and β ji are usually small, for example α = 5×10 -2 and β = 0.1 [42], then the last two terms in (22) tend to zero so that the cost model is strictly convex (i.e.Since α ji and β ji are usually small, for example α = 5×10 -2 and β = 0.1 [42], then the last two terms in (22) tend to zero so that the cost model is strictly convex (i.e.</p>
        <p>follows that a unique (i.e. optimal) price exists to procure a unit of excess energy sold by the producer. Also there exist unique amounts of energy that each consumer will buy from each producer; thus constituting unique SE (e † ii , Pfollows that a unique (i.e. optimal) price exists to procure a unit of excess energy sold by the producer. Also there exist unique amounts of energy that each consumer will buy from each producer; thus constituting unique SE (e † ii , P</p>
        <p>Fig. 3 shows the impacts of varying energy prices on the utility of the producer at a given willingness, k = 810. For example, at low energy prices, the producers achieve low utility for trading with RES; this increases with increasing energy prices. This phenomenon is similarly true for nRES. However, we note that due to the emission costs charged for nRES, the producer achieves 20% utility higher for RES when compared to nRES. Notice also that as the local consumption of the energy produced increases, the utilities derived by the producer reduces for both RES and nRES. Considering the emission costs, we now demonstrate emission reduction when the producers and consumers play the game at SE. These results are compared in Fig. 4 taking into consideration the amount of energy bought, the willingness (k = 810) of a producer and the number of prosumers that exist in a trading area. In the simulation, we set α = 5 × 10 -2 and β = 0.1 as in [42]. We see that when the prosumers engage in playing the game, the emission cost is significantly reduced. Suppose that there exists a threshold of energy generation in the given VMG (i.e. all the prosumers can generate a total of E energy units), as expected, we also observe that as the number of the prosumers in the area increases, the emission cost reduces. This is because, there exists opportunities for increased local generation and consumption. In addition, if the consumer must buy energy from a local producer, the distance covered in the trade is significantly reduced thus affecting the emission cost.Fig. 3 shows the impacts of varying energy prices on the utility of the producer at a given willingness, k = 810. For example, at low energy prices, the producers achieve low utility for trading with RES; this increases with increasing energy prices. This phenomenon is similarly true for nRES. However, we note that due to the emission costs charged for nRES, the producer achieves 20% utility higher for RES when compared to nRES. Notice also that as the local consumption of the energy produced increases, the utilities derived by the producer reduces for both RES and nRES. Considering the emission costs, we now demonstrate emission reduction when the producers and consumers play the game at SE. These results are compared in Fig. 4 taking into consideration the amount of energy bought, the willingness (k = 810) of a producer and the number of prosumers that exist in a trading area. In the simulation, we set α = 5 × 10 -2 and β = 0.1 as in [42]. We see that when the prosumers engage in playing the game, the emission cost is significantly reduced. Suppose that there exists a threshold of energy generation in the given VMG (i.e. all the prosumers can generate a total of E energy units), as expected, we also observe that as the number of the prosumers in the area increases, the emission cost reduces. This is because, there exists opportunities for increased local generation and consumption. In addition, if the consumer must buy energy from a local producer, the distance covered in the trade is significantly reduced thus affecting the emission cost.</p>
        <p>V. SOCIAL WELFARE OF P2P PROSUMERS IN VMG Social welfare (SW) is usually studied for collaborative and non-collaborative prosumers aspiring to maximize benefits [27]. From the foregoing non-cooperative game discussion, we will further evaluate the energy trading cost and utility performances with respect to the SW. We shall start with analytical definition of SW considering the formulated utility and cost models. SW of non-cooperating prosumers has been studied using game theoretic [27] and blockchain [19], [43] tools. Here, we model the SW of these prosumers engaging in P2P energy trading within a single VMG as [44]V. SOCIAL WELFARE OF P2P PROSUMERS IN VMG Social welfare (SW) is usually studied for collaborative and non-collaborative prosumers aspiring to maximize benefits [27]. From the foregoing non-cooperative game discussion, we will further evaluate the energy trading cost and utility performances with respect to the SW. We shall start with analytical definition of SW considering the formulated utility and cost models. SW of non-cooperating prosumers has been studied using game theoretic [27] and blockchain [19], [43] tools. Here, we model the SW of these prosumers engaging in P2P energy trading within a single VMG as [44]</p>
        <p>For the given price, each prosumer attempts to adjust its power consumption to maximize its benefit. In that case, the SW of the prosumers participating in the game is The constraint is ascertained by the ETA as a precondition for the prosumer to participate. The Lagrangian of ( 24) can be expressed as followsFor the given price, each prosumer attempts to adjust its power consumption to maximize its benefit. In that case, the SW of the prosumers participating in the game is The constraint is ascertained by the ETA as a precondition for the prosumer to participate. The Lagrangian of ( 24) can be expressed as follows</p>
        <p>i , Ei , E</p>
        <p>--</p>
        <p>where λ i is the Lagrangian multiplier. The Lagrangian can be rewritten in terms of producer's and consumer's respective objectives. For example, we let the model ( 25) be written aswhere λ i is the Lagrangian multiplier. The Lagrangian can be rewritten in terms of producer's and consumer's respective objectives. For example, we let the model ( 25) be written as</p>
        <p>i , Ei , E</p>
        <p>ji . (26)ji . (26)</p>
        <p>The common approach to solve this type of problem is by decomposing (26) into a dual problem [41], [44]. Using the dual decomposition principle [41], we can express (26) asThe common approach to solve this type of problem is by decomposing (26) into a dual problem [41], [44]. Using the dual decomposition principle [41], we can express (26) as</p>
        <p>i , Ei , E</p>
        <p>As the producer and the consumer have different objectives, (26) can be decomposed into two sub-problems asAs the producer and the consumer have different objectives, (26) can be decomposed into two sub-problems as</p>
        <p>wherewhere</p>
        <p>If the prosumer charges the consumer at price P (b) ji = λ i (i.e. strong duality), it can be shown that the total energy procured by the consumers will be equivalent to the quantity of the excess energy sold by the producer. This is a dual decomposition problem that can be summarized asIf the prosumer charges the consumer at price P (b) ji = λ i (i.e. strong duality), it can be shown that the total energy procured by the consumers will be equivalent to the quantity of the excess energy sold by the producer. This is a dual decomposition problem that can be summarized as</p>
        <p>While producers solve (29), the consumer tries to minimize costs charged to it by solving (30). At the optimal condition, the prosumer charges the consumer λ i per kWh for the (EWhile producers solve (29), the consumer tries to minimize costs charged to it by solving (30). At the optimal condition, the prosumer charges the consumer λ i per kWh for the (E</p>
        <p>ie ii ) energy units it purchases.ie ii ) energy units it purchases.</p>
        <p>Although (24) is convex and can be solved centrally, e.g. by the ETA, a major setback is that the willingness parameter (k ij ) is private, thus the ETA may not have enough information to do so. Furthermore, solving the problem centrally would lead to computational inefficiency and latency, and therefore stale energy prices. Thus, given the distributed nature of the prosumers, one of the ways to solve the dual problem is by gradient projection method [44] in a distributed fashion. Let a function f (x) : R n → R, the subgradient of f (x) is the gradient of f (x) at x (i.e. ∇f (x)) if f (x) is differentiable [45]; in this case the subdifferential of D(λ i τ ) at λ i τ is ∂D(λ i τ ). It follows that we can iteratively obtain the pricing update as follows at different trading intervals where µ i is the step size and [x] + max(0, x). When the producers solve (29) and reveal the optimal quantity of energy it would consume e i (λ i τ ) given the new price update λ i τ , then the consumer solves (30) and provides the optimal price it would pay as P (b) i (λ i τ ). It follows that the price update is:Although (24) is convex and can be solved centrally, e.g. by the ETA, a major setback is that the willingness parameter (k ij ) is private, thus the ETA may not have enough information to do so. Furthermore, solving the problem centrally would lead to computational inefficiency and latency, and therefore stale energy prices. Thus, given the distributed nature of the prosumers, one of the ways to solve the dual problem is by gradient projection method [44] in a distributed fashion. Let a function f (x) : R n → R, the subgradient of f (x) is the gradient of f (x) at x (i.e. ∇f (x)) if f (x) is differentiable [45]; in this case the subdifferential of D(λ i τ ) at λ i τ is ∂D(λ i τ ). It follows that we can iteratively obtain the pricing update as follows at different trading intervals where µ i is the step size and [x] + max(0, x). When the producers solve (29) and reveal the optimal quantity of energy it would consume e i (λ i τ ) given the new price update λ i τ , then the consumer solves (30) and provides the optimal price it would pay as P (b) i (λ i τ ). It follows that the price update is:</p>
        <p>Hence, based on (24), the total social welfare benefit of the prosumer can be expressed asHence, based on (24), the total social welfare benefit of the prosumer can be expressed as</p>
        <p>ji ), (34) where W (•) is the social welfare of the nRES prosumers, e ii is the optimal amount of energy consumed which is realized by the producer by solving (29) while P (b) ji is the optimal price that the consumer is willing to pay to acquire E (b) ij which it realizes by solving (30).ji ), (34) where W (•) is the social welfare of the nRES prosumers, e ii is the optimal amount of energy consumed which is realized by the producer by solving (29) while P (b) ji is the optimal price that the consumer is willing to pay to acquire E (b) ij which it realizes by solving (30).</p>
        <p>Using the scenarios described above for RES and nRES, we explore the case of one VMG among the VMGs of the large energy trading area described in [3], [4]. The VMG is characterised by N -prosumers. Our interest is to evaluate the energy trading costs of a consumer for buying either RES or nRES, or both and how the cost can be minimized for the consumer and utility maximized for the producer in the VMG. We assume that all the prosumers within the single VMG are served by only one ETA such as LoRaWAN or any other LP-WAN technology [36]. Each consumer connects the prosumer facility to the ETA using an ETC as shown in Fig. 1. We assume the LoRaWAN network is stable and that the single VMG is composed of 10 prosumers with up to 80 kWh energy generation capacities. These datasets are generated as uniformly distributed random variables using 
            <rs type="software">MATLAB</rs> tool. Using ( 16) and ( 17) in (7), we evaluate the optimal energy trading costs for RES and nRES. We adopt the energy pricing parameter, namely P (g) j = 16p for each unit of energy produced [3] ≈ 25p. Furthermore, we adopt the environmental pollution parameters α = 2 × 10 -2 and β = 10 -1 as in [42]. To ensure that k ij /P
        </p>
        <p>ji such as in [29]. We also invoke the optimal pricing criteria realized at SE so as to compare the outcome results with that of the conventional price. By the term conventional, we imply random trading peer-to-peer energy trading mechanism that does not involve any smart trading mechanism such as the proposed game theory.ji such as in [29]. We also invoke the optimal pricing criteria realized at SE so as to compare the outcome results with that of the conventional price. By the term conventional, we imply random trading peer-to-peer energy trading mechanism that does not involve any smart trading mechanism such as the proposed game theory.</p>
        <p>Algorithm 1 Social welfare scheme for P2P energy prosumers 1: Initialization:Algorithm 1 Social welfare scheme for P2P energy prosumers 1: Initialization:</p>
        <p>ij , 2: α ji , µ i , λ i τ , T consumer, prosumer and grid parameters 3: for τ = 1 to T do 4:ij , 2: α ji , µ i , λ i τ , T consumer, prosumer and grid parameters 3: for τ = 1 to T do 4:</p>
        <p>Solve (32) to realize λ i τ as in (33) at τ th trading interval 5:Solve (32) to realize λ i τ as in (33) at τ th trading interval 5:</p>
        <p>Using the result in (32), solve (29) and (30), respectively 6:Using the result in (32), solve (29) and (30), respectively 6:</p>
        <p>Obtain e ii from the solution of (29). producer energy consumption from the Stackelberg game.Obtain e ii from the solution of (29). producer energy consumption from the Stackelberg game.</p>
        <p>Obtain P ji from the solution of (30). consumer price from the Stackelberg game. Find the social welfare using W (U i , C i E )Obtain P ji from the solution of (30). consumer price from the Stackelberg game. Find the social welfare using W (U i , C i E )</p>
        <p>11:11:</p>
        <p>if (Eif (E</p>
        <p>Compute new price update:Compute new price update:</p>
        <p>13:13:</p>
        <p>if the stopping criteria is met:if the stopping criteria is met:</p>
        <p>break the loop of iteration is iterated over τ = 1, • • • , T trading periods. The stopping criteria is established as the point where the slack variable in (33) is less than the best amount of energy consumed by the producer, i.e. (Ebreak the loop of iteration is iterated over τ = 1, • • • , T trading periods. The stopping criteria is established as the point where the slack variable in (33) is less than the best amount of energy consumed by the producer, i.e. (E</p>
        <p>ii , ∀i ∈ N . This is because, the prosumer must consume e † ii energy units to satisfy its local loads. The results of this iterative process is shown in Fig. 6. Clearly, it shows that the prices decay the trading period increases. On the other hand, the producer consumes more energy at such low prices period and sells more at higher price period. However, the producer is at best satisfaction at the point of intersection of the price and its consumption, a kind of the phenomenal equilibrium price. Fig. 5 presents the energy trading cost for our proposed Stackelberg game-based model with RES. It shows that with producers and consumers playing the Stackelberg game, the energy trading cost incurred by the is significantly reduced at SE. Investigating the optimal cost rigorously, the consumer requires to buy a small unit of energy when the willingness to sell is small in order to satisfy its non-flexible loads but indulges in revenue generation when the preference increases (i.e. as a producer). These are also true for nRES energy trading case as shown in Figs. 78. Notice that due to the penalty from emissions as shown in Fig. 8, the trading cost is higher for nRES prosumers (Fig. 7) than that of RES prosumers (Fig. 5). Next, we consider the utilities derived by producers of the non-cooperative game considering the cases of SW and no-SW scenarios in P2P energy trading frameworks as shown in Fig. 9. It is found that energy trading peers using SW within the VMG achieve higher utility than the conventional prosumers. This can be explained on the premise of secrecy of information/lack of information sharing. Each prosumer maintains its own local energy trading information on the amount of energy and price. This phenomenon further extends to the consumer as shown in Fig. 10. Due to SW, consumers in the non-cooperative P2P energy trading game pay lower energy cost than the conventionally trading P2P consumers. It follows that incorporating these results into (34), non-cooperative P2P prosumers achieve higher social welfare than conventional P2P energy prosumers. Utility of prosumer Cost of energy trading charged to consumer (£)ii , ∀i ∈ N . This is because, the prosumer must consume e † ii energy units to satisfy its local loads. The results of this iterative process is shown in Fig. 6. Clearly, it shows that the prices decay the trading period increases. On the other hand, the producer consumes more energy at such low prices period and sells more at higher price period. However, the producer is at best satisfaction at the point of intersection of the price and its consumption, a kind of the phenomenal equilibrium price. Fig. 5 presents the energy trading cost for our proposed Stackelberg game-based model with RES. It shows that with producers and consumers playing the Stackelberg game, the energy trading cost incurred by the is significantly reduced at SE. Investigating the optimal cost rigorously, the consumer requires to buy a small unit of energy when the willingness to sell is small in order to satisfy its non-flexible loads but indulges in revenue generation when the preference increases (i.e. as a producer). These are also true for nRES energy trading case as shown in Figs. 78. Notice that due to the penalty from emissions as shown in Fig. 8, the trading cost is higher for nRES prosumers (Fig. 7) than that of RES prosumers (Fig. 5). Next, we consider the utilities derived by producers of the non-cooperative game considering the cases of SW and no-SW scenarios in P2P energy trading frameworks as shown in Fig. 9. It is found that energy trading peers using SW within the VMG achieve higher utility than the conventional prosumers. This can be explained on the premise of secrecy of information/lack of information sharing. Each prosumer maintains its own local energy trading information on the amount of energy and price. This phenomenon further extends to the consumer as shown in Fig. 10. Due to SW, consumers in the non-cooperative P2P energy trading game pay lower energy cost than the conventionally trading P2P consumers. It follows that incorporating these results into (34), non-cooperative P2P prosumers achieve higher social welfare than conventional P2P energy prosumers. Utility of prosumer Cost of energy trading charged to consumer (£)</p>
        <p>, SW E (g) i = 8, No-SW E (g) i = 120, SW E (g) i = 120, No-SW E (g) i = 250, SW E (g) i = 250, No-SW, SW E (g) i = 8, No-SW E (g) i = 120, SW E (g) i = 120, No-SW E (g) i = 250, SW E (g) i = 250, No-SW</p>
        <p>In this study, we optimized the social benefits of P2P energy trading in virtual microgrids. We considered energy prosumers that can take up the roles of producers or consumers. When operating as consumers, they attempt to minimize energy trading cost while as producers, they seek to maximize their revenues/profits. The complicated interactions of the producer-consumer set-up was investigated as a non-cooperative Stackelberg game, and we showed that a Stackelberg equilibrium exist and is unique. We also found that at Stackelberg equilibrium, reducing the energy trading cost reduces the CO 2 emission too. Additionally, we observed that prosumer utility depends on the willingness to sell energy and amount of energy it chooses to consume. Lastly, we showed that in non-cooperative game analysed using Stackelberg game considering social welfare, prosumers achieve 47% higher utility than the conventional (random) energy trading. APPENDIXIn this study, we optimized the social benefits of P2P energy trading in virtual microgrids. We considered energy prosumers that can take up the roles of producers or consumers. When operating as consumers, they attempt to minimize energy trading cost while as producers, they seek to maximize their revenues/profits. The complicated interactions of the producer-consumer set-up was investigated as a non-cooperative Stackelberg game, and we showed that a Stackelberg equilibrium exist and is unique. We also found that at Stackelberg equilibrium, reducing the energy trading cost reduces the CO 2 emission too. Additionally, we observed that prosumer utility depends on the willingness to sell energy and amount of energy it chooses to consume. Lastly, we showed that in non-cooperative game analysed using Stackelberg game considering social welfare, prosumers achieve 47% higher utility than the conventional (random) energy trading. APPENDIX</p>
        <p>By taking the first derivative of (10), we obtainBy taking the first derivative of (10), we obtain</p>
        <p>By replacingBy replacing</p>
        <p>i -e ii ) in ( 7), the energy trading cost charged to the consumer isi -e ii ) in ( 7), the energy trading cost charged to the consumer is</p>
        <p>Substituting the e ii in ( 35) into (36), we getSubstituting the e ii in ( 35) into (36), we get</p>
        <p>Since each prosumer has the ability to produce and consume, we let q ij = E (g) i + E (b) ij , total amount of energy produced; by using the term 'produced', we imply the combination of energy locally generated and that bought from other prosumers. In this case, we can rewrite (6) asSince each prosumer has the ability to produce and consume, we let q ij = E (g) i + E (b) ij , total amount of energy produced; by using the term 'produced', we imply the combination of energy locally generated and that bought from other prosumers. In this case, we can rewrite (6) as</p>
        <p>Combining ( 38) and ( 7), we can rewrite (15) asCombining ( 38) and ( 7), we can rewrite (15) as</p>
        <p>C. Appendix CC. Appendix C</p>
        <p>We can express the second derivative of (39) asWe can express the second derivative of (39) as</p>
        <p>ij excess energy units producer i sold to j E (c) iij excess energy units producer i sold to j E (c) i</p>
        <p>5)5)</p>
        <p>1949-3053 (c) 2019 IEEE. Personal use is permitted, but republication/redistribution requires IEEE permission. See http://www.ieee.org/publications_standards/publications/rights/index.html for more information.1949-3053 (c) 2019 IEEE. Personal use is permitted, but republication/redistribution requires IEEE permission. See http://www.ieee.org/publications_standards/publications/rights/index.html for more information.</p>
        <p>13)13)</p>
        <p>1949-3053 (c) 2019 IEEE. Personal use is permitted, but republication/redistribution requires IEEE permission. See http://www.ieee.org/publications_standards/publications/rights/index.html for more information.1949-3053 (c) 2019 IEEE. Personal use is permitted, but republication/redistribution requires IEEE permission. See http://www.ieee.org/publications_standards/publications/rights/index.html for more information.</p>
        <p>))</p>
        <p>1949-3053 (c) 2019 IEEE. Personal use is permitted, but republication/redistribution requires IEEE permission. See http://www.ieee.org/publications_standards/publications/rights/index.html for more information.1949-3053 (c) 2019 IEEE. Personal use is permitted, but republication/redistribution requires IEEE permission. See http://www.ieee.org/publications_standards/publications/rights/index.html for more information.</p>
        <p>This work was supported, in part, by the Peer-to-Peer Energy Trading and Sharing -3M (Multi-times, Multi-scales, Multi-qualities) project funded by EPSRC (EP/N03466X/1) and in part, by "Triangulum" project (part of H2020 Smart Cities and Communities programme) funded by the European Commission under Grant 646578-Triangulum-H2020-2014-2015/H2020-SCC-2014.This work was supported, in part, by the Peer-to-Peer Energy Trading and Sharing -3M (Multi-times, Multi-scales, Multi-qualities) project funded by EPSRC (EP/N03466X/1) and in part, by "Triangulum" project (part of H2020 Smart Cities and Communities programme) funded by the European Commission under Grant 646578-Triangulum-H2020-2014-2015/H2020-SCC-2014.</p>
    </text>
</tei>
